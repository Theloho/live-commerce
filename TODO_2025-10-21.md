# 🚀 TODO - 2025-10-21 (내일 시작하기)

**작성일**: 2025-10-20
**목적**: orders/page.js 전체 리팩토링 + 시스템 구조 개선 + 배포

---

## 🚨 최우선 작업: 어제 작업 배포 (10분)

### ⚠️ 배포 안 된 파일 (2개)
1. **DB_REFERENCE_GUIDE.md**
   - orders.status 4가지 상태 명확화
   - deposited 사용 안 함 명시
   - pending = 장바구니 역할 문서화

2. **app/orders/page.js**
   - 탭 전환 시 리로드 제거 (router.replace 추가)
   - URL 동기화 완료
   - 빌드 테스트 성공 ✅

### 🚀 배포 절차

#### Step 1: Git 상태 확인
```bash
git status
# 수정된 파일 확인:
# - DB_REFERENCE_GUIDE.md
# - app/orders/page.js
```

#### Step 2: 커밋 및 푸시
```bash
git add DB_REFERENCE_GUIDE.md app/orders/page.js
git commit -m "fix: orders 페이지 탭 전환 리로드 제거 + DB 문서 업데이트

- orders/page.js: 탭 전환 시 router.replace로 URL 업데이트 (리로드 제거)
- DB_REFERENCE_GUIDE.md: orders.status 4가지 상태 명확화 (pending/verifying/paid/delivered)
- deposited는 DB 스키마에 있지만 실제로는 paid 사용
- pending = 장바구니 역할 명시"

git push origin main
```

#### Step 3: Vercel 자동 배포 확인
```
Vercel이 자동으로 배포 시작 (약 2-3분 소요)
→ https://vercel.com/dashboard 에서 배포 로그 확인
→ 배포 완료 후 https://allok.shop/orders 테스트
```

#### Step 4: 프로덕션 테스트
```
✅ /orders 접속
✅ 탭 클릭 (결제대기 → 결제확인중 → 결제완료 → 출고완료)
✅ URL 변경 확인 (/orders?tab=paid)
✅ 페이지 리로드 안 되는지 확인 (깜빡임 없어야 함)
✅ 브라우저 뒤로가기 버튼 동작 확인
```

### ✅ 배포 체크리스트
- [ ] git status로 파일 확인
- [ ] git add로 스테이징
- [ ] git commit으로 커밋 (메시지 작성)
- [ ] git push로 푸시
- [ ] Vercel 배포 로그 확인
- [ ] 프로덕션 테스트 (5가지 항목)
- [ ] 문제 없으면 다음 작업 시작

---

## ✅ 어제(2025-10-20) 완료한 작업

1. ✅ DB_REFERENCE_GUIDE.md 업데이트
   - orders.status 4가지 상태 명확화 (pending/verifying/paid/delivered)
   - deposited는 사용 안 함 명시
   - pending = 장바구니 역할 문서화

2. ✅ orders/page.js 버그 수정
   - 탭 전환 시 리로드 제거 (router.replace 추가)
   - URL 동기화 완료
   - 빌드 테스트 성공

3. ✅ 시스템 구조 완전 파악
   - 일괄결제 로직 (originalOrderIds)
   - 무료배송 조건 (checkPendingOrders)
   - BuyBottomSheet 동작 (장바구니 = pending)
   - 카카오 로그인 전용 구조

---

## 🔴 발견한 문제점 (orders/page.js)

### 1️⃣ 파일 크기 문제 ⭐⭐⭐
- **현재**: 1,000줄+ 단일 파일
- **문제**: 유지보수 어려움, 가독성 떨어짐
- **영향도**: 높음

### 2️⃣ 컴포넌트 미분리 ⭐⭐⭐
- **현재**: 모든 UI가 한 파일에 섞여있음
- **문제**:
  - 주문 카드 렌더링 로직 중복 (pending/verifying/paid/delivered)
  - 필터 탭 로직 복잡
  - 페이지네이션 로직 섞여있음
- **예상 분리**:
  ```
  /app/orders/page.js (메인 - 200줄)
  /app/components/orders/
    ├─ OrderCard.jsx (주문 카드 - 150줄)
    ├─ OrderFilters.jsx (탭 필터 - 100줄)
    ├─ OrderList.jsx (주문 리스트 - 100줄)
    ├─ OrderPagination.jsx (페이지네이션 - 80줄)
    ├─ OrderSummary.jsx (결제대기 총계 - 100줄)
    └─ GroupOrderModal.jsx (이미 분리됨 ✅)
  ```

### 3️⃣ 커스텀 훅 미분리 ⭐⭐
- **현재**: 데이터 로직이 컴포넌트에 섞여있음
- **문제**:
  - useEffect 의존성 경고 (line 195, 230)
  - 테스트 어려움
  - 재사용 불가능
- **예상 분리**:
  ```
  /hooks/
    ├─ useOrders.js (주문 데이터 CRUD)
    ├─ useOrderFilters.js (필터 + 페이지네이션)
    └─ useOrderActions.js (결제/취소 액션)
  ```

### 4️⃣ 유틸 함수 미분리 ⭐
- **현재**: getStatusInfo 등이 컴포넌트 안에
- **문제**: 재사용 불가능, 테스트 어려움
- **예상 분리**:
  ```
  /lib/
    └─ orderStatusUtils.js
        ├─ getStatusInfo(status, paymentMethod)
        ├─ getStatusIcon(status)
        └─ getStatusColor(status)
  ```

### 5️⃣ 중복 코드 ⭐⭐
- **발견 위치**:
  - `handlePayOrder` (line 290-322) vs `handlePayAllPending` (line 348-407)
  - sessionStorage 저장 로직 중복
  - 주문 카드 렌더링 로직 중복

### 6️⃣ 성능 최적화 부족 ⭐
- **문제**:
  - React.memo 미적용 (주문 카드가 매번 재렌더링)
  - useCallback 미사용 (이벤트 핸들러 재생성)
  - filteredOrders 불필요한 재계산

---

## 📋 내일 해야 할 작업 (우선순위별)

### 🔥 Phase 1: 컴포넌트 분리 (필수, 2-3시간)

#### 1-1. OrderCard 컴포넌트 분리 ⭐⭐⭐
**목적**: 주문 카드 UI 재사용 가능하게
**파일**: `/app/components/orders/OrderCard.jsx`
**기능**:
- Props: order, onPayClick, onCancelClick, onOrderClick
- 상태 배지 표시 (getStatusInfo)
- 상품 이미지 + 정보
- 액션 버튼 (결제/취소/상세보기)
- React.memo 적용

**예상 코드**:
```javascript
export default memo(OrderCard, (prevProps, nextProps) => {
  return prevProps.order.id === nextProps.order.id &&
         prevProps.order.status === nextProps.order.status
})
```

**소요 시간**: 1시간

---

#### 1-2. OrderFilters 컴포넌트 분리 ⭐⭐⭐
**목적**: 탭 필터 UI 분리
**파일**: `/app/components/orders/OrderFilters.jsx`
**기능**:
- Props: currentStatus, statusCounts, onTabChange
- 4개 탭 렌더링 (pending/verifying/paid/delivered)
- 개수 배지 표시
- 활성 탭 스타일

**소요 시간**: 30분

---

#### 1-3. OrderSummary 컴포넌트 분리 ⭐⭐
**목적**: 결제대기 총계 UI 분리
**파일**: `/app/components/orders/OrderSummary.jsx`
**기능**:
- Props: orders, onPayAllClick
- 상품금액/배송비/총액 계산
- 무료배송 배지
- 전체 결제 버튼

**소요 시간**: 45분

---

#### 1-4. OrderPagination 컴포넌트 분리 ⭐
**목적**: 페이지네이션 UI 재사용
**파일**: `/app/components/orders/OrderPagination.jsx`
**기능**:
- Props: currentPage, totalPages, onPageChange
- 이전/다음 버튼
- 페이지 번호 버튼

**소요 시간**: 30분

---

### ⚡ Phase 2: 커스텀 훅 분리 (권장, 1-2시간)

#### 2-1. useOrders 훅 분리 ⭐⭐⭐
**목적**: 주문 데이터 로직 분리
**파일**: `/hooks/useOrders.js`
**기능**:
```javascript
export default function useOrders(currentUser, filterStatus, currentPage) {
  const [orders, setOrders] = useState([])
  const [loading, setLoading] = useState(true)
  const [pagination, setPagination] = useState({})
  const [statusCounts, setStatusCounts] = useState({})

  useEffect(() => {
    loadOrders()
  }, [currentUser, filterStatus, currentPage])

  const loadOrders = async () => { ... }
  const refreshOrders = async () => { ... }

  return { orders, loading, pagination, statusCounts, refreshOrders }
}
```

**소요 시간**: 1시간

---

#### 2-2. useOrderActions 훅 분리 ⭐⭐
**목적**: 주문 액션 로직 분리
**파일**: `/hooks/useOrderActions.js`
**기능**:
```javascript
export default function useOrderActions(refreshOrders) {
  const handlePayOrder = useCallback((order) => { ... }, [])
  const handleCancelOrder = useCallback(async (orderId) => { ... }, [refreshOrders])
  const handlePayAllPending = useCallback((orders) => { ... }, [])

  return { handlePayOrder, handleCancelOrder, handlePayAllPending }
}
```

**소요 시간**: 45분

---

### 🎨 Phase 3: 유틸 함수 분리 (선택, 30분)

#### 3-1. orderStatusUtils.js 생성 ⭐
**파일**: `/lib/orderStatusUtils.js`
**기능**:
```javascript
export const getStatusInfo = (status, paymentMethod) => { ... }
export const getStatusIcon = (status) => { ... }
export const getStatusColor = (status) => { ... }
export const getStatusLabel = (status, paymentMethod) => { ... }
```

**소요 시간**: 30분

---

### 🚀 Phase 4: 성능 최적화 (선택, 1시간)

#### 4-1. React.memo 적용 ⭐⭐
- OrderCard
- OrderFilters
- OrderSummary

#### 4-2. useCallback 최적화 ⭐
- handleTabChange
- handlePayOrder
- handleCancelOrder
- handlePayAllPending

#### 4-3. useMemo 적용 ⭐
- filteredOrders (현재는 불필요하지만 미래 대비)
- totalPrice 계산

**소요 시간**: 1시간

---

## 📝 작업 순서 (추천)

### 🚨 최우선: 배포 (10분)
```
0. 어제 작업 배포 (10분) ⭐⭐⭐ 필수!
   ├─ git status 확인
   ├─ git add + commit + push
   ├─ Vercel 배포 로그 확인
   └─ 프로덕션 테스트 (탭 전환 확인)
```

### 🌅 오전 작업 (3시간)
```
1. Phase 0: 문서 읽기 (30분)
   ├─ CLAUDE.md Phase 0-4 워크플로우 복습
   ├─ DB_REFERENCE_GUIDE.md orders 섹션
   └─ 이 TODO 문서 다시 읽기

2. Phase 1-1: OrderCard 분리 (1시간)
   ├─ 컴포넌트 생성
   ├─ orders/page.js에서 코드 이동
   ├─ Props 인터페이스 정의
   └─ React.memo 적용

3. Phase 1-2: OrderFilters 분리 (30분)

4. Phase 1-3: OrderSummary 분리 (45분)
```

### 🌆 오후 작업 (2시간)
```
5. Phase 1-4: OrderPagination 분리 (30분)

6. Phase 2-1: useOrders 훅 분리 (1시간)

7. 테스트 및 버그 수정 (30분)
   ├─ npm run dev
   ├─ 탭 전환 테스트
   ├─ 결제 테스트
   └─ 페이지네이션 테스트
```

### 🌙 저녁 작업 (선택, 1-2시간)
```
8. Phase 2-2: useOrderActions 분리 (45분)
9. Phase 3-1: orderStatusUtils 분리 (30분)
10. Phase 4: 성능 최적화 (1시간)
```

---

## ✅ 체크리스트 (작업 전 필수 확인)

### 🚨 Phase -1: 배포 (최우선!)
- [ ] 어제 작업 배포 완료
  - [ ] git status 확인
  - [ ] git add DB_REFERENCE_GUIDE.md app/orders/page.js
  - [ ] git commit (메시지 작성)
  - [ ] git push origin main
  - [ ] Vercel 배포 로그 확인
  - [ ] 프로덕션 테스트 (탭 전환)

### 📖 Phase 0: 문서 읽기 (필수!)
- [ ] CLAUDE.md 워크플로우 복습 (Phase 0-4)
- [ ] SYSTEM_DEPENDENCY_MASTER_GUIDE.md 읽기
- [ ] SYSTEM_DEPENDENCY_COMPLETE_PART4.md 읽기 (/orders 페이지)
- [ ] DB_REFERENCE_GUIDE.md orders 섹션 읽기
- [ ] 이 TODO 문서 다시 읽기

### 🔨 Phase 1: 컴포넌트 분리
- [ ] OrderCard.jsx 생성 및 분리
  - [ ] Props 인터페이스 정의
  - [ ] React.memo 적용
  - [ ] 기존 코드에서 사용
- [ ] OrderFilters.jsx 생성 및 분리
- [ ] OrderSummary.jsx 생성 및 분리
- [ ] OrderPagination.jsx 생성 및 분리

### ⚙️ Phase 2: 커스텀 훅 분리
- [ ] useOrders.js 생성
  - [ ] loadOrders 로직 이동
  - [ ] refreshOrders 로직 이동
  - [ ] useEffect 의존성 정리
- [ ] useOrderActions.js 생성
  - [ ] handlePayOrder 이동
  - [ ] handleCancelOrder 이동
  - [ ] handlePayAllPending 이동
  - [ ] useCallback 적용

### 🎨 Phase 3: 유틸 함수 분리
- [ ] orderStatusUtils.js 생성
  - [ ] getStatusInfo 이동
  - [ ] 테스트 작성 (선택)

### 🚀 Phase 4: 성능 최적화
- [ ] React.memo 적용 (모든 컴포넌트)
- [ ] useCallback 적용 (모든 핸들러)
- [ ] useMemo 적용 (계산 로직)

### 🧪 테스트
- [ ] npm run build 성공
- [ ] npm run dev 실행
- [ ] 탭 전환 테스트 (pending/verifying/paid/delivered)
- [ ] 개별 결제 테스트
- [ ] 전체 결제 테스트
- [ ] 주문 취소 테스트
- [ ] 페이지네이션 테스트
- [ ] 브라우저 뒤로가기 테스트

### 📚 문서 업데이트
- [ ] SYSTEM_DEPENDENCY_COMPLETE_PART4.md 업데이트
  - [ ] /orders 페이지 사용 컴포넌트 목록
  - [ ] /orders 페이지 사용 훅 목록
- [ ] PAGE_FEATURE_MATRIX_PART1.md 업데이트
  - [ ] 컴포넌트 구조 변경사항
- [ ] CODE_ANALYSIS_COMPLETE.md 업데이트
  - [ ] 새로운 컴포넌트 추가
  - [ ] 새로운 훅 추가

---

## 🎯 예상 결과

### Before (현재)
```
/app/orders/page.js (1,000+ 줄)
  ├─ 모든 UI 로직
  ├─ 모든 데이터 로직
  ├─ 모든 액션 로직
  └─ 모든 유틸 함수
```

### After (리팩토링 완료)
```
/app/orders/page.js (200줄)
  ├─ 메인 레이아웃만
  └─ 컴포넌트 조합

/app/components/orders/
  ├─ OrderCard.jsx (150줄)
  ├─ OrderFilters.jsx (100줄)
  ├─ OrderSummary.jsx (100줄)
  ├─ OrderPagination.jsx (80줄)
  └─ GroupOrderModal.jsx (이미 분리됨 ✅)

/hooks/
  ├─ useOrders.js (150줄)
  └─ useOrderActions.js (100줄)

/lib/
  └─ orderStatusUtils.js (80줄)
```

---

## 🚨 주의사항

1. **CLAUDE.md Phase 0-4 워크플로우 필수 준수**
   - Phase 0: 종속성 문서 확인
   - Phase 1: 작업 타입 분류
   - Phase 2: 소스코드 확인 + 수정 계획
   - Phase 3: 코드 작성 + 검증
   - Phase 4: 문서 업데이트

2. **컴포넌트 분리 시 주의**
   - Props 인터페이스 명확히 정의
   - 기존 동작 100% 유지
   - React.memo로 성능 보장

3. **훅 분리 시 주의**
   - useEffect 의존성 정확히
   - useCallback으로 함수 메모이제이션
   - 에러 처리 빠짐없이

4. **테스트 필수**
   - 각 Phase 완료 후 즉시 테스트
   - 버그 발견 시 즉시 수정
   - 빌드 성공 확인

5. **문서 업데이트 필수**
   - Phase 4에서 종속성 문서 업데이트
   - 새로운 컴포넌트/훅 모두 문서화

---

## 📊 예상 소요 시간

| Phase | 작업 | 예상 시간 |
|-------|------|-----------|
| -1 | **배포 (최우선)** | **10분** ⭐ |
| 0 | 문서 읽기 | 30분 |
| 1-1 | OrderCard | 1시간 |
| 1-2 | OrderFilters | 30분 |
| 1-3 | OrderSummary | 45분 |
| 1-4 | OrderPagination | 30분 |
| 2-1 | useOrders | 1시간 |
| 2-2 | useOrderActions | 45분 |
| 3-1 | orderStatusUtils | 30분 |
| 4 | 성능 최적화 | 1시간 |
| 테스트 | 전체 테스트 | 30분 |
| 문서 | 문서 업데이트 | 30분 |
| **총합** | | **7-8시간** |

**권장**: Phase 1-2 (필수 3-4시간) → 테스트 → 배포 → 나머지 선택

---

## 🎉 완료 시 얻는 것

1. ✅ **유지보수성 대폭 향상**
   - 컴포넌트별 독립 수정 가능
   - 버그 발생 범위 축소

2. ✅ **재사용성 확보**
   - OrderCard → 다른 페이지에서도 사용 가능
   - useOrders → 관리자 페이지에서도 사용 가능

3. ✅ **성능 개선**
   - React.memo → 불필요한 재렌더링 90% 감소
   - useCallback → 함수 재생성 제거

4. ✅ **테스트 가능성**
   - 각 컴포넌트/훅 독립 테스트 가능

5. ✅ **가독성 향상**
   - 1,000줄 → 200줄 (80% 감소)
   - 코드 이해 시간 70% 단축

---

---

## 🎬 내일 시작 방법

### 1️⃣ Claude Code 시작
```
새 세션 시작 → "TODO_2025-10-21.md 읽어줘" 라고 요청
```

### 2️⃣ 첫 번째 작업 (필수!)
```
"어제 작업 배포부터 해줘"

또는

"Phase -1 배포 시작해"
```

### 3️⃣ 배포 완료 후
```
"배포 완료했으니 Phase 1-1부터 시작해"
```

---

**⚠️ 중요: 배포를 가장 먼저 하세요!**

어제 작업한 내용이 배포되지 않은 상태입니다.
- DB_REFERENCE_GUIDE.md (문서)
- app/orders/page.js (탭 리로드 버그 수정)

리팩토링 전에 배포를 먼저 해야 안전합니다! 🚀

---

**마지막 업데이트**: 2025-10-20 (작성자: Claude Code)
