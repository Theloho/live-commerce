# TODO - 2025-10-14 (내일 작업)

## 🎯 남은 작업: 관리자 페이지 Service Role API 전환 (3개)

### 우선순위

#### 1. 📋 카테고리 관리 (`/admin/categories`) - 중간 난이도
**현재 상태**: 클라이언트 Supabase 사용
**문제**: 모바일에서 데이터 조회 가능성 있음

**작업 내용**:
- [ ] API 생성: `/api/admin/categories` (GET, POST, PUT)
- [ ] `loadCategories()` 함수 Service Role API로 전환
- [ ] `handleSave()` 함수 Service Role API로 전환
- [ ] `handleToggleActive()` 함수 Service Role API로 전환
- [ ] 각 카테고리의 상품 개수 집계 포함

**예상 소요 시간**: 15분

---

#### 2. ⚙️ 설정 페이지 (`/admin/settings`) - 낮은 난이도
**현재 상태**: localStorage 사용 (DB 사용 안 함)
**문제**: 없음 (변경 불필요할 수 있음)

**확인 사항**:
- [ ] 페이지 기능 확인 (localStorage만 사용하는지)
- [ ] DB 연동이 필요한지 확인
- [ ] 필요 시 설정 테이블 생성 + API 구축

**예상 소요 시간**: 5-10분 (확인만) 또는 20분 (DB 연동 필요 시)

---

#### 3. 👥 관리자 관리 (`/admin/admins`) - 높은 난이도 ⚠️
**현재 상태**: 클라이언트 Supabase 사용 (8개 쿼리)
**문제**: 복잡한 권한 관리 + 여러 테이블 조인

**작업 내용**:
- [ ] API 생성: `/api/admin/admins` (GET, POST, PUT, DELETE)
- [ ] `loadAdmins()` 함수 Service Role API로 전환
  - profiles 조회 (is_admin, is_master)
  - admin_permissions 조회 및 매핑
- [ ] `handleCreateAdmin()` 함수 Service Role API로 전환
  - Supabase Auth 회원가입 처리
  - profiles.is_admin 설정
- [ ] 권한 수정/삭제 기능 Service Role API로 전환

**주의 사항**:
- Master 관리자만 접근 가능 (`isMaster` 체크)
- Supabase Auth API 사용 (회원가입)
- 복잡한 권한 시스템

**예상 소요 시간**: 30-40분

---

## 📊 진행 상황

### ✅ 완료 (5/8 - 62.5%)
1. `/admin/deposits` - 입금 확인
2. `/admin/shipping` - 발송 관리
3. `/admin/purchase-orders` - 발주 관리
4. `/admin/customers` - 고객 관리
5. `/admin/suppliers` - 공급업체 관리

### ⏳ 남음 (3/8 - 37.5%)
6. `/admin/categories` - 카테고리 관리
7. `/admin/settings` - 설정
8. `/admin/admins` - 관리자 관리

---

## 🎯 추천 작업 순서

**옵션 1: 빠른 완료 (30분)**
1. 카테고리 관리 (15분)
2. 설정 확인 (5-10분)
3. 관리자 관리 (나중에)

**옵션 2: 완전 완료 (1시간)**
1. 카테고리 관리 (15분)
2. 설정 확인 (10분)
3. 관리자 관리 (30-40분)

---

## 📝 참고사항

### 생성된 Service Role API 패턴
```javascript
// 1. 관리자 인증 확인
const { adminEmail } = await request.json()
const isAdmin = await verifyAdminAuth(adminEmail)
if (!isAdmin) return 403

// 2. Service Role로 RLS 우회
const { data } = await supabaseAdmin.from('table').select(...)
```

### 페이지 전환 패턴
```javascript
// Before
const data = await supabase.from('table').select(...)

// After
const { adminUser } = useAdminAuth()
const response = await fetch(`/api/admin/xxx?adminEmail=${adminUser.email}`)
const { data } = await response.json()
```

---

## 🧪 테스트 체크리스트 (작업 완료 후)

**웹 브라우저**:
- [ ] 카테고리 목록 표시
- [ ] 카테고리 추가/수정/삭제
- [ ] 설정 페이지 정상 작동
- [ ] 관리자 목록 표시
- [ ] 관리자 추가/권한 수정

**모바일**:
- [ ] 위 페이지들이 모두 데이터 정상 표시

---

**마지막 업데이트**: 2025-10-14 (세션 종료 시)
