# ğŸ—ºï¸ ê°œë°œ ë¡œë“œë§µ - 2025ë…„ 10ì›” 4ì¼ ì´í›„

## ğŸ“‹ ëª©ì°¨
1. [Phase 1: ê¸´ê¸‰ UX ìˆ˜ì •](#phase-1-ê¸´ê¸‰-ux-ìˆ˜ì •)
2. [Phase 2: ì¿ í° ì‹œìŠ¤í…œ](#phase-2-ì¿ í°-ì‹œìŠ¤í…œ)
3. [Phase 3: ê´€ë¦¬ì ì›Œí¬í”Œë¡œìš° ìë™í™”](#phase-3-ê´€ë¦¬ì-ì›Œí¬í”Œë¡œìš°-ìë™í™”)
4. [Phase 4: ì‹¤ì‹œê°„ ì¬ê³  ë™ê¸°í™”](#phase-4-ì‹¤ì‹œê°„-ì¬ê³ -ë™ê¸°í™”)
5. [Phase 5: íŒ€ë³„ ë°ì´í„° ëŒ€ì‹œë³´ë“œ](#phase-5-íŒ€ë³„-ë°ì´í„°-ëŒ€ì‹œë³´ë“œ)
6. [Phase 6: ì„±ëŠ¥ ìµœì í™”](#phase-6-ì„±ëŠ¥-ìµœì í™”)
7. [Phase 7: ë³´ì•ˆ ê°•í™”](#phase-7-ë³´ì•ˆ-ê°•í™”)

---

## Phase 1: ê¸´ê¸‰ UX ìˆ˜ì • ğŸš¨
**ìš°ì„ ìˆœìœ„**: â­â­â­â­â­ (ìµœìš°ì„ )
**ì˜ˆìƒ ì†Œìš”**: 2-3ì‹œê°„

### 1.1 ëª¨ë°”ì¼ ì…ë ¥ í•„ë“œ ê°€ì‹œì„± ì™„ì „ í•´ê²°
**ë¬¸ì œ**: Android/iOSì—ì„œ ì¼ë¶€ input/textareaê°€ ì—¬ì „íˆ íë¦¼

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ëª¨ë“  input íƒ€ì… í™•ì¸ (text, email, tel, number, password, search, url)
- [ ] textarea ê°€ì‹œì„± í™•ì¸
- [ ] select ë“œë¡­ë‹¤ìš´ ê°€ì‹œì„± í™•ì¸
- [ ] ë‹¤í¬ëª¨ë“œì—ì„œë„ ê°€ì‹œì„± í™•ì¸
- [ ] placeholder í…ìŠ¤íŠ¸ ëŒ€ë¹„ í™•ì¸

**ê¸°ìˆ  ì†”ë£¨ì…˜**:
```css
/* globals.css ê°•í™” ë²„ì „ */

/* ëª¨ë“  ì…ë ¥ í•„ë“œ - ìµœëŒ€ ê°€ì‹œì„± ë³´ì¥ */
input:not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="file"]),
textarea,
select {
  /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ê°•ì œ */
  -webkit-text-fill-color: #000000 !important;
  color: #000000 !important;

  /* íˆ¬ëª…ë„ ì œê±° */
  opacity: 1 !important;
  -webkit-opacity: 1 !important;

  /* ë°°ê²½ ê°•ì œ (íë¦¼ ë°©ì§€) */
  background-color: #ffffff !important;
  -webkit-background-color: #ffffff !important;

  /* ë„¤ì´í‹°ë¸Œ ìŠ¤íƒ€ì¼ ì œê±° */
  -webkit-appearance: none;
  appearance: none;

  /* í°íŠ¸ ë Œë”ë§ ê°œì„  */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Placeholder - ëª…í™•í•œ ëŒ€ë¹„ */
input::placeholder,
textarea::placeholder {
  -webkit-text-fill-color: rgba(0, 0, 0, 0.5) !important;
  color: rgba(0, 0, 0, 0.5) !important;
  opacity: 1 !important;
}

/* Focus ìƒíƒœ - ë” ëª…í™•í•˜ê²Œ */
input:focus,
textarea:focus,
select:focus {
  -webkit-text-fill-color: #000000 !important;
  color: #000000 !important;
  background-color: #ffffff !important;
  outline: 2px solid #ef4444 !important;
}

/* Disabled ìƒíƒœ */
input:disabled,
textarea:disabled,
select:disabled {
  -webkit-text-fill-color: rgba(0, 0, 0, 0.4) !important;
  color: rgba(0, 0, 0, 0.4) !important;
  background-color: #f3f4f6 !important;
  opacity: 1 !important;
}

/* Dark mode ëŒ€ì‘ */
@media (prefers-color-scheme: dark) {
  input:not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="file"]),
  textarea,
  select {
    -webkit-text-fill-color: #ffffff !important;
    color: #ffffff !important;
    background-color: #1f2937 !important;
  }

  input::placeholder,
  textarea::placeholder {
    -webkit-text-fill-color: rgba(255, 255, 255, 0.5) !important;
    color: rgba(255, 255, 255, 0.5) !important;
  }
}
```

**í…ŒìŠ¤íŠ¸ ê¸°ê¸°**:
- [ ] iPhone Safari (iOS 17+)
- [ ] iPhone Chrome
- [ ] Android Chrome
- [ ] Android Samsung Internet
- [ ] ë‹¤í¬ëª¨ë“œ ì „í™˜ í…ŒìŠ¤íŠ¸

---

## Phase 2: ì¿ í° ì‹œìŠ¤í…œ ğŸŸï¸
**ìš°ì„ ìˆœìœ„**: â­â­â­â­
**ì˜ˆìƒ ì†Œìš”**: 1ì¼

### 2.1 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

#### coupons í…Œì´ë¸”
```sql
CREATE TABLE coupons (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- ê¸°ë³¸ ì •ë³´
  code VARCHAR(50) UNIQUE NOT NULL,           -- ì¿ í° ì½”ë“œ (ì˜ˆ: WELCOME2025)
  name VARCHAR(200) NOT NULL,                  -- ì¿ í°ëª…
  description TEXT,                            -- ì„¤ëª…

  -- í• ì¸ ì •ë³´
  discount_type VARCHAR(20) NOT NULL,          -- 'percentage' | 'fixed'
  discount_value INTEGER NOT NULL,             -- í• ì¸ê°’ (10 = 10% or 10ì›)
  min_order_amount INTEGER DEFAULT 0,          -- ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡
  max_discount_amount INTEGER,                 -- ìµœëŒ€ í• ì¸ ê¸ˆì•¡ (ì •ë¥  í• ì¸ ì‹œ)

  -- ì‚¬ìš© ì œí•œ
  usage_limit INTEGER,                         -- ì „ì²´ ì‚¬ìš© ì œí•œ (NULL = ë¬´ì œí•œ)
  usage_per_user INTEGER DEFAULT 1,           -- 1ì¸ë‹¹ ì‚¬ìš© ì œí•œ
  usage_count INTEGER DEFAULT 0,              -- í˜„ì¬ ì‚¬ìš© íšŸìˆ˜

  -- ìœ íš¨ê¸°ê°„
  valid_from TIMESTAMPTZ NOT NULL,            -- ì‚¬ìš© ì‹œì‘ì¼
  valid_until TIMESTAMPTZ NOT NULL,           -- ì‚¬ìš© ì¢…ë£Œì¼

  -- ì ìš© ëŒ€ìƒ
  applicable_products JSONB,                   -- ì ìš© ìƒí’ˆ ID ë°°ì—´ (NULL = ì „ì²´)
  applicable_categories JSONB,                 -- ì ìš© ì¹´í…Œê³ ë¦¬ (NULL = ì „ì²´)

  -- ìƒíƒœ
  is_active BOOLEAN DEFAULT true,             -- í™œì„±í™” ì—¬ë¶€
  is_public BOOLEAN DEFAULT false,            -- ê³µê°œ ì—¬ë¶€ (false = ì½”ë“œ ì…ë ¥ë§Œ)

  -- ë©”íƒ€
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  created_by UUID REFERENCES profiles(id)
);

CREATE INDEX idx_coupons_code ON coupons(code);
CREATE INDEX idx_coupons_valid ON coupons(valid_from, valid_until);
CREATE INDEX idx_coupons_active ON coupons(is_active);
```

#### coupon_usages í…Œì´ë¸”
```sql
CREATE TABLE coupon_usages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  coupon_id UUID NOT NULL REFERENCES coupons(id) ON DELETE CASCADE,
  user_id UUID REFERENCES profiles(id),         -- NULL ê°€ëŠ¥ (ë¹„íšŒì›)
  order_id UUID REFERENCES orders(id),

  discount_amount INTEGER NOT NULL,             -- ì‹¤ì œ í• ì¸ëœ ê¸ˆì•¡

  used_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_coupon_usages_coupon ON coupon_usages(coupon_id);
CREATE INDEX idx_coupon_usages_user ON coupon_usages(user_id);
CREATE INDEX idx_coupon_usages_order ON coupon_usages(order_id);
```

### 2.2 ì¿ í° ì ìš© ë¡œì§

#### ì¿ í° ê²€ì¦ í•¨ìˆ˜
```javascript
// lib/couponUtils.js

export async function validateCoupon(couponCode, userId, cartItems) {
  const { data: coupon, error } = await supabase
    .from('coupons')
    .select('*')
    .eq('code', couponCode)
    .eq('is_active', true)
    .single()

  if (error || !coupon) {
    return { valid: false, error: 'ì¿ í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }
  }

  // 1. ìœ íš¨ê¸°ê°„ í™•ì¸
  const now = new Date()
  if (now < new Date(coupon.valid_from) || now > new Date(coupon.valid_until)) {
    return { valid: false, error: 'ì¿ í° ì‚¬ìš© ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤' }
  }

  // 2. ì „ì²´ ì‚¬ìš© ì œí•œ í™•ì¸
  if (coupon.usage_limit && coupon.usage_count >= coupon.usage_limit) {
    return { valid: false, error: 'ì¿ í°ì´ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤' }
  }

  // 3. 1ì¸ë‹¹ ì‚¬ìš© ì œí•œ í™•ì¸
  if (userId && coupon.usage_per_user) {
    const { count } = await supabase
      .from('coupon_usages')
      .select('*', { count: 'exact', head: true })
      .eq('coupon_id', coupon.id)
      .eq('user_id', userId)

    if (count >= coupon.usage_per_user) {
      return { valid: false, error: 'ì´ë¯¸ ì‚¬ìš©í•œ ì¿ í°ì…ë‹ˆë‹¤' }
    }
  }

  // 4. ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ í™•ì¸
  const cartTotal = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0)
  if (cartTotal < coupon.min_order_amount) {
    return {
      valid: false,
      error: `${coupon.min_order_amount.toLocaleString()}ì› ì´ìƒ ì£¼ë¬¸ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤`
    }
  }

  // 5. ì ìš© ìƒí’ˆ í™•ì¸
  if (coupon.applicable_products && coupon.applicable_products.length > 0) {
    const hasApplicableProduct = cartItems.some(item =>
      coupon.applicable_products.includes(item.product_id)
    )
    if (!hasApplicableProduct) {
      return { valid: false, error: 'ì ìš© ê°€ëŠ¥í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤' }
    }
  }

  return { valid: true, coupon }
}

export function calculateDiscount(coupon, cartTotal) {
  let discount = 0

  if (coupon.discount_type === 'percentage') {
    discount = Math.floor(cartTotal * (coupon.discount_value / 100))

    // ìµœëŒ€ í• ì¸ ê¸ˆì•¡ ì œí•œ
    if (coupon.max_discount_amount && discount > coupon.max_discount_amount) {
      discount = coupon.max_discount_amount
    }
  } else if (coupon.discount_type === 'fixed') {
    discount = coupon.discount_value
  }

  return Math.min(discount, cartTotal) // ì¥ë°”êµ¬ë‹ˆ ê¸ˆì•¡ ì´ˆê³¼ ë°©ì§€
}
```

### 2.3 UI ì»´í¬ë„ŒíŠ¸

#### ì²´í¬ì•„ì›ƒ í˜ì´ì§€ ì¿ í° ì…ë ¥
```javascript
// app/checkout/page.jsì— ì¶”ê°€

const [couponCode, setCouponCode] = useState('')
const [appliedCoupon, setAppliedCoupon] = useState(null)
const [couponDiscount, setCouponDiscount] = useState(0)

const applyCoupon = async () => {
  const result = await validateCoupon(couponCode, currentUser?.id, cartItems)

  if (!result.valid) {
    toast.error(result.error)
    return
  }

  const discount = calculateDiscount(result.coupon, itemsTotal)
  setAppliedCoupon(result.coupon)
  setCouponDiscount(discount)
  toast.success(`${discount.toLocaleString()}ì› í• ì¸ ì ìš©!`)
}

// ì¿ í° ì„¹ì…˜ UI
<div className="border-t pt-4">
  <h3 className="font-medium mb-2">ì¿ í°</h3>
  <div className="flex gap-2">
    <input
      type="text"
      placeholder="ì¿ í° ì½”ë“œ ì…ë ¥"
      value={couponCode}
      onChange={(e) => setCouponCode(e.target.value.toUpperCase())}
      className="flex-1 px-3 py-2 border rounded"
    />
    <button
      onClick={applyCoupon}
      className="px-4 py-2 bg-red-600 text-white rounded"
    >
      ì ìš©
    </button>
  </div>

  {appliedCoupon && (
    <div className="mt-2 p-2 bg-green-50 rounded flex justify-between items-center">
      <span className="text-sm text-green-800">
        {appliedCoupon.name} (-{couponDiscount.toLocaleString()}ì›)
      </span>
      <button
        onClick={() => {
          setAppliedCoupon(null)
          setCouponDiscount(0)
          setCouponCode('')
        }}
        className="text-red-600 text-sm"
      >
        ì‚­ì œ
      </button>
    </div>
  )}
</div>

// ê²°ì œ ê¸ˆì•¡ ê³„ì‚°ì— ì¿ í° ë°˜ì˜
const finalAmount = itemsTotal + shippingFee - couponDiscount
```

### 2.4 ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€

**ê²½ë¡œ**: `/admin/coupons`

**ê¸°ëŠ¥**:
- [ ] ì¿ í° ëª©ë¡ (í™œì„±/ë¹„í™œì„± í•„í„°)
- [ ] ì¿ í° ìƒì„± (ì½”ë“œ, í• ì¸ìœ¨, ê¸°ê°„ ì„¤ì •)
- [ ] ì¿ í° ìˆ˜ì •
- [ ] ì¿ í° ì‚¬ìš© ë‚´ì—­ ì¡°íšŒ
- [ ] ì¿ í° í†µê³„ (ì‚¬ìš©ë¥ , í• ì¸ ì´ì•¡)

---

## Phase 3: ê´€ë¦¬ì ì›Œí¬í”Œë¡œìš° ìë™í™” ğŸ“¦
**ìš°ì„ ìˆœìœ„**: â­â­â­â­
**ì˜ˆìƒ ì†Œìš”**: 2ì¼

### 3.1 í•œì§„íƒë°° ì†¡ì¥ ì²˜ë¦¬ ì‹œìŠ¤í…œ

#### ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥
```sql
-- orders í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE orders
ADD COLUMN tracking_number VARCHAR(50),      -- ì†¡ì¥ë²ˆí˜¸
ADD COLUMN shipping_company VARCHAR(50),     -- íƒë°°ì‚¬ (ì˜ˆ: í•œì§„íƒë°°)
ADD COLUMN shipped_at TIMESTAMPTZ;           -- ë°œì†¡ ì‹œê°
```

#### í•œì§„íƒë°° ì—‘ì…€ ì—…ë¡œë“œ ì²˜ë¦¬
```javascript
// app/admin/shipping/page.jsì— ì¶”ê°€

const handleExcelUpload = async (file) => {
  const workbook = await readExcelFile(file)
  const sheet = workbook.Sheets[workbook.SheetNames[0]]
  const data = XLSX.utils.sheet_to_json(sheet)

  // í•œì§„íƒë°° ì—‘ì…€ í˜•ì‹ ì˜ˆìƒ:
  // | ì£¼ë¬¸ë²ˆí˜¸ | ì†¡ì¥ë²ˆí˜¸ | ë°œì†¡ì¼ì‹œ |

  const updates = data.map(row => ({
    customer_order_number: row['ì£¼ë¬¸ë²ˆí˜¸'],
    tracking_number: row['ì†¡ì¥ë²ˆí˜¸'],
    shipping_company: 'í•œì§„íƒë°°',
    status: 'delivered',
    shipped_at: new Date(row['ë°œì†¡ì¼ì‹œ'])
  }))

  // Bulk update
  for (const update of updates) {
    await supabase
      .from('orders')
      .update({
        tracking_number: update.tracking_number,
        shipping_company: update.shipping_company,
        status: update.status,
        shipped_at: update.shipped_at,
        delivered_at: update.shipped_at
      })
      .eq('customer_order_number', update.customer_order_number)
  }

  toast.success(`${updates.length}ê±´ ì†¡ì¥ ì—…ë¡œë“œ ì™„ë£Œ`)
}
```

#### UI ì»´í¬ë„ŒíŠ¸
```javascript
// ì†¡ì¥ ì—…ë¡œë“œ ì„¹ì…˜
<div className="bg-white p-6 rounded-lg border">
  <h3 className="text-lg font-bold mb-4">ğŸ“¦ í•œì§„íƒë°° ì†¡ì¥ ì¼ê´„ ì—…ë¡œë“œ</h3>

  <div className="mb-4 p-4 bg-blue-50 rounded">
    <p className="text-sm text-blue-800">
      â€¢ í•œì§„íƒë°°ì—ì„œ ë°›ì€ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”<br/>
      â€¢ ì£¼ë¬¸ë²ˆí˜¸, ì†¡ì¥ë²ˆí˜¸, ë°œì†¡ì¼ì‹œê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤<br/>
      â€¢ ì—…ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ 'ë°°ì†¡ì™„ë£Œ' ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤
    </p>
  </div>

  <input
    type="file"
    accept=".xlsx,.xls"
    onChange={(e) => handleExcelUpload(e.target.files[0])}
    className="block w-full text-sm"
  />

  <button className="mt-4 px-4 py-2 bg-green-600 text-white rounded">
    ì†¡ì¥ ì—…ë¡œë“œ ë° ë°œì†¡ì™„ë£Œ ì²˜ë¦¬
  </button>
</div>
```

### 3.2 ì†¡ì¥ë²ˆí˜¸ ìë™ ì•Œë¦¼ (ì„ íƒì‚¬í•­)

```javascript
// ì†¡ì¥ë²ˆí˜¸ ì—…ë°ì´íŠ¸ ì‹œ ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ ë°œì†¡
async function sendShippingNotification(order) {
  // ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ API ì—°ë™
  const message = `
[ë°°ì†¡ ì‹œì‘]
ì£¼ë¬¸ë²ˆí˜¸: ${order.customer_order_number}
íƒë°°ì‚¬: ${order.shipping_company}
ì†¡ì¥ë²ˆí˜¸: ${order.tracking_number}

ì•„ë˜ ë§í¬ì—ì„œ ë°°ì†¡ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
https://www.hanjin.com/kor/CMS/DeliveryMgr/WaybillResult.do?mCode=MN038&schLang=KR&wblnum=${order.tracking_number}
  `

  // SMS/ì•Œë¦¼í†¡ ë°œì†¡ ë¡œì§
}
```

---

## Phase 4: ì‹¤ì‹œê°„ ì¬ê³  ë™ê¸°í™” ğŸ”„
**ìš°ì„ ìˆœìœ„**: â­â­â­â­
**ì˜ˆìƒ ì†Œìš”**: 1ì¼

### 4.1 Supabase Realtime êµ¬ë…

#### ìƒí’ˆ í˜ì´ì§€ ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸
```javascript
// app/page.js (í™ˆ í˜ì´ì§€)

useEffect(() => {
  // Realtime êµ¬ë… ì„¤ì •
  const channel = supabase
    .channel('products-changes')
    .on(
      'postgres_changes',
      {
        event: '*', // INSERT, UPDATE, DELETE
        schema: 'public',
        table: 'products'
      },
      (payload) => {
        console.log('ğŸ”„ ìƒí’ˆ ë³€ê²½ ê°ì§€:', payload)

        if (payload.eventType === 'UPDATE') {
          // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
          setProducts(prev => prev.map(p =>
            p.id === payload.new.id ? { ...p, ...payload.new } : p
          ))

          toast.info('ìƒí’ˆ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤')
        } else if (payload.eventType === 'INSERT') {
          // ìƒˆ ìƒí’ˆ ì¶”ê°€
          setProducts(prev => [payload.new, ...prev])
          toast.success('ìƒˆ ìƒí’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!')
        }
      }
    )
    .subscribe()

  return () => {
    supabase.removeChannel(channel)
  }
}, [])
```

#### Variant ì¬ê³  ì‹¤ì‹œê°„ ë™ê¸°í™”
```javascript
// app/components/product/BuyBottomSheet.jsx

useEffect(() => {
  if (!productId) return

  const channel = supabase
    .channel(`product-variants-${productId}`)
    .on(
      'postgres_changes',
      {
        event: 'UPDATE',
        schema: 'public',
        table: 'product_variants',
        filter: `product_id=eq.${productId}`
      },
      (payload) => {
        console.log('ğŸ”„ Variant ì¬ê³  ë³€ê²½:', payload)

        // ë¡œì»¬ variants ì—…ë°ì´íŠ¸
        setVariants(prev => prev.map(v =>
          v.id === payload.new.id
            ? { ...v, inventory: payload.new.inventory }
            : v
        ))

        // í˜„ì¬ ì„ íƒëœ variantê°€ í’ˆì ˆë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (selectedVariant?.id === payload.new.id && payload.new.inventory === 0) {
          toast.error('ì„ íƒí•œ ì˜µì…˜ì´ í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤')
        }
      }
    )
    .subscribe()

  return () => {
    supabase.removeChannel(channel)
  }
}, [productId])
```

### 4.2 ê´€ë¦¬ì ì¬ê³  ìˆ˜ì • ì‹œ ì¦‰ì‹œ ë°˜ì˜

```javascript
// app/admin/products/catalog/[id]/edit/page.js

const updateInventory = async (variantId, newInventory) => {
  const { error } = await supabase
    .from('product_variants')
    .update({
      inventory: newInventory,
      updated_at: new Date().toISOString()
    })
    .eq('id', variantId)

  if (!error) {
    toast.success('ì¬ê³ ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤')
    // Realtimeìœ¼ë¡œ ìë™ ì „íŒŒë¨!
  }
}
```

### 4.3 ë¼ì´ë¸Œ ë°©ì†¡ ì¤‘ ìƒí’ˆ ì¶”ê°€ ì‹¤ì‹œê°„ ë°˜ì˜

```javascript
// app/admin/broadcasts/page.js

const addProductToBroadcast = async (productId) => {
  const { error } = await supabase
    .from('products')
    .update({
      is_live: true,
      live_started_at: new Date().toISOString()
    })
    .eq('id', productId)

  // ì‚¬ìš©ì í™”ë©´ì—ì„œ ì¦‰ì‹œ ë‚˜íƒ€ë‚¨ (Realtime êµ¬ë… ë•ë¶„)
}
```

---

## Phase 5: íŒ€ë³„ ë°ì´í„° ëŒ€ì‹œë³´ë“œ ğŸ“Š
**ìš°ì„ ìˆœìœ„**: â­â­â­
**ì˜ˆìƒ ì†Œìš”**: 1.5ì¼

### 5.1 ë°°ì†¡íŒ€ ëŒ€ì‹œë³´ë“œ

**ê²½ë¡œ**: `/admin/shipping/dashboard`

**ì œê³µ ë°ì´í„°**:
```javascript
// ì˜¤ëŠ˜ì˜ ë°°ì†¡ í˜„í™©
- ë°œì†¡ ëŒ€ê¸°: Xê±´
- ë°œì†¡ ì™„ë£Œ: Xê±´
- ë°°ì†¡ ì¤‘: Xê±´

// ì§€ì—­ë³„ ë°°ì†¡ í†µê³„
- ì œì£¼: Xê±´ (ë„ì„œì‚°ê°„ +3000ì›)
- ìš¸ë¦‰ë„: Xê±´ (ë„ì„œì‚°ê°„ +5000ì›)
- ê¸°íƒ€ ë„ì„œì‚°ê°„: Xê±´

// íƒë°°ì‚¬ë³„ í˜„í™©
- í•œì§„íƒë°°: Xê±´
- CJëŒ€í•œí†µìš´: Xê±´

// ê¸´ê¸‰ ë°°ì†¡ ì•Œë¦¼
- 2ì¼ ì´ìƒ ë¯¸ë°œì†¡: Xê±´ (ë¹¨ê°„ìƒ‰ í‘œì‹œ)
```

**ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥**:
- [ ] ì˜¤ëŠ˜ ë°œì†¡ ëŒ€ê¸° ëª©ë¡ (Excel)
- [ ] ì£¼ì†Œ ë¼ë²¨ ì¶œë ¥ (PDF)
- [ ] ì†¡ì¥ ë²ˆí˜¸ ì…ë ¥ í…œí”Œë¦¿ (Excel)

### 5.2 ë¬¼ë¥˜íŒ€ ëŒ€ì‹œë³´ë“œ

**ê²½ë¡œ**: `/admin/logistics/dashboard`

**ì œê³µ ë°ì´í„°**:
```javascript
// ì¬ê³  í˜„í™©
- ì¬ê³  ë¶€ì¡± (10ê°œ ì´í•˜): Xê°œ ìƒí’ˆ
- í’ˆì ˆ: Xê°œ ìƒí’ˆ
- ì¬ê³  íšŒì „ìœ¨ ìƒìœ„: Top 10

// ë°œì£¼ í•„ìš” ìƒí’ˆ
- ìë™ ê³„ì‚°: (í‰ê·  ì¼ íŒë§¤ëŸ‰ Ã— ë¦¬ë“œíƒ€ì„) - í˜„ì¬ê³ 
- ê¸´ê¸‰ ë°œì£¼ í•„ìš”: Xê°œ ìƒí’ˆ

// ì…ê³  ì˜ˆì •
- ì˜¤ëŠ˜: Xê±´
- ì´ë²ˆ ì£¼: Xê±´

// ì°½ê³ ë³„ ì¬ê³ 
- Aì°½ê³ : Xê°œ ìƒí’ˆ
- Bì°½ê³ : Xê°œ ìƒí’ˆ
```

**ìë™ ì•Œë¦¼**:
```javascript
// ì¬ê³  ë¶€ì¡± ì•Œë¦¼ (ë§¤ì¼ ì˜¤ì „ 9ì‹œ)
async function checkLowInventory() {
  const lowStockProducts = await supabase
    .from('product_variants')
    .select('*, products(*)')
    .lte('inventory', 10)
    .order('inventory', { ascending: true })

  // ìŠ¬ë™/ì´ë©”ì¼ ì•Œë¦¼
  sendSlackNotification({
    channel: '#logistics',
    message: `âš ï¸ ì¬ê³  ë¶€ì¡± ìƒí’ˆ ${lowStockProducts.length}ê°œ`
  })
}
```

### 5.3 ë°œì£¼ ì‹œìŠ¤í…œ ê°œì„ 

**ìë™ ë°œì£¼ ì œì•ˆ**:
```javascript
// ë°œì£¼ ì¶”ì²œ ë¡œì§
function calculateReorderQuantity(variant) {
  // ìµœê·¼ 30ì¼ í‰ê·  íŒë§¤ëŸ‰
  const avgDailySales = variant.sales_last_30_days / 30

  // ë¦¬ë“œíƒ€ì„ (ì˜ˆ: 7ì¼)
  const leadTime = 7

  // ì•ˆì „ ì¬ê³  (ì˜ˆ: 14ì¼ì¹˜)
  const safetyStock = avgDailySales * 14

  // ë°œì£¼ ìˆ˜ëŸ‰ = (í‰ê·  ì¼ íŒë§¤ëŸ‰ Ã— ë¦¬ë“œíƒ€ì„) + ì•ˆì „ ì¬ê³  - í˜„ì¬ê³ 
  const reorderQty = (avgDailySales * leadTime) + safetyStock - variant.inventory

  return Math.max(0, Math.ceil(reorderQty))
}
```

---

## Phase 6: ì„±ëŠ¥ ìµœì í™” âš¡
**ìš°ì„ ìˆœìœ„**: â­â­â­
**ì˜ˆìƒ ì†Œìš”**: 1ì¼

### 6.1 ë¡œê·¸ ìµœì í™”

#### í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë¡œê·¸ ì œê±°
```javascript
// lib/logger.js (ìƒˆ íŒŒì¼)

const IS_PRODUCTION = process.env.NODE_ENV === 'production'

export const logger = {
  debug: (...args) => {
    if (!IS_PRODUCTION) {
      console.log('ğŸ”', ...args)
    }
  },

  info: (...args) => {
    if (!IS_PRODUCTION) {
      console.log('â„¹ï¸', ...args)
    }
  },

  warn: (...args) => {
    console.warn('âš ï¸', ...args)
  },

  error: (...args) => {
    console.error('âŒ', ...args)
    // í”„ë¡œë•ì…˜ì—ì„œëŠ” ì—ëŸ¬ ë¡œê¹… ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
    if (IS_PRODUCTION) {
      // Sentry.captureException(args[0])
    }
  }
}

// ì‚¬ìš©ë²•
import { logger } from '@/lib/logger'
logger.debug('ë””ë²„ê·¸ ì •ë³´') // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì¶œë ¥
logger.error('ì—ëŸ¬ ë°œìƒ') // í•­ìƒ ì¶œë ¥ + Sentry ì „ì†¡
```

#### ê¸°ì¡´ console.log ì¼ê´„ ë³€ê²½
```bash
# ì „ì²´ í”„ë¡œì íŠ¸ì—ì„œ console.log â†’ logger.debug ë³€ê²½
find app lib -name "*.js" -o -name "*.jsx" | xargs sed -i '' 's/console.log/logger.debug/g'
```

### 6.2 ì´ë¯¸ì§€ ìµœì í™”

#### Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
```javascript
// BEFORE
<img src={product.thumbnail_url} alt={product.title} />

// AFTER
import Image from 'next/image'
<Image
  src={product.thumbnail_url}
  alt={product.title}
  width={400}
  height={400}
  loading="lazy"
  placeholder="blur"
  blurDataURL="data:image/svg+xml;base64,..."
/>
```

#### ì´ë¯¸ì§€ CDN ìµœì í™” (Supabase Storage)
```javascript
// lib/imageUtils.js

export function getOptimizedImageUrl(url, options = {}) {
  const { width = 800, quality = 80, format = 'webp' } = options

  // Supabase Storage Transform API
  return `${url}?width=${width}&quality=${quality}&format=${format}`
}

// ì‚¬ìš©ë²•
<img src={getOptimizedImageUrl(product.thumbnail_url, { width: 400 })} />
```

### 6.3 ë²ˆë“¤ í¬ê¸° ìµœì í™”

#### ë™ì  import ì‚¬ìš©
```javascript
// BEFORE
import { motion } from 'framer-motion'

// AFTER (ì‚¬ìš© ì‹œì ì—ë§Œ ë¡œë“œ)
const motion = dynamic(() => import('framer-motion').then(mod => ({ default: mod.motion })))
```

#### ë¶„ì„ ë„êµ¬ ì‹¤í–‰
```bash
# Bundle Analyzer ì„¤ì¹˜
npm install --save-dev @next/bundle-analyzer

# next.config.js ìˆ˜ì •
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
})

module.exports = withBundleAnalyzer({
  // ê¸°ì¡´ ì„¤ì •
})

# ë¶„ì„ ì‹¤í–‰
ANALYZE=true npm run build
```

### 6.4 ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”

#### ì¸ë±ìŠ¤ ì¶”ê°€
```sql
-- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_orders_status_created ON orders(status, created_at DESC);
CREATE INDEX idx_orders_user_created ON orders(user_id, created_at DESC);
CREATE INDEX idx_products_live ON products(is_live) WHERE is_live = true;
CREATE INDEX idx_variants_inventory ON product_variants(inventory) WHERE inventory > 0;
```

#### N+1 ì¿¼ë¦¬ ë°©ì§€
```javascript
// BEFORE (N+1 ë¬¸ì œ)
const orders = await getOrders()
for (const order of orders) {
  order.items = await getOrderItems(order.id) // ë°˜ë³µ ì¿¼ë¦¬!
}

// AFTER (JOIN ì‚¬ìš©)
const orders = await supabase
  .from('orders')
  .select(`
    *,
    order_items(*)
  `)
```

---

## Phase 7: ë³´ì•ˆ ê°•í™” ğŸ”’
**ìš°ì„ ìˆœìœ„**: â­â­â­â­
**ì˜ˆìƒ ì†Œìš”**: 1ì¼

### 7.1 ê´€ë¦¬ì ì¸ì¦ ì‹œìŠ¤í…œ

#### ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
```sql
-- profiles í…Œì´ë¸”ì— role ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE profiles
ADD COLUMN role VARCHAR(20) DEFAULT 'user';

-- role ê°’: 'user', 'admin', 'super_admin'

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_profiles_role ON profiles(role);
```

#### ë¯¸ë“¤ì›¨ì–´ ë³´í˜¸
```javascript
// middleware.js

export function middleware(request) {
  const { pathname } = request.nextUrl

  // ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ ì²´í¬
  if (pathname.startsWith('/admin')) {
    const session = request.cookies.get('supabase-auth-token')

    if (!session) {
      return NextResponse.redirect(new URL('/admin/login', request.url))
    }

    // ì¶”ê°€: ì—­í•  í™•ì¸ (ì„œë²„ ì‚¬ì´ë“œì—ì„œ)
    // ì‹¤ì œ êµ¬í˜„ ì‹œ Supabase Authì—ì„œ ì‚¬ìš©ì role í™•ì¸
  }

  return NextResponse.next()
}

export const config = {
  matcher: '/admin/:path*'
}
```

#### ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ ê°œì„ 
```javascript
// app/admin/login/page.js

export default function AdminLoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')

  const handleLogin = async (e) => {
    e.preventDefault()

    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password
    })

    if (error) {
      toast.error('ë¡œê·¸ì¸ ì‹¤íŒ¨')
      return
    }

    // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
    const { data: profile } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', data.user.id)
      .single()

    if (profile?.role !== 'admin' && profile?.role !== 'super_admin') {
      await supabase.auth.signOut()
      toast.error('ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤')
      return
    }

    router.push('/admin')
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
        <h1 className="text-2xl font-bold mb-6 text-center">ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
        <form onSubmit={handleLogin}>
          <input
            type="email"
            placeholder="ì´ë©”ì¼"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full px-4 py-2 border rounded mb-4"
            required
          />
          <input
            type="password"
            placeholder="ë¹„ë°€ë²ˆí˜¸"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full px-4 py-2 border rounded mb-4"
            required
          />
          <button
            type="submit"
            className="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700"
          >
            ë¡œê·¸ì¸
          </button>
        </form>
      </div>
    </div>
  )
}
```

### 7.2 ì½˜ì†” ë¡œê·¸ ìˆ¨ê¸°ê¸° (ì†ŒìŠ¤ ë³´í˜¸)

#### í”„ë¡œë•ì…˜ ë¹Œë“œ ì‹œ console ì œê±°
```javascript
// next.config.js

module.exports = {
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production' ? {
      exclude: ['error', 'warn'], // error, warnì€ ìœ ì§€
    } : false,
  },
}
```

#### ì†ŒìŠ¤ì½”ë“œ ë‚œë…í™”
```bash
# ë‚œë…í™” í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
npm install --save-dev webpack-obfuscator

# next.config.jsì— ì¶”ê°€
const WebpackObfuscator = require('webpack-obfuscator')

module.exports = {
  webpack: (config, { isServer }) => {
    if (!isServer && process.env.NODE_ENV === 'production') {
      config.plugins.push(
        new WebpackObfuscator({
          rotateStringArray: true,
          stringArray: true,
          stringArrayThreshold: 0.75
        })
      )
    }
    return config
  }
}
```

### 7.3 API ë³´ì•ˆ

#### Rate Limiting
```javascript
// lib/rateLimiter.js

const rateLimit = new Map()

export function checkRateLimit(identifier, limit = 10, windowMs = 60000) {
  const now = Date.now()
  const userRequests = rateLimit.get(identifier) || []

  // ì˜¤ë˜ëœ ìš”ì²­ ì œê±°
  const recentRequests = userRequests.filter(time => now - time < windowMs)

  if (recentRequests.length >= limit) {
    return false // ì œí•œ ì´ˆê³¼
  }

  recentRequests.push(now)
  rateLimit.set(identifier, recentRequests)

  return true // í—ˆìš©
}

// API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©
export async function POST(request) {
  const ip = request.headers.get('x-forwarded-for') || 'unknown'

  if (!checkRateLimit(ip, 10, 60000)) {
    return NextResponse.json(
      { error: 'ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' },
      { status: 429 }
    )
  }

  // ì •ìƒ ì²˜ë¦¬
}
```

#### CSRF í† í°
```javascript
// lib/csrf.js

export function generateCSRFToken() {
  return crypto.randomBytes(32).toString('hex')
}

export function validateCSRFToken(token, sessionToken) {
  return token === sessionToken
}

// API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©
export async function POST(request) {
  const csrfToken = request.headers.get('x-csrf-token')
  const sessionToken = request.cookies.get('csrf-token')

  if (!validateCSRFToken(csrfToken, sessionToken)) {
    return NextResponse.json({ error: 'Invalid CSRF token' }, { status: 403 })
  }

  // ì •ìƒ ì²˜ë¦¬
}
```

---

## ğŸ“… ì˜ˆìƒ ì¼ì •

| Phase | ì‘ì—… ë‚´ìš© | ìš°ì„ ìˆœìœ„ | ì˜ˆìƒ ì†Œìš” | ì‹œì‘ì¼ |
|-------|----------|---------|----------|--------|
| 1 | ëª¨ë°”ì¼ ì…ë ¥ í•„ë“œ ê°€ì‹œì„± ì™„ì „ í•´ê²° | â­â­â­â­â­ | 2-3ì‹œê°„ | 2025-10-04 |
| 2 | ì¿ í° ì‹œìŠ¤í…œ êµ¬ì¶• | â­â­â­â­ | 1ì¼ | 2025-10-04 |
| 3 | í•œì§„íƒë°° ì†¡ì¥ ìë™í™” | â­â­â­â­ | 2ì¼ | 2025-10-05 |
| 4 | ì‹¤ì‹œê°„ ì¬ê³  ë™ê¸°í™” | â­â­â­â­ | 1ì¼ | 2025-10-07 |
| 5 | íŒ€ë³„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶• | â­â­â­ | 1.5ì¼ | 2025-10-08 |
| 6 | ì„±ëŠ¥ ìµœì í™” | â­â­â­ | 1ì¼ | 2025-10-09 |
| 7 | ë³´ì•ˆ ê°•í™” | â­â­â­â­ | 1ì¼ | 2025-10-10 |

**ì´ ì˜ˆìƒ ì†Œìš”**: ì•½ 8-9ì¼

---

## âœ… ê° Phase ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 ì™„ë£Œ ì¡°ê±´
- [ ] ëª¨ë“  ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ input í…ìŠ¤íŠ¸ ì„ ëª…í•˜ê²Œ ë³´ì„
- [ ] placeholder ëŒ€ë¹„ ì ì ˆ
- [ ] ë‹¤í¬ëª¨ë“œ ì§€ì›
- [ ] ë¼ë””ì˜¤/ì²´í¬ë°•ìŠ¤ ì •ìƒ ì‘ë™

### Phase 2 ì™„ë£Œ ì¡°ê±´
- [ ] ì¿ í° DB í…Œì´ë¸” ìƒì„±
- [ ] ì¿ í° ê²€ì¦ ë¡œì§ êµ¬í˜„
- [ ] ì²´í¬ì•„ì›ƒì— ì¿ í° ì ìš©
- [ ] ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
- [ ] ì¿ í° ì‚¬ìš© ë‚´ì—­ ì¡°íšŒ

### Phase 3 ì™„ë£Œ ì¡°ê±´
- [ ] í•œì§„íƒë°° ì—‘ì…€ ì—…ë¡œë“œ ê¸°ëŠ¥
- [ ] ì†¡ì¥ë²ˆí˜¸ ìë™ ì…ë ¥
- [ ] ë°œì†¡ì™„ë£Œ ìƒíƒœ ìë™ ë³€ê²½
- [ ] ì†¡ì¥ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥

### Phase 4 ì™„ë£Œ ì¡°ê±´
- [ ] ìƒí’ˆ Realtime êµ¬ë…
- [ ] Variant ì¬ê³  Realtime ì—…ë°ì´íŠ¸
- [ ] ê´€ë¦¬ì ìˆ˜ì • ì‹œ ì¦‰ì‹œ ë°˜ì˜
- [ ] í’ˆì ˆ ì‹œ ìë™ ì•Œë¦¼

### Phase 5 ì™„ë£Œ ì¡°ê±´
- [ ] ë°°ì†¡íŒ€ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ë¬¼ë¥˜íŒ€ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ì¬ê³  ë¶€ì¡± ìë™ ì•Œë¦¼
- [ ] ë°œì£¼ ì œì•ˆ ì‹œìŠ¤í…œ

### Phase 6 ì™„ë£Œ ì¡°ê±´
- [ ] logger ì‹œìŠ¤í…œ ì ìš©
- [ ] ì´ë¯¸ì§€ ìµœì í™”
- [ ] ë²ˆë“¤ í¬ê¸° 20% ê°ì†Œ
- [ ] ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ 

### Phase 7 ì™„ë£Œ ì¡°ê±´
- [ ] ê´€ë¦¬ì role ê¸°ë°˜ ì¸ì¦
- [ ] ì½˜ì†” ë¡œê·¸ í”„ë¡œë•ì…˜ ì œê±°
- [ ] ì†ŒìŠ¤ì½”ë“œ ë‚œë…í™”
- [ ] API Rate Limiting

---

## ğŸ¯ ë‹¤ìŒ ì‘ì—… ì‹œ ìš°ì„ ìˆœìœ„

**ì¦‰ì‹œ ì‹œì‘** (2025-10-04):
1. â­â­â­â­â­ Phase 1: ëª¨ë°”ì¼ ì…ë ¥ ê°€ì‹œì„± (2-3ì‹œê°„)
2. â­â­â­â­ Phase 2: ì¿ í° ì‹œìŠ¤í…œ (1ì¼)

**ì´ì–´ì„œ ì§„í–‰**:
3. Phase 3 â†’ 4 â†’ 7 â†’ 5 â†’ 6 ìˆœì„œ ê¶Œì¥

---

**ì‘ì„±ì¼**: 2025-10-03
**ì‘ì„±ì**: Claude Code
**ë¬¸ì„œ ë²„ì „**: 1.0
