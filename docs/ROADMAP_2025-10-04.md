# 🗺️ 개발 로드맵 - 2025년 10월 4일 이후

## 📋 목차
1. [Phase 1: 긴급 UX 수정](#phase-1-긴급-ux-수정)
2. [Phase 2: 쿠폰 시스템](#phase-2-쿠폰-시스템)
3. [Phase 3: 관리자 워크플로우 자동화](#phase-3-관리자-워크플로우-자동화)
4. [Phase 4: 실시간 재고 동기화](#phase-4-실시간-재고-동기화)
5. [Phase 5: 팀별 데이터 대시보드](#phase-5-팀별-데이터-대시보드)
6. [Phase 6: 성능 최적화](#phase-6-성능-최적화)
7. [Phase 7: 보안 강화](#phase-7-보안-강화)

---

## Phase 1: 긴급 UX 수정 🚨
**우선순위**: ⭐⭐⭐⭐⭐ (최우선)
**예상 소요**: 2-3시간

### 1.1 모바일 입력 필드 가시성 완전 해결
**문제**: Android/iOS에서 일부 input/textarea가 여전히 흐림

**체크리스트**:
- [ ] 모든 input 타입 확인 (text, email, tel, number, password, search, url)
- [ ] textarea 가시성 확인
- [ ] select 드롭다운 가시성 확인
- [ ] 다크모드에서도 가시성 확인
- [ ] placeholder 텍스트 대비 확인

**기술 솔루션**:
```css
/* globals.css 강화 버전 */

/* 모든 입력 필드 - 최대 가시성 보장 */
input:not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="file"]),
textarea,
select {
  /* 텍스트 색상 강제 */
  -webkit-text-fill-color: #000000 !important;
  color: #000000 !important;

  /* 투명도 제거 */
  opacity: 1 !important;
  -webkit-opacity: 1 !important;

  /* 배경 강제 (흐림 방지) */
  background-color: #ffffff !important;
  -webkit-background-color: #ffffff !important;

  /* 네이티브 스타일 제거 */
  -webkit-appearance: none;
  appearance: none;

  /* 폰트 렌더링 개선 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Placeholder - 명확한 대비 */
input::placeholder,
textarea::placeholder {
  -webkit-text-fill-color: rgba(0, 0, 0, 0.5) !important;
  color: rgba(0, 0, 0, 0.5) !important;
  opacity: 1 !important;
}

/* Focus 상태 - 더 명확하게 */
input:focus,
textarea:focus,
select:focus {
  -webkit-text-fill-color: #000000 !important;
  color: #000000 !important;
  background-color: #ffffff !important;
  outline: 2px solid #ef4444 !important;
}

/* Disabled 상태 */
input:disabled,
textarea:disabled,
select:disabled {
  -webkit-text-fill-color: rgba(0, 0, 0, 0.4) !important;
  color: rgba(0, 0, 0, 0.4) !important;
  background-color: #f3f4f6 !important;
  opacity: 1 !important;
}

/* Dark mode 대응 */
@media (prefers-color-scheme: dark) {
  input:not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="file"]),
  textarea,
  select {
    -webkit-text-fill-color: #ffffff !important;
    color: #ffffff !important;
    background-color: #1f2937 !important;
  }

  input::placeholder,
  textarea::placeholder {
    -webkit-text-fill-color: rgba(255, 255, 255, 0.5) !important;
    color: rgba(255, 255, 255, 0.5) !important;
  }
}
```

**테스트 기기**:
- [ ] iPhone Safari (iOS 17+)
- [ ] iPhone Chrome
- [ ] Android Chrome
- [ ] Android Samsung Internet
- [ ] 다크모드 전환 테스트

---

## Phase 2: 쿠폰 시스템 🎟️
**우선순위**: ⭐⭐⭐⭐
**예상 소요**: 1일

### 2.1 데이터베이스 설계

#### coupons 테이블
```sql
CREATE TABLE coupons (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- 기본 정보
  code VARCHAR(50) UNIQUE NOT NULL,           -- 쿠폰 코드 (예: WELCOME2025)
  name VARCHAR(200) NOT NULL,                  -- 쿠폰명
  description TEXT,                            -- 설명

  -- 할인 정보
  discount_type VARCHAR(20) NOT NULL,          -- 'percentage' | 'fixed'
  discount_value INTEGER NOT NULL,             -- 할인값 (10 = 10% or 10원)
  min_order_amount INTEGER DEFAULT 0,          -- 최소 주문 금액
  max_discount_amount INTEGER,                 -- 최대 할인 금액 (정률 할인 시)

  -- 사용 제한
  usage_limit INTEGER,                         -- 전체 사용 제한 (NULL = 무제한)
  usage_per_user INTEGER DEFAULT 1,           -- 1인당 사용 제한
  usage_count INTEGER DEFAULT 0,              -- 현재 사용 횟수

  -- 유효기간
  valid_from TIMESTAMPTZ NOT NULL,            -- 사용 시작일
  valid_until TIMESTAMPTZ NOT NULL,           -- 사용 종료일

  -- 적용 대상
  applicable_products JSONB,                   -- 적용 상품 ID 배열 (NULL = 전체)
  applicable_categories JSONB,                 -- 적용 카테고리 (NULL = 전체)

  -- 상태
  is_active BOOLEAN DEFAULT true,             -- 활성화 여부
  is_public BOOLEAN DEFAULT false,            -- 공개 여부 (false = 코드 입력만)

  -- 메타
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  created_by UUID REFERENCES profiles(id)
);

CREATE INDEX idx_coupons_code ON coupons(code);
CREATE INDEX idx_coupons_valid ON coupons(valid_from, valid_until);
CREATE INDEX idx_coupons_active ON coupons(is_active);
```

#### coupon_usages 테이블
```sql
CREATE TABLE coupon_usages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  coupon_id UUID NOT NULL REFERENCES coupons(id) ON DELETE CASCADE,
  user_id UUID REFERENCES profiles(id),         -- NULL 가능 (비회원)
  order_id UUID REFERENCES orders(id),

  discount_amount INTEGER NOT NULL,             -- 실제 할인된 금액

  used_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_coupon_usages_coupon ON coupon_usages(coupon_id);
CREATE INDEX idx_coupon_usages_user ON coupon_usages(user_id);
CREATE INDEX idx_coupon_usages_order ON coupon_usages(order_id);
```

### 2.2 쿠폰 적용 로직

#### 쿠폰 검증 함수
```javascript
// lib/couponUtils.js

export async function validateCoupon(couponCode, userId, cartItems) {
  const { data: coupon, error } = await supabase
    .from('coupons')
    .select('*')
    .eq('code', couponCode)
    .eq('is_active', true)
    .single()

  if (error || !coupon) {
    return { valid: false, error: '쿠폰을 찾을 수 없습니다' }
  }

  // 1. 유효기간 확인
  const now = new Date()
  if (now < new Date(coupon.valid_from) || now > new Date(coupon.valid_until)) {
    return { valid: false, error: '쿠폰 사용 기간이 아닙니다' }
  }

  // 2. 전체 사용 제한 확인
  if (coupon.usage_limit && coupon.usage_count >= coupon.usage_limit) {
    return { valid: false, error: '쿠폰이 모두 소진되었습니다' }
  }

  // 3. 1인당 사용 제한 확인
  if (userId && coupon.usage_per_user) {
    const { count } = await supabase
      .from('coupon_usages')
      .select('*', { count: 'exact', head: true })
      .eq('coupon_id', coupon.id)
      .eq('user_id', userId)

    if (count >= coupon.usage_per_user) {
      return { valid: false, error: '이미 사용한 쿠폰입니다' }
    }
  }

  // 4. 최소 주문 금액 확인
  const cartTotal = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0)
  if (cartTotal < coupon.min_order_amount) {
    return {
      valid: false,
      error: `${coupon.min_order_amount.toLocaleString()}원 이상 주문 시 사용 가능합니다`
    }
  }

  // 5. 적용 상품 확인
  if (coupon.applicable_products && coupon.applicable_products.length > 0) {
    const hasApplicableProduct = cartItems.some(item =>
      coupon.applicable_products.includes(item.product_id)
    )
    if (!hasApplicableProduct) {
      return { valid: false, error: '적용 가능한 상품이 없습니다' }
    }
  }

  return { valid: true, coupon }
}

export function calculateDiscount(coupon, cartTotal) {
  let discount = 0

  if (coupon.discount_type === 'percentage') {
    discount = Math.floor(cartTotal * (coupon.discount_value / 100))

    // 최대 할인 금액 제한
    if (coupon.max_discount_amount && discount > coupon.max_discount_amount) {
      discount = coupon.max_discount_amount
    }
  } else if (coupon.discount_type === 'fixed') {
    discount = coupon.discount_value
  }

  return Math.min(discount, cartTotal) // 장바구니 금액 초과 방지
}
```

### 2.3 UI 컴포넌트

#### 체크아웃 페이지 쿠폰 입력
```javascript
// app/checkout/page.js에 추가

const [couponCode, setCouponCode] = useState('')
const [appliedCoupon, setAppliedCoupon] = useState(null)
const [couponDiscount, setCouponDiscount] = useState(0)

const applyCoupon = async () => {
  const result = await validateCoupon(couponCode, currentUser?.id, cartItems)

  if (!result.valid) {
    toast.error(result.error)
    return
  }

  const discount = calculateDiscount(result.coupon, itemsTotal)
  setAppliedCoupon(result.coupon)
  setCouponDiscount(discount)
  toast.success(`${discount.toLocaleString()}원 할인 적용!`)
}

// 쿠폰 섹션 UI
<div className="border-t pt-4">
  <h3 className="font-medium mb-2">쿠폰</h3>
  <div className="flex gap-2">
    <input
      type="text"
      placeholder="쿠폰 코드 입력"
      value={couponCode}
      onChange={(e) => setCouponCode(e.target.value.toUpperCase())}
      className="flex-1 px-3 py-2 border rounded"
    />
    <button
      onClick={applyCoupon}
      className="px-4 py-2 bg-red-600 text-white rounded"
    >
      적용
    </button>
  </div>

  {appliedCoupon && (
    <div className="mt-2 p-2 bg-green-50 rounded flex justify-between items-center">
      <span className="text-sm text-green-800">
        {appliedCoupon.name} (-{couponDiscount.toLocaleString()}원)
      </span>
      <button
        onClick={() => {
          setAppliedCoupon(null)
          setCouponDiscount(0)
          setCouponCode('')
        }}
        className="text-red-600 text-sm"
      >
        삭제
      </button>
    </div>
  )}
</div>

// 결제 금액 계산에 쿠폰 반영
const finalAmount = itemsTotal + shippingFee - couponDiscount
```

### 2.4 관리자 쿠폰 관리 페이지

**경로**: `/admin/coupons`

**기능**:
- [ ] 쿠폰 목록 (활성/비활성 필터)
- [ ] 쿠폰 생성 (코드, 할인율, 기간 설정)
- [ ] 쿠폰 수정
- [ ] 쿠폰 사용 내역 조회
- [ ] 쿠폰 통계 (사용률, 할인 총액)

---

## Phase 3: 관리자 워크플로우 자동화 📦
**우선순위**: ⭐⭐⭐⭐
**예상 소요**: 2일

### 3.1 한진택배 송장 처리 시스템

#### 데이터베이스 확장
```sql
-- orders 테이블에 컬럼 추가
ALTER TABLE orders
ADD COLUMN tracking_number VARCHAR(50),      -- 송장번호
ADD COLUMN shipping_company VARCHAR(50),     -- 택배사 (예: 한진택배)
ADD COLUMN shipped_at TIMESTAMPTZ;           -- 발송 시각
```

#### 한진택배 엑셀 업로드 처리
```javascript
// app/admin/shipping/page.js에 추가

const handleExcelUpload = async (file) => {
  const workbook = await readExcelFile(file)
  const sheet = workbook.Sheets[workbook.SheetNames[0]]
  const data = XLSX.utils.sheet_to_json(sheet)

  // 한진택배 엑셀 형식 예상:
  // | 주문번호 | 송장번호 | 발송일시 |

  const updates = data.map(row => ({
    customer_order_number: row['주문번호'],
    tracking_number: row['송장번호'],
    shipping_company: '한진택배',
    status: 'delivered',
    shipped_at: new Date(row['발송일시'])
  }))

  // Bulk update
  for (const update of updates) {
    await supabase
      .from('orders')
      .update({
        tracking_number: update.tracking_number,
        shipping_company: update.shipping_company,
        status: update.status,
        shipped_at: update.shipped_at,
        delivered_at: update.shipped_at
      })
      .eq('customer_order_number', update.customer_order_number)
  }

  toast.success(`${updates.length}건 송장 업로드 완료`)
}
```

#### UI 컴포넌트
```javascript
// 송장 업로드 섹션
<div className="bg-white p-6 rounded-lg border">
  <h3 className="text-lg font-bold mb-4">📦 한진택배 송장 일괄 업로드</h3>

  <div className="mb-4 p-4 bg-blue-50 rounded">
    <p className="text-sm text-blue-800">
      • 한진택배에서 받은 엑셀 파일을 업로드하세요<br/>
      • 주문번호, 송장번호, 발송일시가 포함되어야 합니다<br/>
      • 업로드 시 자동으로 '배송완료' 상태로 변경됩니다
    </p>
  </div>

  <input
    type="file"
    accept=".xlsx,.xls"
    onChange={(e) => handleExcelUpload(e.target.files[0])}
    className="block w-full text-sm"
  />

  <button className="mt-4 px-4 py-2 bg-green-600 text-white rounded">
    송장 업로드 및 발송완료 처리
  </button>
</div>
```

### 3.2 송장번호 자동 알림 (선택사항)

```javascript
// 송장번호 업데이트 시 카카오 알림톡 발송
async function sendShippingNotification(order) {
  // 카카오 알림톡 API 연동
  const message = `
[배송 시작]
주문번호: ${order.customer_order_number}
택배사: ${order.shipping_company}
송장번호: ${order.tracking_number}

아래 링크에서 배송 조회가 가능합니다.
https://www.hanjin.com/kor/CMS/DeliveryMgr/WaybillResult.do?mCode=MN038&schLang=KR&wblnum=${order.tracking_number}
  `

  // SMS/알림톡 발송 로직
}
```

---

## Phase 4: 실시간 재고 동기화 🔄
**우선순위**: ⭐⭐⭐⭐
**예상 소요**: 1일

### 4.1 Supabase Realtime 구독

#### 상품 페이지 실시간 재고 업데이트
```javascript
// app/page.js (홈 페이지)

useEffect(() => {
  // Realtime 구독 설정
  const channel = supabase
    .channel('products-changes')
    .on(
      'postgres_changes',
      {
        event: '*', // INSERT, UPDATE, DELETE
        schema: 'public',
        table: 'products'
      },
      (payload) => {
        console.log('🔄 상품 변경 감지:', payload)

        if (payload.eventType === 'UPDATE') {
          // 로컬 상태 업데이트
          setProducts(prev => prev.map(p =>
            p.id === payload.new.id ? { ...p, ...payload.new } : p
          ))

          toast.info('상품 정보가 업데이트되었습니다')
        } else if (payload.eventType === 'INSERT') {
          // 새 상품 추가
          setProducts(prev => [payload.new, ...prev])
          toast.success('새 상품이 추가되었습니다!')
        }
      }
    )
    .subscribe()

  return () => {
    supabase.removeChannel(channel)
  }
}, [])
```

#### Variant 재고 실시간 동기화
```javascript
// app/components/product/BuyBottomSheet.jsx

useEffect(() => {
  if (!productId) return

  const channel = supabase
    .channel(`product-variants-${productId}`)
    .on(
      'postgres_changes',
      {
        event: 'UPDATE',
        schema: 'public',
        table: 'product_variants',
        filter: `product_id=eq.${productId}`
      },
      (payload) => {
        console.log('🔄 Variant 재고 변경:', payload)

        // 로컬 variants 업데이트
        setVariants(prev => prev.map(v =>
          v.id === payload.new.id
            ? { ...v, inventory: payload.new.inventory }
            : v
        ))

        // 현재 선택된 variant가 품절되었는지 확인
        if (selectedVariant?.id === payload.new.id && payload.new.inventory === 0) {
          toast.error('선택한 옵션이 품절되었습니다')
        }
      }
    )
    .subscribe()

  return () => {
    supabase.removeChannel(channel)
  }
}, [productId])
```

### 4.2 관리자 재고 수정 시 즉시 반영

```javascript
// app/admin/products/catalog/[id]/edit/page.js

const updateInventory = async (variantId, newInventory) => {
  const { error } = await supabase
    .from('product_variants')
    .update({
      inventory: newInventory,
      updated_at: new Date().toISOString()
    })
    .eq('id', variantId)

  if (!error) {
    toast.success('재고가 업데이트되었습니다')
    // Realtime으로 자동 전파됨!
  }
}
```

### 4.3 라이브 방송 중 상품 추가 실시간 반영

```javascript
// app/admin/broadcasts/page.js

const addProductToBroadcast = async (productId) => {
  const { error } = await supabase
    .from('products')
    .update({
      is_live: true,
      live_started_at: new Date().toISOString()
    })
    .eq('id', productId)

  // 사용자 화면에서 즉시 나타남 (Realtime 구독 덕분)
}
```

---

## Phase 5: 팀별 데이터 대시보드 📊
**우선순위**: ⭐⭐⭐
**예상 소요**: 1.5일

### 5.1 배송팀 대시보드

**경로**: `/admin/shipping/dashboard`

**제공 데이터**:
```javascript
// 오늘의 배송 현황
- 발송 대기: X건
- 발송 완료: X건
- 배송 중: X건

// 지역별 배송 통계
- 제주: X건 (도서산간 +3000원)
- 울릉도: X건 (도서산간 +5000원)
- 기타 도서산간: X건

// 택배사별 현황
- 한진택배: X건
- CJ대한통운: X건

// 긴급 배송 알림
- 2일 이상 미발송: X건 (빨간색 표시)
```

**다운로드 기능**:
- [ ] 오늘 발송 대기 목록 (Excel)
- [ ] 주소 라벨 출력 (PDF)
- [ ] 송장 번호 입력 템플릿 (Excel)

### 5.2 물류팀 대시보드

**경로**: `/admin/logistics/dashboard`

**제공 데이터**:
```javascript
// 재고 현황
- 재고 부족 (10개 이하): X개 상품
- 품절: X개 상품
- 재고 회전율 상위: Top 10

// 발주 필요 상품
- 자동 계산: (평균 일 판매량 × 리드타임) - 현재고
- 긴급 발주 필요: X개 상품

// 입고 예정
- 오늘: X건
- 이번 주: X건

// 창고별 재고
- A창고: X개 상품
- B창고: X개 상품
```

**자동 알림**:
```javascript
// 재고 부족 알림 (매일 오전 9시)
async function checkLowInventory() {
  const lowStockProducts = await supabase
    .from('product_variants')
    .select('*, products(*)')
    .lte('inventory', 10)
    .order('inventory', { ascending: true })

  // 슬랙/이메일 알림
  sendSlackNotification({
    channel: '#logistics',
    message: `⚠️ 재고 부족 상품 ${lowStockProducts.length}개`
  })
}
```

### 5.3 발주 시스템 개선

**자동 발주 제안**:
```javascript
// 발주 추천 로직
function calculateReorderQuantity(variant) {
  // 최근 30일 평균 판매량
  const avgDailySales = variant.sales_last_30_days / 30

  // 리드타임 (예: 7일)
  const leadTime = 7

  // 안전 재고 (예: 14일치)
  const safetyStock = avgDailySales * 14

  // 발주 수량 = (평균 일 판매량 × 리드타임) + 안전 재고 - 현재고
  const reorderQty = (avgDailySales * leadTime) + safetyStock - variant.inventory

  return Math.max(0, Math.ceil(reorderQty))
}
```

---

## Phase 6: 성능 최적화 ⚡
**우선순위**: ⭐⭐⭐
**예상 소요**: 1일

### 6.1 로그 최적화

#### 프로덕션 환경에서 로그 제거
```javascript
// lib/logger.js (새 파일)

const IS_PRODUCTION = process.env.NODE_ENV === 'production'

export const logger = {
  debug: (...args) => {
    if (!IS_PRODUCTION) {
      console.log('🔍', ...args)
    }
  },

  info: (...args) => {
    if (!IS_PRODUCTION) {
      console.log('ℹ️', ...args)
    }
  },

  warn: (...args) => {
    console.warn('⚠️', ...args)
  },

  error: (...args) => {
    console.error('❌', ...args)
    // 프로덕션에서는 에러 로깅 서비스로 전송
    if (IS_PRODUCTION) {
      // Sentry.captureException(args[0])
    }
  }
}

// 사용법
import { logger } from '@/lib/logger'
logger.debug('디버그 정보') // 개발 환경에서만 출력
logger.error('에러 발생') // 항상 출력 + Sentry 전송
```

#### 기존 console.log 일괄 변경
```bash
# 전체 프로젝트에서 console.log → logger.debug 변경
find app lib -name "*.js" -o -name "*.jsx" | xargs sed -i '' 's/console.log/logger.debug/g'
```

### 6.2 이미지 최적화

#### Next.js Image 컴포넌트 사용
```javascript
// BEFORE
<img src={product.thumbnail_url} alt={product.title} />

// AFTER
import Image from 'next/image'
<Image
  src={product.thumbnail_url}
  alt={product.title}
  width={400}
  height={400}
  loading="lazy"
  placeholder="blur"
  blurDataURL="data:image/svg+xml;base64,..."
/>
```

#### 이미지 CDN 최적화 (Supabase Storage)
```javascript
// lib/imageUtils.js

export function getOptimizedImageUrl(url, options = {}) {
  const { width = 800, quality = 80, format = 'webp' } = options

  // Supabase Storage Transform API
  return `${url}?width=${width}&quality=${quality}&format=${format}`
}

// 사용법
<img src={getOptimizedImageUrl(product.thumbnail_url, { width: 400 })} />
```

### 6.3 번들 크기 최적화

#### 동적 import 사용
```javascript
// BEFORE
import { motion } from 'framer-motion'

// AFTER (사용 시점에만 로드)
const motion = dynamic(() => import('framer-motion').then(mod => ({ default: mod.motion })))
```

#### 분석 도구 실행
```bash
# Bundle Analyzer 설치
npm install --save-dev @next/bundle-analyzer

# next.config.js 수정
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
})

module.exports = withBundleAnalyzer({
  // 기존 설정
})

# 분석 실행
ANALYZE=true npm run build
```

### 6.4 데이터베이스 쿼리 최적화

#### 인덱스 추가
```sql
-- 자주 조회되는 컬럼에 인덱스 추가
CREATE INDEX idx_orders_status_created ON orders(status, created_at DESC);
CREATE INDEX idx_orders_user_created ON orders(user_id, created_at DESC);
CREATE INDEX idx_products_live ON products(is_live) WHERE is_live = true;
CREATE INDEX idx_variants_inventory ON product_variants(inventory) WHERE inventory > 0;
```

#### N+1 쿼리 방지
```javascript
// BEFORE (N+1 문제)
const orders = await getOrders()
for (const order of orders) {
  order.items = await getOrderItems(order.id) // 반복 쿼리!
}

// AFTER (JOIN 사용)
const orders = await supabase
  .from('orders')
  .select(`
    *,
    order_items(*)
  `)
```

---

## Phase 7: 보안 강화 🔒
**우선순위**: ⭐⭐⭐⭐
**예상 소요**: 1일

### 7.1 관리자 인증 시스템

#### 관리자 권한 체크
```sql
-- profiles 테이블에 role 컬럼 추가
ALTER TABLE profiles
ADD COLUMN role VARCHAR(20) DEFAULT 'user';

-- role 값: 'user', 'admin', 'super_admin'

-- 인덱스 추가
CREATE INDEX idx_profiles_role ON profiles(role);
```

#### 미들웨어 보호
```javascript
// middleware.js

export function middleware(request) {
  const { pathname } = request.nextUrl

  // 관리자 페이지 접근 체크
  if (pathname.startsWith('/admin')) {
    const session = request.cookies.get('supabase-auth-token')

    if (!session) {
      return NextResponse.redirect(new URL('/admin/login', request.url))
    }

    // 추가: 역할 확인 (서버 사이드에서)
    // 실제 구현 시 Supabase Auth에서 사용자 role 확인
  }

  return NextResponse.next()
}

export const config = {
  matcher: '/admin/:path*'
}
```

#### 관리자 로그인 페이지 개선
```javascript
// app/admin/login/page.js

export default function AdminLoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')

  const handleLogin = async (e) => {
    e.preventDefault()

    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password
    })

    if (error) {
      toast.error('로그인 실패')
      return
    }

    // 관리자 권한 확인
    const { data: profile } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', data.user.id)
      .single()

    if (profile?.role !== 'admin' && profile?.role !== 'super_admin') {
      await supabase.auth.signOut()
      toast.error('관리자 권한이 없습니다')
      return
    }

    router.push('/admin')
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
        <h1 className="text-2xl font-bold mb-6 text-center">관리자 로그인</h1>
        <form onSubmit={handleLogin}>
          <input
            type="email"
            placeholder="이메일"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full px-4 py-2 border rounded mb-4"
            required
          />
          <input
            type="password"
            placeholder="비밀번호"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full px-4 py-2 border rounded mb-4"
            required
          />
          <button
            type="submit"
            className="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700"
          >
            로그인
          </button>
        </form>
      </div>
    </div>
  )
}
```

### 7.2 콘솔 로그 숨기기 (소스 보호)

#### 프로덕션 빌드 시 console 제거
```javascript
// next.config.js

module.exports = {
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production' ? {
      exclude: ['error', 'warn'], // error, warn은 유지
    } : false,
  },
}
```

#### 소스코드 난독화
```bash
# 난독화 플러그인 설치
npm install --save-dev webpack-obfuscator

# next.config.js에 추가
const WebpackObfuscator = require('webpack-obfuscator')

module.exports = {
  webpack: (config, { isServer }) => {
    if (!isServer && process.env.NODE_ENV === 'production') {
      config.plugins.push(
        new WebpackObfuscator({
          rotateStringArray: true,
          stringArray: true,
          stringArrayThreshold: 0.75
        })
      )
    }
    return config
  }
}
```

### 7.3 API 보안

#### Rate Limiting
```javascript
// lib/rateLimiter.js

const rateLimit = new Map()

export function checkRateLimit(identifier, limit = 10, windowMs = 60000) {
  const now = Date.now()
  const userRequests = rateLimit.get(identifier) || []

  // 오래된 요청 제거
  const recentRequests = userRequests.filter(time => now - time < windowMs)

  if (recentRequests.length >= limit) {
    return false // 제한 초과
  }

  recentRequests.push(now)
  rateLimit.set(identifier, recentRequests)

  return true // 허용
}

// API 라우트에서 사용
export async function POST(request) {
  const ip = request.headers.get('x-forwarded-for') || 'unknown'

  if (!checkRateLimit(ip, 10, 60000)) {
    return NextResponse.json(
      { error: '요청이 너무 많습니다. 잠시 후 다시 시도해주세요.' },
      { status: 429 }
    )
  }

  // 정상 처리
}
```

#### CSRF 토큰
```javascript
// lib/csrf.js

export function generateCSRFToken() {
  return crypto.randomBytes(32).toString('hex')
}

export function validateCSRFToken(token, sessionToken) {
  return token === sessionToken
}

// API 라우트에서 사용
export async function POST(request) {
  const csrfToken = request.headers.get('x-csrf-token')
  const sessionToken = request.cookies.get('csrf-token')

  if (!validateCSRFToken(csrfToken, sessionToken)) {
    return NextResponse.json({ error: 'Invalid CSRF token' }, { status: 403 })
  }

  // 정상 처리
}
```

---

## 📅 예상 일정

| Phase | 작업 내용 | 우선순위 | 예상 소요 | 시작일 |
|-------|----------|---------|----------|--------|
| 1 | 모바일 입력 필드 가시성 완전 해결 | ⭐⭐⭐⭐⭐ | 2-3시간 | 2025-10-04 |
| 2 | 쿠폰 시스템 구축 | ⭐⭐⭐⭐ | 1일 | 2025-10-04 |
| 3 | 한진택배 송장 자동화 | ⭐⭐⭐⭐ | 2일 | 2025-10-05 |
| 4 | 실시간 재고 동기화 | ⭐⭐⭐⭐ | 1일 | 2025-10-07 |
| 5 | 팀별 대시보드 구축 | ⭐⭐⭐ | 1.5일 | 2025-10-08 |
| 6 | 성능 최적화 | ⭐⭐⭐ | 1일 | 2025-10-09 |
| 7 | 보안 강화 | ⭐⭐⭐⭐ | 1일 | 2025-10-10 |

**총 예상 소요**: 약 8-9일

---

## ✅ 각 Phase 완료 체크리스트

### Phase 1 완료 조건
- [ ] 모든 모바일 기기에서 input 텍스트 선명하게 보임
- [ ] placeholder 대비 적절
- [ ] 다크모드 지원
- [ ] 라디오/체크박스 정상 작동

### Phase 2 완료 조건
- [ ] 쿠폰 DB 테이블 생성
- [ ] 쿠폰 검증 로직 구현
- [ ] 체크아웃에 쿠폰 적용
- [ ] 관리자 쿠폰 관리 페이지
- [ ] 쿠폰 사용 내역 조회

### Phase 3 완료 조건
- [ ] 한진택배 엑셀 업로드 기능
- [ ] 송장번호 자동 입력
- [ ] 발송완료 상태 자동 변경
- [ ] 송장 다운로드 기능

### Phase 4 완료 조건
- [ ] 상품 Realtime 구독
- [ ] Variant 재고 Realtime 업데이트
- [ ] 관리자 수정 시 즉시 반영
- [ ] 품절 시 자동 알림

### Phase 5 완료 조건
- [ ] 배송팀 대시보드 구축
- [ ] 물류팀 대시보드 구축
- [ ] 재고 부족 자동 알림
- [ ] 발주 제안 시스템

### Phase 6 완료 조건
- [ ] logger 시스템 적용
- [ ] 이미지 최적화
- [ ] 번들 크기 20% 감소
- [ ] 쿼리 성능 개선

### Phase 7 완료 조건
- [ ] 관리자 role 기반 인증
- [ ] 콘솔 로그 프로덕션 제거
- [ ] 소스코드 난독화
- [ ] API Rate Limiting

---

## 🎯 다음 작업 시 우선순위

**즉시 시작** (2025-10-04):
1. ⭐⭐⭐⭐⭐ Phase 1: 모바일 입력 가시성 (2-3시간)
2. ⭐⭐⭐⭐ Phase 2: 쿠폰 시스템 (1일)

**이어서 진행**:
3. Phase 3 → 4 → 7 → 5 → 6 순서 권장

---

**작성일**: 2025-10-03
**작성자**: Claude Code
**문서 버전**: 1.0
