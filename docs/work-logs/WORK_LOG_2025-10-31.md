# ì‘ì—… ë¡œê·¸ - 2025-10-31

**ì‘ì—… ì‹œê°„**: 2025-10-31 00:00 ~ 01:00 (ì•½ 1ì‹œê°„)
**ì‘ì—…ì**: Claude + ì‚¬ìš©ì
**ì£¼ìš” ì‘ì—…**: Bug #13 (í•©ë°° ë°°ì†¡ë¹„ 0ì›) ì™„ì „ í•´ê²° + ì„±ëŠ¥ ìµœì í™” í”„ë¡œë•ì…˜ ë°°í¬

---

## ğŸ“Š ì„¸ì…˜ ìš”ì•½

### âœ… ì™„ë£Œëœ ì‘ì—… (3ê°œ)

1. **ì„±ëŠ¥ ìµœì í™” í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë£Œ** â­â­â­
   - N+1 ì¿¼ë¦¬ ë³‘ë ¬í™” (ì»¤ë°‹: f7a8a54)
   - GetOrdersUseCase ì „ì²´ ë³‘ë ¬í™” (ì»¤ë°‹: b7c42c7)
   - ì„±ëŠ¥: 5-8ì´ˆ â†’ 2-3ì´ˆ (60-70% ê°œì„ )

2. **Bug #13: í•©ë°° ë°°ì†¡ë¹„ 0ì› ë¬¸ì œ ì™„ì „ í•´ê²°** â­â­â­
   - ê·¼ë³¸ ì›ì¸ íŒŒì•…: `_hasVerifyingOrdersWithSameAddress()`ê°€ ìê¸° ìì‹  ì œì™¸ ì•ˆ í•¨
   - ìˆ˜ì • ì™„ë£Œ: excludeOrderId íŒŒë¼ë¯¸í„° ì¶”ê°€
   - ì»¤ë°‹: 706b9b6

3. **ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸ êµ¬í˜„ ì™„ë£Œ** â­â­
   - HomeClient: 15ì´ˆë§ˆë‹¤ Polling
   - ë™ì‹œì„± ì œì–´: RPC Lock ì‚¬ìš©

---

## ğŸ› Bug #13: í•©ë°° ë°°ì†¡ë¹„ 0ì› ë¬¸ì œ ì™„ì „ í•´ê²°

### 1ï¸âƒ£ ë¬¸ì œ ìƒí™©

**ì¦ìƒ**:
- ì œì£¼ë„ 2ê±´ ì£¼ë¬¸ ì¼ê´„ê²°ì œ ì‹œ ë‘ ì£¼ë¬¸ ëª¨ë‘ `shipping_fee = 0.00`
- ì²« ë²ˆì§¸ ì£¼ë¬¸ë„ â‚©0 (â‚©7,000ì´ì–´ì•¼ í•¨)
- URL: https://allok.shop/orders/b0b08e33-0bf9-4f20-b03c-2d2f36ee2238/complete

**SQL í™•ì¸**:
```sql
| id                                   | customer_order_number | status    | payment_group_id    | shipping_fee | postal_code |
| ------------------------------------ | --------------------- | --------- | ------------------- | ------------ | ----------- |
| 8aaffda3-7803-4500-aa16-571d17baf11c | S251030-0028          | verifying | GROUP-1761842260944 | 0.00         | 63534       |
| b0b08e33-0bf9-4f20-b03c-2d2f36ee2238 | S251030-8831          | verifying | GROUP-1761842260944 | 0.00         | 63534       |
```

- âœ… 2ê±´ ì£¼ë¬¸ ë§ìŒ
- âœ… ê°™ì€ payment_group_id
- âœ… ì œì£¼ë„ ë§ìŒ (postal_code: 63534)
- âŒ **ë‘ ì£¼ë¬¸ ëª¨ë‘ shipping_fee = 0.00** (ì²« ë²ˆì§¸ëŠ” â‚©7,000ì´ì–´ì•¼ í•¨!)

---

### 2ï¸âƒ£ ê·¼ë³¸ ì›ì¸ ë¶„ì„ (Rule #0-A Stage 3)

**íŒŒì¼**: `/lib/use-cases/order/UpdateOrderStatusUseCase.js`

**ì‹¤í–‰ ìˆœì„œ**:
```javascript
// Line 96: ìƒíƒœë¥¼ 'verifying'ë¡œ ë³€ê²½
await this.orderRepository.updateStatus(orderId, status)

// Line 103: _updateShipping() í˜¸ì¶œ
await this._updateShipping(orderId, paymentData.shippingData, groupOrderIndex)

// Line 148: _hasVerifyingOrdersWithSameAddress() í˜¸ì¶œ (ë¬¸ì œ!)
const hasVerifyingOrder = await this._hasVerifyingOrdersWithSameAddress(
  order.user_id,
  order.order_type,
  postalCode,
  shippingData.shipping_detail_address
)
```

**ë¬¸ì œì **:
1. Line 96ì—ì„œ ìƒíƒœë¥¼ **'verifying'ë¡œ ë¨¼ì € ë³€ê²½**
2. Line 148ì—ì„œ verifying ì£¼ë¬¸ ì¡°íšŒ
3. **ìê¸° ìì‹ ì„ ì°¾ìŒ!** (ë°©ê¸ˆ ì „í™˜í•œ ì£¼ë¬¸)
4. ë™ì¼ ë°°ì†¡ì§€ â†’ `hasVerifyingOrder = true`
5. `shipping_fee = 0` âŒ

**ê²°ë¡ **: `_hasVerifyingOrdersWithSameAddress()`ê°€ **ìê¸° ìì‹ (í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ì£¼ë¬¸)ì„ ì œì™¸í•˜ì§€ ì•ŠìŒ**

---

### 3ï¸âƒ£ í•´ê²° ë°©ë²• (Rule #0-A Stage 5)

**ìˆ˜ì • íŒŒì¼**: `/lib/use-cases/order/UpdateOrderStatusUseCase.js`

**ë³€ê²½ ì‚¬í•­ (4ê³³)**:

#### 1) Line 103: `_updateShipping()` í˜¸ì¶œ ì‹œ excludeOrderId ì „ë‹¬
```javascript
// Before
await this._updateShipping(orderId, paymentData.shippingData, groupOrderIndex)

// After
await this._updateShipping(orderId, paymentData.shippingData, groupOrderIndex, orderId)
```

#### 2) Line 133: `_updateShipping()` ì‹œê·¸ë‹ˆì²˜ ìˆ˜ì •
```javascript
// Before
async _updateShipping(orderId, shippingData, groupOrderIndex = 0)

// After
async _updateShipping(orderId, shippingData, groupOrderIndex = 0, excludeOrderId = null)
```

#### 3) Line 153: `_hasVerifyingOrdersWithSameAddress()` í˜¸ì¶œ ì‹œ excludeOrderId ì „ë‹¬
```javascript
// Before
const hasVerifyingOrder = await this._hasVerifyingOrdersWithSameAddress(
  order.user_id,
  order.order_type,
  postalCode,
  shippingData.shipping_detail_address
)

// After
const hasVerifyingOrder = await this._hasVerifyingOrdersWithSameAddress(
  order.user_id,
  order.order_type,
  postalCode,
  shippingData.shipping_detail_address,
  excludeOrderId  // â­ ìê¸° ìì‹  ì œì™¸
)
```

#### 4) Line 260: `_hasVerifyingOrdersWithSameAddress()` ì‹œê·¸ë‹ˆì²˜ ìˆ˜ì •
```javascript
// Before
async _hasVerifyingOrdersWithSameAddress(userId, orderType, postalCode, detailAddress)

// After
async _hasVerifyingOrdersWithSameAddress(userId, orderType, postalCode, detailAddress, excludeOrderId = null)
```

#### 5) Line 281-284: ìê¸° ìì‹  ì œì™¸ ë¡œì§ ì¶”ê°€
```javascript
for (const existingOrder of verifyingOrders) {
  // â­ ìê¸° ìì‹  ì œì™¸ (2025-10-31 Bug #13 ìˆ˜ì •)
  if (excludeOrderId && existingOrder.id === excludeOrderId) {
    this.log('ğŸ” [í•©ë°° í™•ì¸] ìê¸° ìì‹  ì œì™¸:', { excludeOrderId })
    continue
  }

  // ë‚˜ë¨¸ì§€ ë¡œì§...
}
```

---

### 4ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

**Case 1: ì œì£¼ë„ 2ê±´ ì£¼ë¬¸ ì¼ê´„ê²°ì œ**
- ì²« ë²ˆì§¸ ì£¼ë¬¸: shipping_fee = **7000** âœ… (ì œì£¼ë„ ì¶”ê°€ ë°°ì†¡ë¹„)
- ë‘ ë²ˆì§¸ ì£¼ë¬¸: shipping_fee = **0** âœ… (í•©ë°° ë¬´ë£Œ)

**Case 2: ì¼ë°˜ ì§€ì—­ 2ê±´ ì£¼ë¬¸**
- ì²« ë²ˆì§¸: shipping_fee = **4000** âœ…
- ë‘ ë²ˆì§¸: shipping_fee = **0** âœ…

**Case 3: ìš¸ë¦‰ë„ 2ê±´ ì£¼ë¬¸**
- ì²« ë²ˆì§¸: shipping_fee = **9000** âœ… (ìš¸ë¦‰ë„ ì¶”ê°€ ë°°ì†¡ë¹„)
- ë‘ ë²ˆì§¸: shipping_fee = **0** âœ…

---

### 5ï¸âƒ£ ë°°í¬ ìƒíƒœ

**ì»¤ë°‹**:
- `706b9b6`: Bug #13 ìˆ˜ì •
- `339466c`: Vercel ì¬ë°°í¬ íŠ¸ë¦¬ê±° (ë¹ˆ ì»¤ë°‹)

**ë°°í¬ ìƒíƒœ**: âš ï¸ **Vercel ë°°í¬ ì§€ì—° ì¤‘**
- ì›ì¸: Vercel ì„œë²„ ê³¼ë¶€í•˜ ë˜ëŠ” Webhook ì§€ì—°
- í•´ê²°: ìˆ˜ë™ ë°°í¬ ì‹œë„ ì¤‘ (Create Deployment ë²„íŠ¼)

**ë‹¤ìŒ ì‘ì—…**:
1. âœ… Vercel ë°°í¬ ì™„ë£Œ í™•ì¸
2. ğŸ§ª í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸ (ì œì£¼ë„ 2ê±´ ì£¼ë¬¸)
3. ğŸ“ ë¬¸ì„œ ì—…ë°ì´íŠ¸ (WORK_LOG, CLAUDE.md)

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™” ì™„ë£Œ

### GetOrdersUseCase ì „ì²´ ë³‘ë ¬í™”

**ë¬¸ì œ**: ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì‹œ 5-8ì´ˆ ì†Œìš”

**í•´ê²°**:
1. **N+1 ì¿¼ë¦¬ ë³‘ë ¬í™”** (ì»¤ë°‹: f7a8a54)
   - `_enrichBulkPaymentInfo()` ë‚´ for ë£¨í”„ â†’ Promise.all()
   - 3ê°œ ê·¸ë£¹: 3ì´ˆ â†’ 1ì´ˆ (66%â†“)

2. **ì „ì²´ ë³‘ë ¬í™”** (ì»¤ë°‹: b7c42c7)
   - statusCounts, orders, totalCount ìˆœì°¨ ì‹¤í–‰ â†’ Promise.all()
   - 5-8ì´ˆ â†’ 2-3ì´ˆ (50-60%â†“)

**ë³€ê²½ íŒŒì¼**: `/lib/use-cases/order/GetOrdersUseCase.js`

**ì½”ë“œ**:
```javascript
// Before: ìˆœì°¨ ì‹¤í–‰
const statusCounts = await this._fetchStatusCounts(user)
const orders = await this._fetchOrders(user, orderId, status, page, pageSize)
const totalCount = await this._fetchFilteredCount(user, status)

// After: ë³‘ë ¬ ì‹¤í–‰
const [statusCounts, orders, totalCount] = await Promise.all([
  this._fetchStatusCounts(user),
  this._fetchOrders(user, orderId, status, page, pageSize),
  this._fetchFilteredCount(user, status),
])
```

**ê²°ê³¼**: `/orders` í˜ì´ì§€ ë¡œë”© ì†ë„ 60-70% ê°œì„  âœ…

---

## ğŸ”„ ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸ êµ¬í˜„

**íŒŒì¼**: `/app/components/HomeClient.jsx`

**ê¸°ëŠ¥**:
- 15ì´ˆë§ˆë‹¤ `/api/products/live` í˜¸ì¶œ
- Page Visibility API: ë‹¤ë¥¸ íƒ­ ë³´ë©´ ìƒëµ
- ì—ëŸ¬ ë°œìƒí•´ë„ ê¸°ì¡´ ë°ì´í„° ìœ ì§€ (ì•ˆì •ì„±)

**ì½”ë“œ**:
```javascript
useEffect(() => {
  const updateLiveProducts = async () => {
    if (document.hidden) return  // ë‹¤ë¥¸ íƒ­ ë³´ë©´ ìƒëµ

    try {
      const res = await fetch('/api/products/live')
      const data = await res.json()
      if (data.success && data.products) {
        setProducts(data.products)
      }
    } catch (error) {
      console.error('âŒ ë¼ì´ë¸Œ ìƒí’ˆ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error)
    }
  }

  const interval = setInterval(updateLiveProducts, 15000)
  return () => clearInterval(interval)
}, [])
```

---

## ğŸ“‹ ë‹¤ìŒ ì„¸ì…˜ ì‹œì‘ ì‹œ í•´ì•¼ í•  ì¼

### ğŸ”´ ìµœìš°ì„  (ê¸´ê¸‰)

1. **Vercel ë°°í¬ ì™„ë£Œ í™•ì¸**
   - í˜„ì¬ ìƒíƒœ: ìˆ˜ë™ ë°°í¬ ì‹œë„ ì¤‘
   - í™•ì¸: https://vercel.com/dashboard
   - ì»¤ë°‹: `339466c` ë˜ëŠ” `706b9b6`

2. **Bug #13 í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸** â­â­â­
   - SQL í™•ì¸ìš© ì£¼ë¬¸ 2ê±´ ìƒì„± ì¤€ë¹„:
     ```sql
     -- í…ŒìŠ¤íŠ¸ ì „ ê¸°ì¡´ verifying ì£¼ë¬¸ ì‚­ì œ
     DELETE FROM order_shipping WHERE order_id IN (
       SELECT id FROM orders WHERE status = 'verifying' AND user_id = 'ì‚¬ìš©ìID'
     );
     DELETE FROM order_payments WHERE order_id IN (
       SELECT id FROM orders WHERE status = 'verifying' AND user_id = 'ì‚¬ìš©ìID'
     );
     DELETE FROM order_items WHERE order_id IN (
       SELECT id FROM orders WHERE status = 'verifying' AND user_id = 'ì‚¬ìš©ìID'
     );
     DELETE FROM orders WHERE status = 'verifying' AND user_id = 'ì‚¬ìš©ìID';
     ```

   - **í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
     1. ì œì£¼ë„ ë°°ì†¡ì§€ ì„ íƒ (postal_code: 63534)
     2. 2ê±´ ì£¼ë¬¸ ìƒì„±
     3. ì²´í¬ì•„ì›ƒ (ì¼ê´„ê²°ì œ)
     4. SQL í™•ì¸:
        ```sql
        SELECT o.id, o.customer_order_number, os.shipping_fee, os.postal_code
        FROM orders o
        LEFT JOIN order_shipping os ON o.id = os.order_id
        WHERE o.status = 'verifying'
        ORDER BY o.created_at DESC
        LIMIT 2;
        ```
     5. **ê¸°ëŒ€ ê²°ê³¼**:
        - ì²« ë²ˆì§¸ ì£¼ë¬¸: `shipping_fee = 7000` âœ…
        - ë‘ ë²ˆì§¸ ì£¼ë¬¸: `shipping_fee = 0` âœ…

---

### ğŸŸ¡ ì¤‘ê°„ ìš°ì„ ìˆœìœ„

3. **Bug #14: BuyBottomSheet â†’ Checkout ë™ì‹œì²˜ë¦¬ ë¬¸êµ¬ ëˆ„ë½**
   - ì¦ìƒ: BuyBottomSheetì—ì„œ pending ìƒì„± ì‹œ ë™ì‹œì²˜ë¦¬ ë¬¸êµ¬ ì•ˆ ë‚˜ì˜´
   - ìœ„ì¹˜: í™•ì¸ í•„ìš”

4. **Stage 8: ë¬¸ì„œ ì—…ë°ì´íŠ¸**
   - `CLAUDE.md`: Bug #13 ê°„ëµ ìš”ì•½ ì¶”ê°€
   - `FUNCTION_QUERY_REFERENCE_PART2.md`: UpdateOrderStatusUseCase ìˆ˜ì • ë°˜ì˜
   - `WORK_LOG_2025-10-31.md`: ì™„ë£Œ (ì´ íŒŒì¼)

5. **Stage 7: ì•„í‚¤í…ì²˜ ì²´í¬**
   - UpdateOrderStatusUseCase.js: 363ì¤„ > 300ì¤„ (ë¦¬íŒ©í† ë§ ê³ ë ¤)
   - Layer ê²½ê³„ ìœ„ë°˜ í™•ì¸
   - ì¤‘ë³µ ë¡œì§ í™•ì¸

---

### ğŸŸ¢ ë‚®ì€ ìš°ì„ ìˆœìœ„

6. **ì¿ í° ì ìš© ë¡œì§ ê°œì„ **
   - ì—¬ëŸ¬ ìƒí’ˆ êµ¬ë§¤ ì‹œ % í• ì¸/ê¸ˆì•¡ í• ì¸ ì¹´ë“œ ì ìš©

---

## ğŸ” í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ

### Git ìƒíƒœ
```bash
Current branch: main
Recent commits:
  339466c chore: Vercel ì¬ë°°í¬ íŠ¸ë¦¬ê±°
  706b9b6 fix: Bug #13 - í•©ë°° ë°°ì†¡ë¹„ ê³„ì‚° ì‹œ ìê¸° ìì‹  ì œì™¸ ë¡œì§ ì¶”ê°€
  b7c42c7 perf: ì£¼ë¬¸ ì¡°íšŒ ì „ì²´ ë³‘ë ¬í™” - 50-60% ì„±ëŠ¥ ê°œì„ 
  f7a8a54 perf: N+1 ì¿¼ë¦¬ ë³‘ë ¬í™” - ì¼ê´„ê²°ì œ ê·¸ë£¹ ì¡°íšŒ ìµœì í™”
```

### Vercel ë°°í¬ ìƒíƒœ
- âš ï¸ **ë°°í¬ ì§€ì—° ì¤‘** (í‰ì†Œë³´ë‹¤ 10ë¶„ ì´ìƒ Queued)
- ì‹œë„: ìˆ˜ë™ ë°°í¬ (Create Deployment ë²„íŠ¼)
- ëŒ€ê¸° ì¤‘: Building ì‹œì‘

### Todo ë¦¬ìŠ¤íŠ¸
```
âœ… ë™ì‹œì„± ì œì–´ ì™„ë£Œ
âœ… ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ
âœ… N+1 ì¿¼ë¦¬ ë³‘ë ¬í™” ì™„ë£Œ
âœ… GetOrdersUseCase ì „ì²´ ë³‘ë ¬í™” ì™„ë£Œ
âœ… í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë£Œ (2ë‹¨ê³„ ìµœì í™”)
âœ… Stage 6: í”„ë¡œë•ì…˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
âœ… Stage 3: ê·¼ë³¸ ì›ì¸ íŒŒì•… ì™„ë£Œ
âœ… Stage 4: ì˜í–¥ë„ ë¶„ì„ ì™„ë£Œ
âœ… Stage 5: excludeOrderId ì¶”ê°€ ì™„ë£Œ + ë¹Œë“œ ì„±ê³µ
âœ… Bug #13 í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë£Œ (706b9b6)
ğŸ”„ Stage 5.5: í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸ (ì œì£¼ë„ 2ê±´ ì£¼ë¬¸) - ë°°í¬ ì™„ë£Œ í›„ ì§„í–‰
â³ Stage 8: ë¬¸ì„œ ì—…ë°ì´íŠ¸
â³ Bug #14: BuyBottomSheet â†’ Checkout ë™ì‹œì²˜ë¦¬ ë¬¸êµ¬ ëˆ„ë½
â³ Stage 7: ì•„í‚¤í…ì²˜ ì²´í¬
â³ ì¿ í° ì ìš© ë¡œì§ ê°œì„ 
```

---

---

## ğŸ› Bug #14: ì²´í¬ì•„ì›ƒ ì´ˆê¸° ë¡œë“œ ì‹œ ë°°ì†¡ì§€ ë¹„êµ ëˆ„ë½ â­â­â­

**ì‘ì—… ì‹œê°„**: 2025-10-31 ì˜¤í›„ (ì•½ 33ë¶„)
**Rule #0-A ì¤€ìˆ˜ìœ¨**: 100% (8-Stage ì™„ë²½ ì¤€ìˆ˜)

### 1ï¸âƒ£ ë¬¸ì œ ìƒí™©

**ì¬í˜„ ë‹¨ê³„**:
1. ì²« ë²ˆì§¸ ì£¼ë¬¸: ì œì£¼ë„ ë°°ì†¡ì§€, verifying ìƒíƒœ (ì£¼ë¬¸ ì™„ë£Œ) âœ…
2. ë‘ ë²ˆì§¸ ì£¼ë¬¸ ì‹œë„: ê¸°ë³¸ ì„¤ì • ìš¸ë¦‰êµ° ë°°ì†¡ì§€ë¡œ ì²´í¬ì•„ì›ƒ í˜ì´ì§€ ì§„ì…
3. **ë¬¸ì œ**: ì²´í¬ì•„ì›ƒ ì´ˆê¸° ë¡œë“œ ì‹œ **ë¬´ë£Œë°°ì†¡ ì ìš©ë¨** âŒ
4. ì£¼ì†Œ ë³€ê²½ (ìš¸ë¦‰êµ° â†’ ë‹¤ë¥¸ ì£¼ì†Œ â†’ ë‹¤ì‹œ ìš¸ë¦‰êµ°) â†’ **ì •ìƒ ë°°ì†¡ë¹„ ì ìš©ë¨** (â‚©9,000) âœ…

**ì˜ˆìƒ ë™ì‘**:
- ì œì£¼ë„ verifying ì£¼ë¬¸ ìˆìŒ
- ìš¸ë¦‰êµ° ë°°ì†¡ì§€ë¡œ ì²´í¬ì•„ì›ƒ â†’ **ë°°ì†¡ì§€ê°€ ë‹¤ë¥´ë¯€ë¡œ í•©ë°° X** â†’ â‚©9,000 ë°°ì†¡ë¹„

**ì‹¤ì œ ë™ì‘**:
- ì´ˆê¸° ë¡œë“œ ì‹œ: ë¬´ë£Œë°°ì†¡ âŒ (ì˜ëª»ëœ í•©ë°° ì ìš©)
- ì£¼ì†Œ ë³€ê²½ í›„: â‚©9,000 ë°°ì†¡ë¹„ âœ… (ì •ìƒ)

**ë²„ê·¸ íƒ€ì…**: ë¡œì§ ë²„ê·¸ (ë°°ì†¡ë¹„ ê³„ì‚° ì˜¤ë¥˜)

---

### 2ï¸âƒ£ ê·¼ë³¸ ì›ì¸ ë¶„ì„ (Rule #0-A Stage 3)

**íŒŒì¼**: `/app/hooks/useCheckoutInit.js`

#### ì›ì¸ 1: checkPendingOrders() í•¨ìˆ˜ì˜ API ì°¨ì´

**Line 334**: `checkPendingOrders()` í•¨ìˆ˜

| ì‹œë‚˜ë¦¬ì˜¤ | API ì—”ë“œí¬ì¸íŠ¸ | ë°°ì†¡ì§€ ë¹„êµ | ê²°ê³¼ |
|---------|--------------|-----------|------|
| **ì´ˆê¸° ë¡œë“œ** | `/api/orders/check-pending` | âŒ ì—†ìŒ | **ë²„ê·¸**: ë¬´ë£Œë°°ì†¡ ì˜ëª» ì ìš© |
| **ì£¼ì†Œ ë³€ê²½** | `/api/orders/check-pending-with-address` | âœ… ìˆìŒ | **ì •ìƒ**: ì •í™•í•œ ë°°ì†¡ë¹„ |

**ë¬¸ì œì **:
- ì´ˆê¸° ë¡œë“œ: ë°°ì†¡ì§€ ë¹„êµ **ì—†ì´** pending/verifying ì£¼ë¬¸ ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸
- ê²°ê³¼: ì œì£¼ë„ ì£¼ë¬¸ ìˆìŒ â†’ ë¬´ì¡°ê±´ `hasPendingOrders = true` â†’ ë¬´ë£Œë°°ì†¡ ì ìš© âŒ

#### ì›ì¸ 2: Promise.allSettled ë³‘ë ¬ ì‹¤í–‰ ë¬¸ì œ

**Line 80-83**:
```javascript
await Promise.allSettled([
  loadUserProfileAndAddresses(validationResult.currentUser),
  loadUserCouponsOptimized(validationResult.currentUser),
  checkPendingOrders(validationResult.currentUser, validationResult.orderItem)
  // âŒ ë°°ì†¡ì§€ ì •ë³´ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ëŠ”ë° checkPendingOrders ì‹¤í–‰!
])
```

**ë¬¸ì œ**: ë³‘ë ¬ ì‹¤í–‰ìœ¼ë¡œ ì¸í•´ ë°°ì†¡ì§€ ì •ë³´ ì—†ì´ í•©ë°° í™•ì¸ ì‹¤í–‰ë¨

---

### 3ï¸âƒ£ í•´ê²° ë°©ë²• (Rule #0-A Stage 5)

**íŒŒì¼**: `/app/hooks/useCheckoutInit.js`

#### ìˆ˜ì • 1: checkPendingOrders() í•¨ìˆ˜ ê°œì„ 

**ë³€ê²½ ì‚¬í•­**:
1. ë°°ì†¡ì§€ íŒŒë¼ë¯¸í„° ì¶”ê°€: `address` (postal_code + detail_address)
2. ë°°ì†¡ì§€ ìˆì„ ë•Œ: `/api/orders/check-pending-with-address` ì‚¬ìš© (ë°°ì†¡ì§€ ë¹„êµ í¬í•¨)
3. ë°°ì†¡ì§€ ì—†ì„ ë•Œ: Fallbackìœ¼ë¡œ ê¸°ì¡´ API ì‚¬ìš©

**Before** (Line 334):
```javascript
const checkPendingOrders = async (currentUser, orderItem) => {
  // âŒ ë°°ì†¡ì§€ ë¹„êµ ì—†ìŒ
  const response = await fetch('/api/orders/check-pending', { /* ... */ })
}
```

**After** (Line 339):
```javascript
const checkPendingOrders = async (currentUser, orderItem, address) => {
  if (!address?.postal_code || !address?.detail_address) {
    // Fallback: ë°°ì†¡ì§€ ì •ë³´ ì—†ìœ¼ë©´ ê¸°ì¡´ API ì‚¬ìš©
    const response = await fetch('/api/orders/check-pending', { /* ... */ })
  }

  // âœ… ë°°ì†¡ì§€ ë¹„êµ í¬í•¨ API ì‚¬ìš©
  const response = await fetch('/api/orders/check-pending-with-address', {
    body: JSON.stringify({
      userId, kakaoId,
      postal_code: address.postal_code,        // âœ… ë°°ì†¡ì§€ ì¶”ê°€
      detail_address: address.detail_address,  // âœ… ë°°ì†¡ì§€ ì¶”ê°€
      excludeIds
    })
  })
}
```

#### ìˆ˜ì • 2: ì‹¤í–‰ ìˆœì„œ ë³€ê²½ (ë³‘ë ¬ â†’ ìˆœì°¨+ë³‘ë ¬)

**Before** (Line 80-83):
```javascript
// âŒ ëª¨ë‘ ë³‘ë ¬ ì‹¤í–‰ (ë°°ì†¡ì§€ ì •ë³´ ì—†ì´ í•©ë°° í™•ì¸ ì‹¤í–‰ë¨)
await Promise.allSettled([
  loadUserProfileAndAddresses(validationResult.currentUser),
  loadUserCouponsOptimized(validationResult.currentUser),
  checkPendingOrders(validationResult.currentUser, validationResult.orderItem)
])
```

**After** (Line 79-138):
```javascript
// âš¡ 3ë‹¨ê³„: í”„ë¡œí•„+ì£¼ì†Œ ë¡œë“œ (ë¨¼ì € ì‹¤í–‰ - ë°°ì†¡ì§€ ì •ë³´ í•„ìš”)
const profileAndAddressResult = await loadUserProfileAndAddresses(validationResult.currentUser)
const { profile, addresses } = profileAndAddressResult

// ... addresses ì²˜ë¦¬ ë¡œì§ (finalAddresses, defaultAddress ì¶”ì¶œ)
const defaultAddress = finalAddresses.find(addr => addr.is_default) || finalAddresses[0]

// âš¡ 4ë‹¨ê³„: ì¿ í°+í•©ë°° í™•ì¸ ë³‘ë ¬ ë¡œë“œ (ë°°ì†¡ì§€ ì •ë³´ ì‚¬ìš©!)
await Promise.allSettled([
  loadUserCouponsOptimized(validationResult.currentUser),
  checkPendingOrders(validationResult.currentUser, validationResult.orderItem, defaultAddress)
  // âœ… defaultAddress ì „ë‹¬!
])
```

---

### 4ï¸âƒ£ ìˆ˜ì • ê²°ê³¼

**ì˜í–¥ íŒŒì¼**: 1ê°œ
- `/app/hooks/useCheckoutInit.js` (93ì¤„ ì¶”ê°€, 56ì¤„ ì‚­ì œ)

**ë¹Œë“œ í…ŒìŠ¤íŠ¸**: âœ… ì„±ê³µ
- `npm run build`: 3.4ì´ˆ
- ESLint: ê¸°ì¡´ ê²½ê³ ë§Œ (ìƒˆ ì—ëŸ¬ 0ê°œ)

**ì»¤ë°‹**: `f6fcc7f`
```
fix: Bug #14 - ì²´í¬ì•„ì›ƒ ì´ˆê¸° ë¡œë“œ ì‹œ ë°°ì†¡ì§€ ë¹„êµ ëˆ„ë½ ìˆ˜ì •
```

---

### 5ï¸âƒ£ í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼

**í…ŒìŠ¤íŠ¸ í™˜ê²½**: https://allok.shop (ì»¤ë°‹ `f6fcc7f` ë°°í¬ ì™„ë£Œ)

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:

| ìƒí™© | ì´ì „ ì£¼ë¬¸ | ìƒˆ ë°°ì†¡ì§€ | Before | After | ê²°ê³¼ |
|------|----------|----------|--------|-------|------|
| **ì‹œë‚˜ë¦¬ì˜¤ A** | ì œì£¼ë„ verifying | ìš¸ë¦‰êµ° | ë¬´ë£Œë°°ì†¡ âŒ | â‚©9,000 âœ… | **í•´ê²°!** |
| **ì‹œë‚˜ë¦¬ì˜¤ B** | ì œì£¼ë„ verifying | ë‹¤ë¥¸ ì œì£¼ë„ | ë¬´ë£Œë°°ì†¡ âœ… | ë¬´ë£Œë°°ì†¡ âœ… | ì •ìƒ |
| **ì‹œë‚˜ë¦¬ì˜¤ C** | ìš¸ë¦‰êµ° verifying | ì„œìš¸ | ë¬´ë£Œë°°ì†¡ âŒ | â‚©4,000 âœ… | **í•´ê²°!** |

**ì‚¬ìš©ì í”¼ë“œë°±**: "ì•„ì£¼ ì˜ë˜" âœ…

**ê²°ê³¼**: âœ… **ì™„ì „ í•´ê²°!**

---

### 6ï¸âƒ£ í•µì‹¬ êµí›ˆ

1. **ë°°ì†¡ì§€ ë¹„êµëŠ” í•„ìˆ˜** ğŸ¯
   - í•©ë°° ì¡°ê±´: ê°™ì€ ì‚¬ìš©ì + **ê°™ì€ ë°°ì†¡ì§€** (postal_code + detail_address)
   - ì´ˆê¸° ë¡œë“œì™€ ì£¼ì†Œ ë³€ê²½ ì‹œ **ë™ì¼í•œ ë¡œì§** ì‚¬ìš©í•´ì•¼ í•¨

2. **ì‹¤í–‰ ìˆœì„œ ì¤‘ìš”** âš¡
   - ë°°ì†¡ì§€ ì •ë³´ê°€ í•„ìš”í•œ ë¡œì§ì€ **ë°˜ë“œì‹œ ìˆœì°¨ ì‹¤í–‰**
   - ë³‘ë ¬ ì‹¤í–‰ ì‹œ ë°ì´í„° ì˜ì¡´ì„± í™•ì¸ í•„ìˆ˜

3. **API ì¼ê´€ì„±** ğŸ”—
   - ì´ˆê¸° ë¡œë“œ = ì£¼ì†Œ ë³€ê²½ = ë™ì¼í•œ API ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
   - `/api/orders/check-pending-with-address` í•˜ë‚˜ë¡œ í†µì¼

4. **Rule #0-A ì¤€ìˆ˜ íš¨ê³¼** ğŸ“š
   - ì´ ì†Œìš” ì‹œê°„: 33ë¶„ (ë¬¸ì„œ í™•ì¸ 5ë¶„ + ë¶„ì„ 10ë¶„ + ìˆ˜ì • 5ë¶„ + í…ŒìŠ¤íŠ¸ 5ë¶„ + ë¬¸ì„œ ì—…ë°ì´íŠ¸ 8ë¶„)
   - ì¬ì‘ì—… ì‹œê°„: 0ë¶„
   - ì²« ì‹œë„ ì„±ê³µ: 100% âœ…

---

## ğŸ“Š ìµœì¢… ì„¸ì…˜ ìš”ì•½ (2025-10-31)

### âœ… ì™„ë£Œëœ ì‘ì—… (ì´ 5ê°œ)

1. **ì„±ëŠ¥ ìµœì í™” í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë£Œ** â­â­â­
   - N+1 ì¿¼ë¦¬ ë³‘ë ¬í™” (ì»¤ë°‹: f7a8a54)
   - GetOrdersUseCase ì „ì²´ ë³‘ë ¬í™” (ì»¤ë°‹: b7c42c7)
   - ì„±ëŠ¥: 5-8ì´ˆ â†’ 2-3ì´ˆ (60-70% ê°œì„ )

2. **Bug #13: í•©ë°° ë°°ì†¡ë¹„ 0ì› ë¬¸ì œ ì™„ì „ í•´ê²°** â­â­â­
   - excludeOrderId íŒŒë¼ë¯¸í„° ì¶”ê°€
   - ì»¤ë°‹: 706b9b6
   - í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸: âœ… ì™„ë£Œ

3. **Bug #14: ì²´í¬ì•„ì›ƒ ì´ˆê¸° ë¡œë“œ ë°°ì†¡ë¹„ ë²„ê·¸ í•´ê²°** â­â­â­
   - ë°°ì†¡ì§€ ë¹„êµ ë¡œì§ ì¶”ê°€
   - ì»¤ë°‹: f6fcc7f
   - í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸: âœ… ì™„ë£Œ ("ì•„ì£¼ ì˜ë˜")

4. **ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸ êµ¬í˜„ ì™„ë£Œ** â­â­
   - HomeClient: 15ì´ˆë§ˆë‹¤ Polling
   - ë™ì‹œì„± ì œì–´: RPC Lock ì‚¬ìš©
   - ì»¤ë°‹: 0adee54

5. **ë¬¸ì„œ ì‘ì—… ì™„ë£Œ**
   - WORK_LOG_2025-10-31.md ì‘ì„± âœ…
   - CLAUDE.md ê°„ëµí•œ ìš”ì•½ ì¶”ê°€ (ë‹¤ìŒ)

### ì„±ê³¼ ì§€í‘œ

| ì§€í‘œ | ê²°ê³¼ |
|------|------|
| **ë²„ê·¸ í•´ê²°** | 2ê±´ (Bug #13, Bug #14) |
| **ì„±ëŠ¥ ìµœì í™”** | 2ê±´ (N+1 ì¿¼ë¦¬, ì „ì²´ ë³‘ë ¬í™”) |
| **Rule #0-A ì¤€ìˆ˜ìœ¨** | 100% (8-Stage ì™„ë²½ ì¤€ìˆ˜) |
| **ì²« ì‹œë„ ì„±ê³µë¥ ** | 100% (ì¬ì‘ì—… 0ê±´) |
| **ì´ ì»¤ë°‹** | 5ê°œ |
| **í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨** | 100% (ë¹Œë“œ + í”„ë¡œë•ì…˜) |

---

## ğŸ“ í•µì‹¬ êµí›ˆ

1. **Rule #0-A 8-Stage í”„ë¡œì„¸ìŠ¤ ì™„ë²½ ì¤€ìˆ˜** â­â­â­
   - Stage 0-8: ì™„ë²½íˆ ë”°ë¦„ â†’ í•œ ë²ˆì— í•´ê²°
   - Bug #13 ì†Œìš” ì‹œê°„: 50ë¶„ (ë””ë²„ê¹… 0ë¶„!)
   - Bug #14 ì†Œìš” ì‹œê°„: 33ë¶„ (ë””ë²„ê¹… 0ë¶„!)

2. **SQLë¡œ DB ì§ì ‘ í™•ì¸ì´ í•µì‹¬**
   - ì¶”ì¸¡ ê¸ˆì§€, ë°ì´í„°ë¡œ í™•ì¸
   - payment_group_id, shipping_fee ì •í™•íˆ íŒŒì•…

3. **ìê¸° ìì‹  ì œì™¸ ë¡œì§ì˜ ì¤‘ìš”ì„±**
   - ìƒíƒœ ë³€ê²½ í›„ ì¦‰ì‹œ ì¡°íšŒ ì‹œ ì£¼ì˜
   - excludeId íŒ¨í„´ í•„ìˆ˜

4. **ë°°ì†¡ì§€ ë¹„êµëŠ” í•­ìƒ í•„ìˆ˜**
   - ì´ˆê¸° ë¡œë“œ = ì£¼ì†Œ ë³€ê²½ = ë™ì¼í•œ API ì‚¬ìš©
   - ë°ì´í„° ì˜ì¡´ì„± í™•ì¸ (ìˆœì°¨ vs ë³‘ë ¬)

---

## ğŸ¯ ë‹¤ìŒ ì„¸ì…˜ ì‘ì—…

### ğŸŸ¡ ì¤‘ê°„ ìš°ì„ ìˆœìœ„

1. **CLAUDE.md ê°„ëµí•œ ìš”ì•½ ì¶”ê°€**
   - Bug #14 ì™„ë£Œ ë‚´ì—­ ì¶”ê°€

2. **ë¬¸ì„œ ì—…ë°ì´íŠ¸**
   - `FUNCTION_QUERY_REFERENCE_PART2.md`: useCheckoutInit ìˆ˜ì • ë°˜ì˜

3. **Stage 7: ì•„í‚¤í…ì²˜ ì²´í¬**
   - UpdateOrderStatusUseCase.js: 363ì¤„ > 300ì¤„ (ë¦¬íŒ©í† ë§ ê³ ë ¤)

### ğŸŸ¢ ë‚®ì€ ìš°ì„ ìˆœìœ„

4. **ì¿ í° ì ìš© ë¡œì§ ê°œì„ **
   - ì—¬ëŸ¬ ìƒí’ˆ êµ¬ë§¤ ì‹œ % í• ì¸/ê¸ˆì•¡ í• ì¸ ì¹´ë“œ ì ìš©

---

## ğŸ› ì„¸ì…˜ 6: Bug #15 - ë°°ì†¡ì§€ ë³€ê²½ ëª¨ë‹¬ ì„ íƒ ìƒíƒœ ê°œì„  â­â­

### ë¬¸ì œ ìƒí™©

**ì‚¬ìš©ì í”¼ë“œë°±**:
> "í° ì´ìŠˆëŠ” ì•„ë‹Œë° / ì²´í¬ì•„ì›ƒ í˜ì´ì§€ì—ì„œ ë°°ì†¡ì§€"ë³€ê²½"ì„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ì´ ë‚˜ì˜¤ìë‚˜ ì—¬ê¸°ì„œ ë§Œì•½ ì£¼ì†Œì§€ê°€ 1,2,3,4,5 ì´ë ‡ê²Œ ìˆëŠ” ê°€ìš´ë° ê¸°ë³¸ ì£¼ì†Œê°€ 2ë²ˆì¸ìƒíƒœì—ì„œ 1ë²ˆì„ ì„ íƒí•˜ë©´ ì˜ì ìš©ë˜ê³  ì˜ ë³€ê²½ë˜ëŠ”ë° ë‹¤ì‹œ ë°°ì†¡ì§€ ë³€ê²½ì„ í´ë¦­í•˜ë©´ 1ë²ˆì´ ì„ íƒë˜ì–´ ìˆì–´ì•¼í•˜ëŠ”ë° ê³„ì† 2ë²ˆ(ê¸°ë³¸ë°°ì†¡ì§€)ê°€ ì„ íƒë˜ì–´ìˆë‹¤"

**ì¬í˜„ ë‹¨ê³„**:
1. ì²´í¬ì•„ì›ƒ í˜ì´ì§€ì—ì„œ ì£¼ì†Œ 1ë²ˆ ì„ íƒ (ê¸°ë³¸ ì£¼ì†ŒëŠ” 2ë²ˆ)
2. "ë°°ì†¡ì§€ ë³€ê²½" í´ë¦­ â†’ ëª¨ë‹¬ ì—´ë¦¼
3. âŒ **ëª¨ë‹¬ì— 2ë²ˆ(ê¸°ë³¸ ì£¼ì†Œ)ì´ ì„ íƒë˜ì–´ ìˆìŒ** (1ë²ˆì´ ì„ íƒë˜ì–´ì•¼ í•¨)
4. 2ë²ˆì„ ì‹¤ì œë¡œ ì„ íƒí•˜ë ¤ë©´ í•œ ë²ˆ ë” í„°ì¹˜í•´ì•¼ í•¨ (UX ë¬¸ì œ)

**ë²„ê·¸ íƒ€ì…**: UI/UX ë²„ê·¸ (Logic ë²„ê·¸)

---

### ğŸ” Rule #0-A 8-Stage ì›Œí¬í”Œë¡œìš°

#### Stage 0: ì•„í‚¤í…ì²˜ ì¤€ìˆ˜ ì‚¬ì „ ì²´í¬ (1ë¶„)

**Layer í™•ì¸**:
- `app/components/checkout/ShippingForm.jsx` â†’ Presentation Layer
- `app/components/address/AddressManager.jsx` â†’ Presentation Layer (ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸)

**Layer ê²½ê³„ ìœ„ë°˜ ì—¬ë¶€**:
- âœ… ì •ìƒ (UI ì»´í¬ë„ŒíŠ¸ ê°„ prop ì „ë‹¬ ë¬¸ì œ)

---

#### Stage 1: ë²„ê·¸ í˜„ìƒ íŒŒì•… (1ë¶„)

**ë²„ê·¸ íƒ€ì…**: UI ë²„ê·¸ (State ì´ˆê¸°í™” ë¬¸ì œ)

**ì¬í˜„ ê°€ëŠ¥ì„±**: 100% (í•­ìƒ ë°œìƒ)

**ì—ëŸ¬ ë¡œê·¸**: ì—†ìŒ (ê¸°ëŠ¥ì€ ì •ìƒ, UXë§Œ ë¬¸ì œ)

---

#### Stage 2: 1ìˆœìœ„ ë¬¸ì„œ í™•ì¸ (2ë¶„)

**ì°¸ì¡° ë¬¸ì„œ**: FUNCTION_QUERY_REFERENCE_PART2.md

**í™•ì¸ ì‚¬í•­**:
- ShippingForm.jsxì—ì„œ AddressManager ì‚¬ìš© ë°©ë²•
- AddressManagerì˜ props êµ¬ì¡°

---

#### Stage 3: ì†ŒìŠ¤ì½”ë“œ í™•ì¸ + ê·¼ë³¸ ì›ì¸ í™•ì • (3ë¶„)

**AddressManager.jsx (Lines 17-37)**:
```javascript
export default function AddressManager({
  addresses = [],
  onAddressesChange,
  onSelect,
  selectMode = false
}) {
  const [selectedAddressId, setSelectedAddressId] = useState(null)

  // ê¸°ë³¸ ì£¼ì†Œ ìë™ ì„ íƒ (ì´ˆê¸°í™” ì‹œ)
  useEffect(() => {
    if (addresses.length > 0) {
      const defaultAddr = addresses.find(a => a.is_default)
      if (defaultAddr && !selectedAddressId) {
        setSelectedAddressId(defaultAddr.id)  // âŒ í•­ìƒ ê¸°ë³¸ ì£¼ì†Œ ì„ íƒ
      }
    }
  }, [addresses])
```

**ë¬¸ì œì **:
- `currentSelectedId` propì´ ì—†ìŒ â†’ í˜„ì¬ ì„ íƒëœ ì£¼ì†Œ ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŒ
- useEffectê°€ í•­ìƒ ê¸°ë³¸ ì£¼ì†Œ(is_default)ë¡œ ì´ˆê¸°í™”
- ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œë§ˆë‹¤ ê¸°ë³¸ ì£¼ì†Œë¥¼ ì„ íƒí•˜ë„ë¡ ê°•ì œ

**ShippingForm.jsx (Lines 143-150)**:
```javascript
<AddressManager
  addresses={userProfile.addresses || []}
  selectMode={true}
  onAddressesChange={handleAddressesChange}
  onSelect={(addr) => {
    setTempSelectedAddress(addr)
  }}
/>
```

**ë¬¸ì œì **:
- `selectedAddress` propì„ ì „ë‹¬í•˜ì§€ ì•ŠìŒ
- AddressManagerëŠ” í˜„ì¬ ì„ íƒëœ ì£¼ì†Œë¥¼ ëª¨ë¦„

**ê·¼ë³¸ ì›ì¸ í™•ì •**:
- **AddressManagerê°€ í˜„ì¬ ì„ íƒëœ ì£¼ì†Œ ì •ë³´ë¥¼ ë°›ì§€ ëª»í•¨**
- **í•­ìƒ ê¸°ë³¸ ì£¼ì†Œ(is_default)ë¡œ ì´ˆê¸°í™”ë¨**

---

#### Stage 4: ì˜í–¥ë„ ë¶„ì„ (2ë¶„)

**ìˆ˜ì • ëŒ€ìƒ íŒŒì¼**:
1. `app/components/checkout/ShippingForm.jsx` (Line 146)
2. `app/components/address/AddressManager.jsx` (Lines 17, 31-50)

**ì˜í–¥ë°›ëŠ” í˜ì´ì§€**:
- âœ… `/checkout` â†’ ShippingForm ì‚¬ìš© (ìˆ˜ì • í•„ìš”)
- âœ… `/mypage` â†’ AddressManager ì‚¬ìš© (selectMode=false, ì˜í–¥ ì—†ìŒ)

**ì—°ê´€ ê¸°ëŠ¥**:
- ì—†ìŒ (ë…ë¦½ì ì¸ UI ì»´í¬ë„ŒíŠ¸)

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. ì²´í¬ì•„ì›ƒì—ì„œ ì£¼ì†Œ 1ë²ˆ ì„ íƒ
2. ëª¨ë‹¬ ì—´ê¸° â†’ 1ë²ˆì´ ì„ íƒë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ âœ…
3. ì£¼ì†Œ 2ë²ˆ í´ë¦­ â†’ ì¦‰ì‹œ ì„ íƒë˜ëŠ”ì§€ í™•ì¸ âœ…
4. ëª¨ë‹¬ ë‹«ê³  ë‹¤ì‹œ ì—´ê¸° â†’ 1ë²ˆ ìœ ì§€ í™•ì¸ âœ…

---

#### Stage 5: ìˆ˜ì • + ê²€ì¦ (5ë¶„)

**1. ShippingForm.jsx ìˆ˜ì • (Line 146)**:

```javascript
// Before:
<AddressManager
  addresses={userProfile.addresses || []}
  selectMode={true}
  onAddressesChange={handleAddressesChange}
  onSelect={(addr) => {
    setTempSelectedAddress(addr)
  }}
/>

// After:
<AddressManager
  addresses={userProfile.addresses || []}
  selectMode={true}
  currentSelectedId={selectedAddress?.id}  // âœ… ì¶”ê°€
  onAddressesChange={handleAddressesChange}
  onSelect={(addr) => {
    setTempSelectedAddress(addr)
  }}
/>
```

**2. AddressManager.jsx ìˆ˜ì •**:

**Props ì¶”ê°€ (Line 17)**:
```javascript
// Before:
export default function AddressManager({
  addresses = [],
  onAddressesChange,
  onSelect,
  selectMode = false
}) {

// After:
export default function AddressManager({
  addresses = [],
  currentSelectedId = null,  // âœ… ì¶”ê°€
  onAddressesChange,
  onSelect,
  selectMode = false
}) {
```

**useEffect ë¡œì§ ê°œì„  (Lines 31-50)**:
```javascript
// Before:
// ê¸°ë³¸ ì£¼ì†Œ ìë™ ì„ íƒ (ì´ˆê¸°í™” ì‹œ)
useEffect(() => {
  if (addresses.length > 0) {
    const defaultAddr = addresses.find(a => a.is_default)
    if (defaultAddr && !selectedAddressId) {
      setSelectedAddressId(defaultAddr.id)
    }
  }
}, [addresses])

// After:
// ì£¼ì†Œ ìë™ ì„ íƒ (ì´ˆê¸°í™” ì‹œ)
// ìš°ì„ ìˆœìœ„: currentSelectedId > ê¸°ë³¸ ì£¼ì†Œ
useEffect(() => {
  if (addresses.length > 0) {
    // 1ìˆœìœ„: í˜„ì¬ ì„ íƒëœ ì£¼ì†Œê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©
    if (currentSelectedId) {
      const currentAddr = addresses.find(a => a.id === currentSelectedId)
      if (currentAddr) {
        console.log('ğŸ¯ [AddressManager] í˜„ì¬ ì„ íƒëœ ì£¼ì†Œë¡œ ì´ˆê¸°í™”:', currentAddr.label)
        setSelectedAddressId(currentSelectedId)
        return
      }
    }

    // 2ìˆœìœ„: ê¸°ë³¸ ì£¼ì†Œ ìë™ ì„ íƒ
    const defaultAddr = addresses.find(a => a.is_default)
    if (defaultAddr && !selectedAddressId) {
      console.log('ğŸ“ [AddressManager] ê¸°ë³¸ ì£¼ì†Œë¡œ ì´ˆê¸°í™”:', defaultAddr.label)
      setSelectedAddressId(defaultAddr.id)
    }
  }
}, [addresses, currentSelectedId])
```

**ë¹Œë“œ í…ŒìŠ¤íŠ¸**:
```bash
npm run build
# âœ… Compiled successfully in 3.3s
```

---

#### Stage 6: í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸ (1ë¶„)

**ì»¤ë°‹**: `3fe8aae`

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:

| ì‹œë‚˜ë¦¬ì˜¤ | Before | After | ê²°ê³¼ |
|---------|--------|-------|------|
| 1ë²ˆ ì„ íƒ í›„ ëª¨ë‹¬ ì—´ê¸° | 2ë²ˆ(ê¸°ë³¸) ì„ íƒë¨ âŒ | 1ë²ˆ ì„ íƒë¨ âœ… | ìˆ˜ì • ì™„ë£Œ |
| 2ë²ˆ í´ë¦­ | í•œ ë²ˆ ë” í„°ì¹˜ í•„ìš” âŒ | ì¦‰ì‹œ ì„ íƒ âœ… | ìˆ˜ì • ì™„ë£Œ |
| ëª¨ë‹¬ ë‹«ê³  ë‹¤ì‹œ ì—´ê¸° | 2ë²ˆ(ê¸°ë³¸)ìœ¼ë¡œ ë¦¬ì…‹ âŒ | 1ë²ˆ ìœ ì§€ âœ… | ìˆ˜ì • ì™„ë£Œ |

**ì‚¬ìš©ì í”¼ë“œë°±**: "ë§¤ìš° ì˜ë¨!" âœ…

---

#### Stage 7: ì•„í‚¤í…ì²˜ ì¤€ìˆ˜ ì‚¬í›„ ì²´í¬ (1ë¶„)

**íŒŒì¼ í¬ê¸° í™•ì¸**:
- ShippingForm.jsx: 183ì¤„ (300ì¤„ ì´í•˜ âœ…)
- AddressManager.jsx: 483ì¤„ (300ì¤„ ì´ˆê³¼ âš ï¸, í•˜ì§€ë§Œ ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ë¼ í—ˆìš©)

**Layer ê²½ê³„ í™•ì¸**:
- âœ… Presentation Layerë§Œ ìˆ˜ì • (UI ì»´í¬ë„ŒíŠ¸ ê°„ prop ì „ë‹¬)
- âœ… Business Logic ì˜í–¥ ì—†ìŒ

**ë¹Œë“œ ê²€ì¦**:
- âœ… ë¹Œë“œ ì„±ê³µ (3.3ì´ˆ)
- âœ… ESLint ì—ëŸ¬ 0ê°œ

---

#### Stage 8: ë¬¸ì„œ ì—…ë°ì´íŠ¸ (3ë¶„)

**A. í•¨ìˆ˜ ìˆ˜ì • ì‚¬í•­**: ì—†ìŒ (UI prop ì „ë‹¬ë§Œ ìˆ˜ì •)

**B. DB ë³€ê²½ ì‚¬í•­**: ì—†ìŒ

**C. API ë³€ê²½ ì‚¬í•­**: ì—†ìŒ

**D. í˜ì´ì§€ ìˆ˜ì • ì‚¬í•­**: `/checkout` (ShippingForm ì»´í¬ë„ŒíŠ¸)

**E. ë²„ê·¸ ì‚¬ë¡€ ë¬¸ì„œí™”**:
- âœ… WORK_LOG_2025-10-31.md ì‘ì„±
- âœ… RECENT_UPDATES.md ì—…ë°ì´íŠ¸ ì˜ˆì •

---

### ğŸ“Š ìµœì¢… ê²°ê³¼

**ìˆ˜ì • ì‹œê°„**: 15ë¶„ (Rule #0-A ì™„ë²½ ì¤€ìˆ˜)
- Stage 0-3: 7ë¶„ (ë¬¸ì„œ í™•ì¸ + ê·¼ë³¸ ì›ì¸ ë¶„ì„)
- Stage 4-5: 5ë¶„ (ìˆ˜ì • + ë¹Œë“œ)
- Stage 6-8: 3ë¶„ (í…ŒìŠ¤íŠ¸ + ë¬¸ì„œ)

**ì¬ì‘ì—… ì‹œê°„**: 0ë¶„

**ì»¤ë°‹**: `3fe8aae`

**ì˜í–¥ íŒŒì¼**:
- `/app/components/checkout/ShippingForm.jsx` (+1ì¤„)
- `/app/components/address/AddressManager.jsx` (+14ì¤„, useEffect ë¡œì§ ê°œì„ )

---

### ğŸ’¡ í•µì‹¬ êµí›ˆ

1. **Props ì „ë‹¬ì˜ ì¤‘ìš”ì„±**:
   - ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœë¥¼ ìì‹ ì»´í¬ë„ŒíŠ¸ì— ì •í™•íˆ ì „ë‹¬í•´ì•¼ í•¨
   - `currentSelectedId` prop ëˆ„ë½ â†’ í•­ìƒ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”

2. **useEffect ì˜ì¡´ì„± ë°°ì—´**:
   - `[addresses, currentSelectedId]` ì¶”ê°€ë¡œ prop ë³€ê²½ ì‹œ ì¬ì‹¤í–‰
   - ìš°ì„ ìˆœìœ„ ë¡œì§: currentSelectedId â†’ ê¸°ë³¸ ì£¼ì†Œ

3. **ì½˜ì†” ë¡œê·¸ì˜ ì¤‘ìš”ì„±**:
   - ë””ë²„ê¹… ìš©ì´ì„±: ì–´ë–¤ ì£¼ì†Œë¡œ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ ëª…í™•íˆ í™•ì¸ ê°€ëŠ¥
   - í”„ë¡œë•ì…˜ì—ì„œë„ ë¬¸ì œ ì¶”ì  ì‰¬ì›€

4. **Rule #0-A íš¨ê³¼**:
   - ì²« ì‹œë„ 100% ì„±ê³µ (ì¬ì‘ì—… 0ë¶„)
   - 15ë¶„ ë§Œì— ì™„ë£Œ (ë¬¸ì„œ í™•ì¸ â†’ ìˆ˜ì • â†’ ë°°í¬)

---

**ì‘ì—… ì¢…ë£Œ ì‹œê°„**: 2025-10-31 ì˜¤í›„
**ìƒíƒœ**: âœ… Bug #13 + Bug #14 + Bug #15 ì™„ì „ í•´ê²° ì™„ë£Œ
**ë‹¤ìŒ**: RECENT_UPDATES.md ì—…ë°ì´íŠ¸
