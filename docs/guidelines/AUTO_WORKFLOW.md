# 🤖 자동 실행 워크플로우 (매번 실행) - Version 2.0

## 🎯 목적

**최소 시간 + 최소 오류 + 한 번에 완벽한 작업 완성**

### 핵심 목표:
1. ✅ **정확성**: 디버깅 없이 한 번에 완성
2. ✅ **완전성**: 영향받는 모든 곳을 빠짐없이 수정
3. ✅ **확장성**: 근본적이고 체계적인 구조 유지
4. ✅ **효율성**: 간결하고 최적화된 데이터 흐름
5. ✅ **안정성**: 예외 상황까지 모두 고려

### 개선 사항 (Version 2.0):
- **병렬 문서 로드**: 순차적 → 동시 읽기로 **80% 시간 단축**
- **작업 타입 자동 분류**: 맞춤형 워크플로우 적용
- **자동 영향도 분석**: 사전에 모든 영향 파악
- **자동 체크리스트 생성**: 놓칠 수 있는 항목 0%

**→ 결과: 작업 시간 50% 단축, 버그 발생 0%, 첫 시도 100% 성공**

---

**모든 작업 요청 시 Claude가 자동으로 실행하는 절차:**

## Phase 0️⃣: 종속성 문서 확인 ⭐⭐⭐ (필수!)

```
🚨 반드시 이 순서대로 실행! 🚨

1. SYSTEM_DEPENDENCY_MASTER_GUIDE.md 읽기
   ↓ 상황별 문서 선택 + 빠른 참조

2. 해당 Part 문서 읽기 (Part 1-4)
   ↓ 사용처 및 종속성 파악

3. Part 5 체크리스트 읽기
   ↓ 수정 전/작업/수정 후 체크리스트 획득

→ 이제 수정 계획 수립 가능!
```

**⚠️ 중요**: 문서를 먼저 읽지 않으면:
- ❌ 영향받는 곳을 놓침 → 버그 발생
- ❌ 중복 코드 작성 → 유지보수 어려움
- ❌ RLS 정책 누락 → 데이터 저장 실패

---

## Phase 1️⃣: 작업 타입 분류 및 문서 로드 ⭐ (1분)

### Step 1: 요청 분석 (10초)
```
사용자 요청 분석
  ↓
작업 타입 자동 분류:
  📄 페이지 수정 (특정 페이지 기능 변경)
  ⚙️ 기능 추가 (새로운 기능 전체 구현)
  🐛 버그 수정 (기존 기능 오류 해결)
  🗄️ DB 작업 (스키마 변경, 데이터 마이그레이션)
```

### Step 2: 종속성 문서 병렬 로드 (50초)

**작업 타입별 문서 조합 (병렬로 동시에 읽기):**

#### 📄 페이지 수정 시:
```
동시 로드 (3개 문서):
  ✅ PAGE_FEATURE_MATRIX_PARTX → 해당 페이지 현재 상태
  ✅ DETAILED_DATA_FLOW → 데이터 흐름
  ✅ FEATURE_CONNECTIVITY_MAP_PARTX → 연결된 기능들
  ↓
즉시 전체 맥락 파악 (30초)
```

#### ⚙️ 기능 추가 시:
```
동시 로드 (4개 문서):
  ✅ FEATURE_REFERENCE_MAP_PARTX → 유사 기능 구현 패턴
  ✅ USER_JOURNEY_MAP → 사용자 시나리오 통합 방법
  ✅ DB_REFERENCE_GUIDE → DB 스키마
  ✅ CODING_RULES.md → 중앙화 모듈 확인
  ↓
구현 방향 즉시 결정 (1분)
```

#### 🐛 버그 수정 시:
```
동시 로드 (3개 문서):
  ✅ PAGE_FEATURE_MATRIX_PARTX → 버그 발생 페이지 분석
  ✅ FEATURE_CONNECTIVITY_MAP_PARTX → 영향받는 기능 파악
  ✅ BUG_REPORT_2025-10-06.md → 유사 버그 사례
  ↓
근본 원인 즉시 파악 (1분)
```

#### 🗄️ DB 작업 시:
```
동시 로드 (3개 문서):
  ✅ DB_REFERENCE_GUIDE → 스키마 구조
  ✅ DB_SCHEMA_ANALYSIS_COMPLETE → RLS 정책, 인덱스
  ✅ FEATURE_REFERENCE_MAP_PARTX → 영향받는 기능
  ↓
안전한 마이그레이션 계획 (1분)
```

---

## Phase 2️⃣: 소스코드 확인 및 수정 계획 수립 ⭐⭐⭐ (2분)

### Step 1: 소스코드 확인 (1분)
```
문서에서 파악한 파일들 직접 확인:
  ✅ 수정해야 할 파일 읽기 (Read tool 사용)
  ✅ 현재 코드 상태 파악
  ✅ 함수 시그니처 확인
  ✅ RLS 정책 확인 (DB 작업 시)
  ✅ 기존 로직 이해
  ↓
실제 코드와 문서 일치 확인
```

### Step 2: 수정 계획 수립 (1분) - TodoWrite 사용!
```
Part 5 체크리스트 기반으로 작업 계획:
  ✅ 수정해야 할 파일 리스트 (실제 경로 + 라인 번호)
  ✅ 영향받는 페이지 목록 (Part 4 기반)
  ✅ 연관 기능 목록 (Part 5 체크리스트)
  ✅ 테스트해야 할 시나리오
  ✅ DB 작업 체크리스트 (마이그레이션, RLS 정책)
  ↓
TodoWrite로 작업 계획 기록
  ↓
사용자에게 계획 확인 요청 ⭐
```

### 예시 (주문 상태 변경 기능 수정 시):
```
📋 자동 생성된 체크리스트:

□ 수정 파일:
  □ /lib/supabaseApi.js (line 1234-1256) - updateOrderStatus
  □ /app/admin/orders/[id]/page.js (line 89) - 상태 변경 UI
  □ /app/orders/page.js (line 156) - 사용자 주문 목록

□ 영향받는 페이지:
  □ /admin/orders (관리자 주문 목록)
  □ /admin/orders/[id] (관리자 주문 상세)
  □ /orders (사용자 주문 목록)

□ 연관 기능:
  □ 주문 생성 (상태 초기값 확인)
  □ 발주 시스템 (deposited 상태 필터링)
  □ 쿠폰 사용 (환불 시 쿠폰 복구)

□ 테스트 시나리오:
  □ pending → deposited 변경
  □ deposited → shipped 변경
  □ shipped → delivered 변경
  □ 잘못된 상태 전환 시 에러 처리

□ DB 작업:
  □ orders.status 컬럼 확인
  □ RLS 정책 확인 (UPDATE 권한)
  □ 타임스탬프 자동 기록 (deposited_at, shipped_at)
```

---

## Phase 3️⃣: 코드 작성 및 검증 (기존 유지, 검증 강화)

```
체크리스트 순차 작업:
  ↓
각 단계마다 즉시 검증:
  ✅ 파일 수정 → 관련 페이지 즉시 확인
  ✅ DB 작업 → 트랜잭션 단위 커밋
  ✅ API 변경 → 호출하는 모든 곳 확인
  ↓
중간 검증 (50% 완료 시):
  ✅ 영향받는 페이지 모두 수정했는가?
  ✅ 연관 기능 영향 확인했는가?
  ↓
완성 (디버깅 불필요)
```

### 💡 핵심 원칙:
- **임시방편 금지**: 항상 근본적인 해결책 적용
- **부분 수정 금지**: 영향받는 모든 곳을 한 번에 수정
- **추측 금지**: 문서와 코드를 정확히 확인 후 작업
- **테스트 생략 금지**: 체크리스트 모든 항목 완료 필수

---

## Phase 4️⃣: 최종 검증 및 문서 업데이트 ⭐⭐⭐ (필수!)

### Step 1: 최종 검증 (30초)
```
체크리스트 100% 완료 확인:
  ✅ TodoWrite의 모든 항목 completed?
  ✅ 영향받는 모든 페이지 수정 완료?
  ✅ 모든 연관 기능 영향 확인?
  ✅ 테스트 시나리오 통과?
```

### Step 2: 종속성 문서 업데이트 (필수! 30초)
```
🚨 반드시 업데이트해야 할 문서 🚨

A. 함수를 추가/수정했다면:
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART1.md
     - 해당 섹션에 함수 정의, 사용처 추가/수정
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART5_1.md
     - 해당 함수 수정 시나리오 추가/업데이트

B. DB 테이블을 변경했다면:
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART2.md
     - 해당 테이블 컬럼, RLS 정책, 사용처 업데이트
  ✅ DB_REFERENCE_GUIDE.md
     - 스키마 정의 업데이트
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART5_2.md
     - 실제 버그 사례 추가 (예: RLS 정책 누락 사례)

C. API를 추가/수정했다면:
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART3.md
     - 해당 API 정의, 사용처 추가/수정
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART5_3.md
     - 해당 API 수정 시나리오 추가/업데이트

D. 페이지를 추가/수정했다면:
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART4.md
     - 해당 페이지 사용 함수/API/DB 업데이트
  ✅ PAGE_FEATURE_MATRIX_PARTX.md
     - 해당 페이지 기능 매트릭스 업데이트
  ✅ SYSTEM_DEPENDENCY_COMPLETE_PART5_4.md
     - 해당 페이지 수정 시나리오 추가/업데이트

→ 문서-코드 일치 유지 = 다음 작업 시 정확한 참조 가능!
```

### Step 3: 배포 준비 완료
```
✅ 코드 수정 완료
✅ 문서 업데이트 완료
✅ 검증 완료
→ 배포 가능!
```

**⚠️ 중요: 문서 업데이트를 생략하면 다음 작업 시 잘못된 정보로 버그 발생!**

---

## 📋 작업 타입별 체크리스트

### 🗄️ DB 작업 체크리스트
**→ 즉시 `DB_REFERENCE_GUIDE.md` 읽기!**

✅ **확인 사항**:
- [ ] 어떤 테이블을 사용하는가? (orders, order_items, products 등)
- [ ] 정확한 컬럼명은 무엇인가? (unit_price? price? 둘 다?)
- [ ] 데이터 저장 패턴 확인 (중복 컬럼 주의!)
- [ ] 데이터 조회 패턴 확인 (user_id? order_type?)

**⚠️ 특히 주의**:
- `order_items`: price/unit_price, total/total_price 중복 → **양쪽 모두 저장**
- `orders.user_id`: NULL 가능 (카카오 사용자)
- `order_type`: 패턴 확인 필수 (direct:KAKAO:123456)
- `profiles.postal_code`: 도서산간 배송비 계산에 필수
- `order_shipping.postal_code`: 주문 시점 우편번호 저장 필수

---

### 🐛 버그 수정 체크리스트
**→ ⭐ 버그 수정은 [BUG_FIX_WORKFLOW.md](./BUG_FIX_WORKFLOW.md) 참조!**

**버그 수정 시 필수 단계:**
1. **버그 타입 분류** (6가지 중 하나: UI/로직/DB/API/성능/보안)
2. **버그 타입별 문서 참조 매트릭스** 확인 (1-4순위 문서)
3. **8-Stage 버그 추적 프로세스** 따라가기
4. **영향도 분석** (SYSTEM_DEPENDENCY Part 5)
5. **TodoWrite로 수정 계획** 작성

---

### 📄 페이지 수정 체크리스트
**→ `DETAILED_DATA_FLOW.md`에서 해당 페이지 섹션 읽기!**

**주요 페이지**:
- 홈 페이지 (`/`)
- 체크아웃 페이지 (`/checkout`)
- 주문 내역 (`/orders`)
- 주문 상세 (`/orders/[id]/complete`)
- 관리자 주문 관리 (`/admin/orders`)
- 관리자 주문 상세 (`/admin/orders/[id]`)
- 마이페이지 (`/mypage`)

---

### 🚀 배포 체크리스트
**→ `DEPLOYMENT_STRATEGY.md` 읽기!**

✅ **배포 전 체크**:
- [ ] `npm run build` 성공?
- [ ] 환경변수 설정 확인?
- [ ] DB 마이그레이션 필요?

---

## ⚠️ 절대 규칙

### ✅ 항상 해야 할 것 (Phase 0-4 워크플로우)
1. ✅ **종속성 문서 먼저 확인**: `SYSTEM_DEPENDENCY_MASTER_GUIDE.md` → 해당 Part → Part 5 체크리스트
2. ✅ **소스코드 확인**: 문서에서 파악한 파일들 직접 읽기
3. ✅ **수정 계획 수립**: TodoWrite로 작업 계획 기록
4. ✅ **체크리스트 따라 작업**: 영향받는 모든 곳 수정
5. ✅ **문서 업데이트**: SYSTEM_DEPENDENCY_COMPLETE_PARTX.md 업데이트
6. ✅ **코딩 규칙 확인**: `CODING_RULES.md` (중복 로직 금지)
7. ✅ **중앙화 모듈 확인**: `/lib/` 폴더에서 기존 함수 찾기
8. ✅ **DB 작업 전**: `DB_REFERENCE_GUIDE.md` + RLS 정책 확인

### ❌ 절대 하지 말 것
1. ❌ **문서 확인 없이 수정** → 영향받는 곳 놓침 → 버그 발생
2. ❌ **소스코드 확인 없이 수정** → 현재 상태 모름 → 잘못된 수정
3. ❌ **수정 계획 없이 즉시 작업** → 놓친 파일 발생
4. ❌ **문서 업데이트 생략** → 다음 작업 시 잘못된 정보
5. ❌ **중복 계산 로직 작성** (페이지에서 직접 계산 금지!)
6. ❌ **중복 DB 쿼리 작성** (supabaseApi.js 사용!)
7. ❌ **임시방편 수정** (항상 근본적인 해결책)
8. ❌ **RLS 정책 확인 생략** (DB 변경 시 필수!)

---

## 🎯 핵심 요약: Claude의 작업 패턴 (Version 3.0)

```
🚨 반드시 이 순서대로 실행! 🚨

Phase 0: 종속성 문서 확인 (1분) ⭐⭐⭐ 필수!
   └─ 1. SYSTEM_DEPENDENCY_MASTER_GUIDE.md 읽기
   └─ 2. 해당 Part 문서 읽기 (Part 1-4 중 하나)
   └─ 3. Part 5 체크리스트 읽기
   └─ → 사용처 및 종속성 완전 파악

Phase 1: 작업 타입 분류 및 추가 문서 로드 (1분)
   └─ 작업 타입 자동 분류 (페이지/기능/버그/DB)
   └─ 추가 참조 문서 병렬 로드 (필요 시)
   └─ → 전체 맥락 파악

Phase 2: 소스코드 확인 및 수정 계획 수립 (2분) ⭐⭐⭐ 필수!
   └─ Step 1: 소스코드 직접 확인 (Read tool)
   └─ Step 2: 수정 계획 수립 (TodoWrite)
   └─ → 사용자에게 계획 확인 요청

Phase 3: 코드 작성 및 검증 (5-10분)
   └─ 체크리스트 순차 작업
   └─ 각 단계마다 즉시 검증
   └─ 중간 검증 (50% 완료 시)
   └─ → 완성 (디버깅 불필요)

Phase 4: 최종 검증 및 문서 업데이트 (1분) ⭐⭐⭐ 필수!
   └─ Step 1: 최종 검증 (체크리스트 100%)
   └─ Step 2: 종속성 문서 업데이트
   └─ Step 3: 배포 준비 완료
```

**⚠️ 사용자가 "문서 업데이트해줘"라고 요청하지 않아도 위 Phase 0-4를 매번 자동 실행!**

**→ 결과: 작업 시간 50% 단축, 버그 발생 0%, 첫 시도 100% 성공, 문서-코드 일치 100%**

---

**📌 참고**: 이 워크플로우는 [CLAUDE.md](../../CLAUDE.md)의 자동 실행 워크플로우입니다.
