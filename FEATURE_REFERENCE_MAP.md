# FEATURE_REFERENCE_MAP.md

**ëª©ì **: ëª¨ë“  ê¸°ëŠ¥ì˜ ì˜í–¥ë„ì™€ ì—°ê´€ì„±ì„ í•œëˆˆì— íŒŒì•…
**ì—…ë°ì´íŠ¸**: 2025-10-03
**ê¸°ì¤€**: ë³¸ì„œë²„ ì½”ë“œ (main ë¸Œëœì¹˜)
**ë²„ì „**: 1.0 (ì´ˆì•ˆ)

---

## ğŸ“– ì‚¬ìš© ë°©ë²•

### ê°œë°œììš©
1. ê¸°ëŠ¥ ìˆ˜ì • ì „ í•´ë‹¹ ì„¹ì…˜ ì½ê¸°
2. "ì˜í–¥ë°›ëŠ” í˜ì´ì§€" ëª¨ë‘ í™•ì¸
3. "ì—°ê´€ ê¸°ëŠ¥" í…ŒìŠ¤íŠ¸ í•„ìš”
4. "í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸" ì™„ë£Œ

### Claudeìš©
1. `/system-check` ì‹¤í–‰ ì‹œ ì´ ë¬¸ì„œ ì°¸ì¡°
2. ìˆ˜ì • ì „ ìë™ìœ¼ë¡œ ì˜í–¥ë„ ë¶„ì„
3. ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ê²€ì¦

---

## ğŸ¯ ê¸°ëŠ¥ ë¶„ë¥˜

### 1. ì£¼ë¬¸ ê´€ë ¨ (20ê°œ ê¸°ëŠ¥)
- 1.1 ì£¼ë¬¸ ìƒì„± â­ [ì£¼ìš”]
- 1.2 ì£¼ë¬¸ ì¡°íšŒ (ì‚¬ìš©ì) [ì¼ë°˜]
- 1.3 ì£¼ë¬¸ ì¡°íšŒ (ê´€ë¦¬ì) [ì¼ë°˜]
- 1.4 ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ [ì¼ë°˜]
- 1.5 ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ â­ [ì£¼ìš”]
- 1.6 ì¼ê´„ ìƒíƒœ ë³€ê²½ â­ [ì£¼ìš”]
- 1.7 ì£¼ë¬¸ ì·¨ì†Œ â­ [ì£¼ìš”]
- 1.8 í™˜ë¶ˆ ì²˜ë¦¬ [ì¼ë°˜]
- 1.9 ì£¼ë¬¸ ì•„ì´í…œ ìˆ˜ëŸ‰ ë³€ê²½ [ì¼ë°˜]
- 1.10 ì£¼ë¬¸ë²ˆí˜¸ ìƒì„± [ì¼ë°˜]
- 1.11 ê·¸ë£¹ ì£¼ë¬¸ë²ˆí˜¸ ìƒì„± [ì¼ë°˜]
- 1.12 ì…ê¸ˆ í™•ì¸ [ì¼ë°˜]
- 1.13 ë°°ì†¡ ì²˜ë¦¬ [ì¼ë°˜]
- 1.14 ë°°ì†¡ ì™„ë£Œ [ì¼ë°˜]
- 1.15 ì£¼ë¬¸ ê²€ìƒ‰ [ì¼ë°˜]
- 1.16 ì£¼ë¬¸ í•„í„°ë§ [ì¼ë°˜]
- 1.17 ì£¼ë¬¸ í†µê³„ [ì¼ë°˜]
- 1.18 ì£¼ë¬¸ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ [ì¼ë°˜]
- 1.19 ì¼ê´„ê²°ì œ ì²˜ë¦¬ â­ [ì£¼ìš”]
- 1.20 ê²°ì œ ìˆ˜ë‹¨ ë³€ê²½ [ì¼ë°˜]

### 2. ìƒí’ˆ ê´€ë ¨ (18ê°œ ê¸°ëŠ¥)
- 2.1 ìƒí’ˆ ë“±ë¡ â­ [ì£¼ìš”]
- 2.2 ìƒí’ˆ ìˆ˜ì • â­ [ì£¼ìš”]
- 2.3 ìƒí’ˆ ì‚­ì œ [ì¼ë°˜]
- 2.4 ìƒí’ˆ ì¡°íšŒ (ì‚¬ìš©ì) [ì¼ë°˜]
- 2.5 ìƒí’ˆ ì¡°íšŒ (ê´€ë¦¬ì) [ì¼ë°˜]
- 2.6 ìƒí’ˆ ë‹¨ì¼ ì¡°íšŒ [ì¼ë°˜]
- 2.7 ìƒí’ˆ ê²€ìƒ‰ [ì¼ë°˜]
- 2.8 ìƒí’ˆ í•„í„°ë§ [ì¼ë°˜]
- 2.9 ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ [ì¼ë°˜]
- 2.10 ìƒí’ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ [ì¼ë°˜]
- 2.11 ìƒí’ˆ ë…¸ì¶œ ì„¤ì • [ì¼ë°˜]
- 2.12 ìƒí’ˆ ì •ë ¬ [ì¼ë°˜]
- 2.13 ë¼ì´ë¸Œ ìƒíƒœ ë³€ê²½ [ì¼ë°˜]
- 2.14 ë¼ì´ë¸Œ ë“±ë¡ [ì¼ë°˜]
- 2.15 ë¼ì´ë¸Œ í•´ì œ [ì¼ë°˜]
- 2.16 ë¼ì´ë¸Œ ìš°ì„ ìˆœìœ„ ë³€ê²½ [ì¼ë°˜]
- 2.17 ìƒí’ˆ ì¬ê³  ê´€ë¦¬ [ì¼ë°˜]
- 2.18 ì˜µì…˜ í¬í•¨ ìƒí’ˆ ìƒì„± â­ [ì£¼ìš”]

### 3. Variant/ì˜µì…˜ ê´€ë ¨ (12ê°œ ê¸°ëŠ¥)
- 3.1 Variant ìƒì„± â­ [ì£¼ìš”]
- 3.2 Variant ì¬ê³  ê´€ë¦¬ â­ [ì£¼ìš”]
- 3.3 Variant ì¬ê³  í™•ì¸ â­ [ì£¼ìš”]
- 3.4 ì˜µì…˜ ì¡°í•© ìƒì„± [ì¼ë°˜]
- 3.5 SKU ìë™ ìƒì„± [ì¼ë°˜]
- 3.6 ì˜µì…˜ë³„ ê°€ê²© ì„¤ì • [ì¼ë°˜]
- 3.7 ì˜µì…˜ë³„ ì¬ê³  ì…ë ¥ [ì¼ë°˜]
- 3.8 ì˜µì…˜ ì¶”ê°€ [ì¼ë°˜]
- 3.9 ì˜µì…˜ ì‚­ì œ [ì¼ë°˜]
- 3.10 ì˜µì…˜ ê°’ ìˆ˜ì • [ì¼ë°˜]
- 3.11 ì˜µì…˜ ì¡°íšŒ [ì¼ë°˜]
- 3.12 ì˜µì…˜ê°’ ìƒì„± [ì¼ë°˜]

### 4. ì‚¬ìš©ì/í”„ë¡œí•„ ê´€ë ¨ (10ê°œ ê¸°ëŠ¥)
- 4.1 í”„ë¡œí•„ ì¡°íšŒ [ì¼ë°˜]
- 4.2 í”„ë¡œí•„ ìˆ˜ì • â­ [ì£¼ìš”]
- 4.3 í”„ë¡œí•„ ì •ê·œí™” â­ [ì£¼ìš”]
- 4.4 í”„ë¡œí•„ ìœ íš¨ì„± ê²€ì‚¬ [ì¼ë°˜]
- 4.5 ì£¼ì†Œ ê´€ë¦¬ â­ [ì£¼ìš”]
- 4.6 ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰ [ì¼ë°˜]
- 4.7 ë°°ì†¡ì§€ ì €ì¥ [ì¼ë°˜]
- 4.8 ê³ ê° ëª©ë¡ ì¡°íšŒ [ì¼ë°˜]
- 4.9 ê³ ê° ê²€ìƒ‰ [ì¼ë°˜]
- 4.10 ê³ ê° ì£¼ë¬¸ ì´ë ¥ [ì¼ë°˜]

### 5. ì¸ì¦ ê´€ë ¨ (6ê°œ ê¸°ëŠ¥)
- 5.1 ë¡œê·¸ì¸ (ì¼ë°˜) [ì¼ë°˜]
- 5.2 ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤) â­ [ì£¼ìš”]
- 5.3 íšŒì›ê°€ì… [ì¼ë°˜]
- 5.4 ë¡œê·¸ì•„ì›ƒ [ì¼ë°˜]
- 5.5 ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • [ì¼ë°˜]
- 5.6 ì„¸ì…˜ ê´€ë¦¬ [ì¼ë°˜]

### 6. ê³µê¸‰ì—…ì²´/ë°œì£¼ ê´€ë ¨ (6ê°œ ê¸°ëŠ¥)
- 6.1 ë°œì£¼ì„œ ìƒì„± â­ [ì£¼ìš”]
- 6.2 ë°œì£¼ì„œ ë‹¤ìš´ë¡œë“œ [ì¼ë°˜]
- 6.3 ì—…ì²´ ê´€ë¦¬ [ì¼ë°˜]
- 6.4 ì—…ì²´ë³„ ì£¼ë¬¸ ì¡°íšŒ [ì¼ë°˜]
- 6.5 ë°œì£¼ ì´ë ¥ ì¡°íšŒ [ì¼ë°˜]
- 6.6 ì¤‘ë³µ ë°œì£¼ ë°©ì§€ [ì¼ë°˜]

### 7. ë°°ì†¡ ê´€ë ¨ (5ê°œ ê¸°ëŠ¥)
- 7.1 ë°°ì†¡ë¹„ ê³„ì‚° â­ [ì£¼ìš”]
- 7.2 ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ì¶”ê°€ â­ [ì£¼ìš”]
- 7.3 ë°°ì†¡ ìƒíƒœ ì¡°íšŒ [ì¼ë°˜]
- 7.4 ë°°ì†¡ ì¶”ì  [ì¼ë°˜]
- 7.5 ë°°ì†¡ ì•Œë¦¼ [ì¼ë°˜]

### 8. ì¿ í° ê´€ë ¨ (10ê°œ ê¸°ëŠ¥)
- 8.1 ì¿ í° ë°œí–‰ â­ [ì£¼ìš”]
- 8.2 ì¿ í° ë°°í¬ (ê°œë³„) â­ [ì£¼ìš”]
- 8.3 ì¿ í° ë°°í¬ (ì „ì²´) â­ [ì£¼ìš”]
- 8.4 ì¿ í° ìœ íš¨ì„± ê²€ì¦ â­ [ì£¼ìš”]
- 8.5 ì¿ í° ì‚¬ìš© ì²˜ë¦¬ â­ [ì£¼ìš”]
- 8.6 ì¿ í° ëª©ë¡ ì¡°íšŒ (ê´€ë¦¬ì) [ì¼ë°˜]
- 8.7 ì¿ í° ëª©ë¡ ì¡°íšŒ (ì‚¬ìš©ì) [ì¼ë°˜]
- 8.8 ì¿ í° ìƒì„¸ ì¡°íšŒ [ì¼ë°˜]
- 8.9 ì¿ í° í™œì„±í™”/ë¹„í™œì„±í™” [ì¼ë°˜]
- 8.10 ì¿ í° í†µê³„ ì¡°íšŒ [ì¼ë°˜]

---

## 1. ì£¼ë¬¸ ê´€ë ¨ ê¸°ëŠ¥

### 1.1 ì£¼ë¬¸ ìƒì„± â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì£¼ë¬¸ ìƒì„± í˜ì´ì§€
2. `/orders` - ì£¼ë¬¸ ë‚´ì—­ (ìƒˆ ì£¼ë¬¸ í‘œì‹œ)
3. `/orders/[id]/complete` - ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€
4. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡ (ìƒˆ ì£¼ë¬¸ ì•Œë¦¼)
5. `/admin/purchase-orders` - ë°œì£¼ ì‹œìŠ¤í…œ (ì…ê¸ˆí™•ì¸ í›„)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
createOrder(orderData, userProfile, depositName)
  â†“ validates
  checkVariantInventory(variantId, quantity)
  â†“ creates
  orders, order_items, order_shipping, order_payments (INSERT)
  â†“ updates
  product_variants.inventory (UPDATE - FOR UPDATE)
  â†“ triggers
  products.inventory ìë™ ì—…ë°ì´íŠ¸ (DB trigger)
  â†“ sends (optional)
  sendOrderConfirmationEmail(orderId)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ (ë°ë“œë½ ë°©ì§€)
1. `product_variants` (FOR UPDATE) - ì¬ê³  ì ê¸ˆ
2. `orders` (INSERT) - ì£¼ë¬¸ ìƒì„±
3. `order_items` (INSERT) - ì£¼ë¬¸ í•­ëª© ìƒì„±
4. `order_shipping` (INSERT) - ë°°ì†¡ ì •ë³´ ìƒì„±
5. `order_payments` (INSERT) - ê²°ì œ ì •ë³´ ìƒì„±
6. `product_variants` (UPDATE) - ì¬ê³  ì°¨ê°
7. `products` (ìë™ ì—…ë°ì´íŠ¸) - íŠ¸ë¦¬ê±° ì‹¤í–‰

#### ğŸ“Š ë°ì´í„° íë¦„
```
BuyBottomSheet (ì˜µì…˜ ì„ íƒ)
  â†“
checkVariantInventory() - ì¬ê³  í™•ì¸
  â†“
updateVariantInventory() - ì¬ê³  ì°¨ê° (FOR UPDATE)
  â†“
sessionStorage.setItem('checkoutItem')
  â†“
router.push('/checkout')
  â†“
ì‚¬ìš©ì í”„ë¡œí•„ ë° ì£¼ì†Œ ë¡œë“œ (ë³‘ë ¬)
  â†“
AddressManager - ë°°ì†¡ì§€ ì„ íƒ
  â†“
ì…ê¸ˆìëª… ì„ íƒ ëª¨ë‹¬
  â†“
createOrder() í˜¸ì¶œ
  â”œâ”€â”€ orders INSERT
  â”œâ”€â”€ order_items INSERT (title, price, total, variant_id)
  â”œâ”€â”€ order_shipping INSERT (postal_code í•„ìˆ˜)
  â””â”€â”€ order_payments INSERT (depositor_name)
  â†“
sessionStorage.setItem('recentOrder')
  â†“
router.replace(`/orders/${orderId}/complete`)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Variant ì¬ê³  í™•ì¸ (checkVariantInventory)
- [ ] FOR UPDATE ì ê¸ˆ ì‚¬ìš© (ë™ì‹œì„± ì œì–´)
- [ ] order_itemsì— title, price, unit_price, total, total_price ëª¨ë‘ ì €ì¥
- [ ] order_typeì— ì¹´ì¹´ì˜¤ ID í¬í•¨ (ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì‹œ: `direct:KAKAO:${kakao_id}`)
- [ ] depositor_name ì €ì¥ (ìš°ì„ ìˆœìœ„: ì§ì ‘ì…ë ¥ > ë‹‰ë„¤ì„ > ê³ ê°ëª…)
- [ ] postal_code ì €ì¥ ë° ë°°ì†¡ë¹„ ê³„ì‚° (formatShippingInfo)
- [ ] payment_group_id ì €ì¥ (ì¼ê´„ê²°ì œ ì‹œ)
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì‹¤íŒ¨ ì‹œ ë¡¤ë°±)
- [ ] ì¬ê³  ë¶€ì¡± ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ë° ì‚¬ìš©ì ì•Œë¦¼
- [ ] ì´ë©”ì¼ ë°œì†¡ (ì„ íƒì )
- [ ] sessionStorageì— checkoutItem, recentOrder ì €ì¥

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **Variant ì¬ê³  ê´€ë¦¬** (ì¬ê³  ì°¨ê°)
- **ë°°ì†¡ë¹„ ê³„ì‚°** (ë„ì„œì‚°ê°„ ì¶”ê°€ë¹„)
- **ë°œì£¼ ì‹œìŠ¤í…œ** (ì…ê¸ˆí™•ì¸ ì™„ë£Œ ì£¼ë¬¸)
- **ì´ë©”ì¼ ë°œì†¡** (ì£¼ë¬¸ í™•ì¸ ë©”ì¼)
- **í”„ë¡œí•„ ê´€ë¦¬** (ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ)
- **ì£¼ì†Œ ê´€ë¦¬** (ë°°ì†¡ì§€ ì„ íƒ)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì¤‘ë³µ ì»¬ëŸ¼**: price/unit_price, total/total_price ì–‘ìª½ ëª¨ë‘ ì €ì¥ í•„ìˆ˜
- **ì¹´ì¹´ì˜¤ ì‚¬ìš©ì**: user_idëŠ” NULL, order_typeì— kakao_id ì €ì¥
- **ì¬ê³  ì°¨ê° ì‹œì **: ì£¼ë¬¸ ìƒì„± ì „ (ì²´í¬ì•„ì›ƒ ì§„ì… ì‹œ)
- **ë°°ì†¡ë¹„ 0ì›**: pending ìƒíƒœì—ì„œëŠ” ë°°ì†¡ë¹„ ë¯¸ê³„ì‚° (ê²°ì œ í™•ì¸ ì‹œ ê³„ì‚°)

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-03: ìš°í¸ë²ˆí˜¸ ì‹œìŠ¤í…œ í†µí•© (ë°°ì†¡ë¹„ ìë™ ê³„ì‚°)
- 2025-10-02: ë°œì£¼ ì‹œìŠ¤í…œ ì—°ë™
- 2025-10-01: Variant ì‹œìŠ¤í…œìœ¼ë¡œ ì „í™˜

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **DB**: DB_REFERENCE_GUIDE.md Â§ 6.1
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ì²´í¬ì•„ì›ƒ í˜ì´ì§€
- **ì½”ë“œ**: lib/supabaseApi.js - createOrder(), createOrderWithOptions()
- **í˜ì´ì§€**: app/checkout/page.js

---

### 1.2 ì£¼ë¬¸ ì¡°íšŒ (ì‚¬ìš©ì) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders` - ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€
2. `/orders/[id]/complete` - ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€
3. `/mypage` - ë§ˆì´í˜ì´ì§€ (ìµœê·¼ ì£¼ë¬¸)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
getUserOrders(userId)
  â†“ or (ì¹´ì¹´ì˜¤ ì‚¬ìš©ì)
getUserOrdersByOrderType(orderType)
  â†“ joins
  orders + order_items + products + order_shipping
  â†“ calculates
  formatShippingInfo(baseShipping, postalCode)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `orders` (SELECT) - ì‚¬ìš©ì ì£¼ë¬¸ ì¡°íšŒ
2. `order_items` (SELECT) - ì£¼ë¬¸ í•­ëª© ì¡°íšŒ
3. `products` (SELECT) - ìƒí’ˆ ì •ë³´ ì¡°íšŒ
4. `order_shipping` (SELECT) - ë°°ì†¡ ì •ë³´ ì¡°íšŒ

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] UserProfileManager ì‚¬ìš© (ì¹´ì¹´ì˜¤/ì¼ë°˜ ì‚¬ìš©ì êµ¬ë¶„)
- [ ] order_typeìœ¼ë¡œ ëŒ€ì²´ ì¡°íšŒ (ì¹´ì¹´ì˜¤ ì‚¬ìš©ì: `LIKE '%KAKAO:${kakao_id}%'`)
- [ ] payment_group_id ê¸°ì¤€ ê·¸ë£¹í™” (ì¼ê´„ê²°ì œ ì£¼ë¬¸)
- [ ] postal_code ê¸°ë°˜ ë°°ì†¡ë¹„ ê³„ì‚° (formatShippingInfo)
- [ ] íƒ€ì„ìŠ¤íƒ¬í”„ í‘œì‹œ (created_at, deposited_at, shipped_at ë“±)
- [ ] ìƒíƒœë³„ í•„í„°ë§ (pending/verifying/paid/delivered)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì‚¬ìš©ì ì¸ì¦** (ì¹´ì¹´ì˜¤/ì¼ë°˜ ì‚¬ìš©ì êµ¬ë¶„)
- **ë°°ì†¡ë¹„ ê³„ì‚°** (ë„ì„œì‚°ê°„ ì¶”ê°€ë¹„)
- **ì£¼ë¬¸ ìƒíƒœ ë³€ê²½** (ì·¨ì†Œ, ìˆ˜ëŸ‰ ì¡°ì ˆ)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **DB**: DB_REFERENCE_GUIDE.md Â§ 4.1
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€
- **ì½”ë“œ**: lib/supabaseApi.js - getOrders()
- **í˜ì´ì§€**: app/orders/page.js

---

### 1.3 ì£¼ë¬¸ ì¡°íšŒ (ê´€ë¦¬ì) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡
2. `/admin/orders/[id]` - ê´€ë¦¬ì ì£¼ë¬¸ ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- `getAllOrders()` - ì „ì²´ ì£¼ë¬¸ ì¡°íšŒ (profiles JOIN)

#### ğŸ—„ï¸ DB ì‘ì—…
- `orders`, `order_items`, `order_shipping`, `order_payments`, `profiles` JOIN

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ê´€ë¦¬ì ì£¼ë¬¸ ê´€ë¦¬
- **ì½”ë“œ**: lib/supabaseApi.js - getAllOrders()

---

### 1.4 ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders/[id]/complete` - ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€
2. `/admin/orders/[id]` - ê´€ë¦¬ì ì£¼ë¬¸ ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- `getOrderById(orderId)` - ì£¼ë¬¸ ë‹¨ì¼ ì¡°íšŒ

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getOrderById()

---

### 1.5 ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡ (ìƒíƒœ ë³€ê²½ ë²„íŠ¼)
2. `/admin/orders/[id]` - ê´€ë¦¬ì ì£¼ë¬¸ ìƒì„¸ (ìƒíƒœ ë³€ê²½ ì•¡ì…˜)
3. `/admin/deposits` - ì…ê¸ˆ ê´€ë¦¬ (pending â†’ verifying)
4. `/admin/shipping` - ë°œì†¡ ê´€ë¦¬ (paid â†’ delivered)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
updateOrderStatus(orderId, status, paymentData)
  â†“ updates
  orders.status (UPDATE)
  â†“ records
  íƒ€ì„ìŠ¤íƒ¬í”„ ìë™ ê¸°ë¡ (verifying_at, paid_at, delivered_at, cancelled_at)
  â†“ updates (optional)
  order_payments (UPDATE)
  â†“ logs
  logger.info() - ì´ëª¨ì§€ í¬í•¨ ë¡œê·¸
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `orders` (UPDATE) - status ë³€ê²½
2. íƒ€ì„ìŠ¤íƒ¬í”„ ì»¬ëŸ¼ ìë™ ì—…ë°ì´íŠ¸ (ìƒíƒœë³„)
3. `order_payments` (UPDATE - optional) - ê²°ì œ ì •ë³´ ì—…ë°ì´íŠ¸

#### ğŸ“Š ìƒíƒœ ì „í™˜ íë¦„
```
pending (ê²°ì œëŒ€ê¸°)
  â†“ ì…ê¸ˆ í™•ì¸
verifying (ê²°ì œí™•ì¸ì¤‘)
  â†“ ê²°ì œ í™•ì¸
paid (ê²°ì œì™„ë£Œ)
  â†“ ë°œì†¡ ì²˜ë¦¬
delivered (ë°œì†¡ì™„ë£Œ)

ë˜ëŠ”

pending/verifying/paid
  â†“ ì·¨ì†Œ
cancelled (ì·¨ì†Œë¨)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] íƒ€ì„ìŠ¤íƒ¬í”„ ìë™ ê¸°ë¡ í™•ì¸
  - `pending â†’ verifying`: verifying_at ê¸°ë¡
  - `verifying â†’ paid`: paid_at ê¸°ë¡
  - `paid â†’ delivered`: delivered_at ê¸°ë¡
  - `â†’ cancelled`: cancelled_at ê¸°ë¡
- [ ] ë¡œê·¸ í™•ì¸ (ğŸ•, ğŸ’°, ğŸšš ì´ëª¨ì§€)
- [ ] order_payments ì—…ë°ì´íŠ¸ (optional)
- [ ] ë°œì£¼ ì‹œìŠ¤í…œ ì—°ë™ (paid ìƒíƒœ ì „í™˜ ì‹œ)
- [ ] ì¬ê³  ë³µì› (cancelled ìƒíƒœ ì „í™˜ ì‹œ)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ë°œì£¼ ì‹œìŠ¤í…œ** (paid ìƒíƒœ ì£¼ë¬¸ ìë™ ë°œì£¼)
- **ì¬ê³  ë³µì›** (ì£¼ë¬¸ ì·¨ì†Œ ì‹œ)
- **ì´ë©”ì¼ ë°œì†¡** (ìƒíƒœ ë³€ê²½ ì•Œë¦¼)
- **ì¼ê´„ ìƒíƒœ ë³€ê²½** (ê·¸ë£¹ ì£¼ë¬¸)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ì **: ëª¨ë“  ìƒíƒœ ì „í™˜ ì‹œì  ê¸°ë¡
- **ë¡œê·¸ ì´ëª¨ì§€**: ğŸ•(ì‹œê°„), ğŸ’°(ê²°ì œ), ğŸšš(ë°°ì†¡), âœ…(ì„±ê³µ), âŒ(ì‹¤íŒ¨)
- **ë°œì£¼ ì—°ë™**: paid ìƒíƒœë¡œ ì „í™˜ ì‹œ ë°œì£¼ì„œ ìë™ ìƒì„± ê°€ëŠ¥

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-02: ë°œì£¼ ì‹œìŠ¤í…œ ì—°ë™ ì¶”ê°€
- 2025-10-01: íƒ€ì„ìŠ¤íƒ¬í”„ ìë™ ê¸°ë¡ ë¡œì§ ê°œì„ 

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **DB**: DB_REFERENCE_GUIDE.md Â§ 3.2
- **ì½”ë“œ**: lib/supabaseApi.js - updateOrderStatus()

---

### 1.6 ì¼ê´„ ìƒíƒœ ë³€ê²½ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡ (ê·¸ë£¹ ì£¼ë¬¸ ìƒíƒœ ë³€ê²½)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
updateMultipleOrderStatus(orderIds, status, paymentData)
  â†“ loops
  orderIds.forEach(orderId => updateOrderStatus(orderId, status, paymentData))
  â†“ updates
  order_shipping (ì¼ê´„ ì—…ë°ì´íŠ¸ - optional)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `orders` (UPDATE) - ì—¬ëŸ¬ ì£¼ë¬¸ IDì— ëŒ€í•´ ìˆœì°¨ ì—…ë°ì´íŠ¸
2. `order_payments` (UPDATE - optional)
3. `order_shipping` (UPDATE - optional)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] orderIds ë°°ì—´ ê²€ì¦
- [ ] ê° ì£¼ë¬¸ì— ëŒ€í•´ updateOrderStatus í˜¸ì¶œ
- [ ] ì‹¤íŒ¨í•œ ì£¼ë¬¸ ID ì¶”ì  ë° ì—ëŸ¬ ì²˜ë¦¬
- [ ] ì¼ê´„ ë°°ì†¡ ì •ë³´ ì—…ë°ì´íŠ¸ (optional)
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì „ì²´ ì„±ê³µ ë˜ëŠ” ì „ì²´ ë¡¤ë°±)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ë¬¸ ìƒíƒœ ë³€ê²½** (ê°œë³„ ì£¼ë¬¸)
- **ì¼ê´„ê²°ì œ ì²˜ë¦¬** (payment_group_id ì£¼ë¬¸ë“¤)
- **ë°œì£¼ ì‹œìŠ¤í…œ** (paid ìƒíƒœ ì „í™˜ ì‹œ)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - updateMultipleOrderStatus()

---

### 1.7 ì£¼ë¬¸ ì·¨ì†Œ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders` - ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€ (ì·¨ì†Œ ë²„íŠ¼)
2. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡ (ì·¨ì†Œ ë²„íŠ¼)
3. `/admin/orders/[id]` - ê´€ë¦¬ì ì£¼ë¬¸ ìƒì„¸ (ì·¨ì†Œ ì•¡ì…˜)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
cancelOrder(orderId)
  â†“ updates
  orders.status = 'cancelled'
  orders.cancelled_at = NOW()
  â†“ restores (í•„ìš” ì‹œ)
  product_variants.inventory (ì¬ê³  ë³µì›)
  â†“ logs
  logger.info('ì£¼ë¬¸ ì·¨ì†Œë¨', orderId)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `orders` (SELECT) - ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
2. `order_items` (SELECT) - ì£¼ë¬¸ í•­ëª© ì¡°íšŒ
3. `product_variants` (UPDATE) - ì¬ê³  ë³µì› (FOR UPDATE)
4. `orders` (UPDATE) - status='cancelled', cancelled_at ê¸°ë¡

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì·¨ì†Œ ê°€ëŠ¥í•œ ìƒíƒœì¸ì§€ í™•ì¸ (pending, verifyingë§Œ ì·¨ì†Œ ê°€ëŠ¥)
- [ ] ì¬ê³  ë³µì› ë¡œì§ ì‹¤í–‰ (updateVariantInventory)
- [ ] cancelled_at íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì¬ê³  ë³µì› ì‹¤íŒ¨ ì‹œ ë¡¤ë°±)
- [ ] ì´ë©”ì¼ ë°œì†¡ (ì£¼ë¬¸ ì·¨ì†Œ ì•Œë¦¼)
- [ ] í™˜ë¶ˆ ì²˜ë¦¬ (ê²°ì œ ì™„ë£Œ í›„ ì·¨ì†Œ ì‹œ)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì¬ê³  ë³µì›** (Variant ì¬ê³  ì¦ê°€)
- **í™˜ë¶ˆ ì²˜ë¦¬** (ê²°ì œ ì™„ë£Œ í›„ ì·¨ì†Œ)
- **ì´ë©”ì¼ ë°œì†¡** (ì·¨ì†Œ ì•Œë¦¼)
- **ì£¼ë¬¸ ìƒíƒœ ë³€ê²½** (cancelled)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì¬ê³  ë³µì›**: FOR UPDATE ì ê¸ˆ ì‚¬ìš© (ë™ì‹œì„± ì œì–´)
- **ì·¨ì†Œ ê°€ëŠ¥ ìƒíƒœ**: pending, verifyingë§Œ ì·¨ì†Œ ê°€ëŠ¥ (paid, deliveredëŠ” í™˜ë¶ˆ ì²˜ë¦¬)
- **íƒ€ì„ìŠ¤íƒ¬í”„**: cancelled_at ìë™ ê¸°ë¡

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-01: Variant ì¬ê³  ë³µì› ë¡œì§ ì¶”ê°€

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **DB**: DB_REFERENCE_GUIDE.md Â§ 6.2
- **ì½”ë“œ**: lib/supabaseApi.js - cancelOrder()

---

### 1.8 í™˜ë¶ˆ ì²˜ë¦¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders/[id]` - ê´€ë¦¬ì ì£¼ë¬¸ ìƒì„¸ (í™˜ë¶ˆ ì²˜ë¦¬ ë²„íŠ¼)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- í˜„ì¬ ë³„ë„ í•¨ìˆ˜ ì—†ìŒ (ì£¼ë¬¸ ì·¨ì†Œ + ìˆ˜ë™ í™˜ë¶ˆ ì²˜ë¦¬)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í™˜ë¶ˆ ê°€ëŠ¥ ìƒíƒœ í™•ì¸ (paid, delivered)
- [ ] í™˜ë¶ˆ ê¸ˆì•¡ ê³„ì‚° (ìƒí’ˆê¸ˆì•¡ + ë°°ì†¡ë¹„)
- [ ] ì¬ê³  ë³µì› ì—¬ë¶€ ê²°ì •
- [ ] í™˜ë¶ˆ ì‚¬ìœ  ê¸°ë¡
- [ ] ê³ ê° ì•Œë¦¼ (ì´ë©”ì¼/SMS)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë¯¸êµ¬í˜„**: í˜„ì¬ ìˆ˜ë™ í™˜ë¶ˆ ì²˜ë¦¬ (ìë™í™” ì˜ˆì •)
- **í™˜ë¶ˆ ë°©ë²•**: ê³„ì¢Œì´ì²´ ì—­ì…ê¸ˆ

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ë¬¸ ì·¨ì†Œ** (cancelled ìƒíƒœ ì „í™˜)
- **ì¬ê³  ë³µì›** (ì„ íƒì )

---

### 1.9 ì£¼ë¬¸ ì•„ì´í…œ ìˆ˜ëŸ‰ ë³€ê²½ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders` - ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€ (ìˆ˜ëŸ‰ ì¡°ì ˆ ë²„íŠ¼)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
updateOrderItemQuantity(itemId, quantity)
  â†“ updates
  order_items.quantity, total_price
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `order_items` (UPDATE) - quantity, total, total_price

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] pending ìƒíƒœì—ì„œë§Œ ìˆ˜ëŸ‰ ë³€ê²½ ê°€ëŠ¥
- [ ] price ê¸°ì¤€ìœ¼ë¡œ total_price ì¬ê³„ì‚°
- [ ] total, total_price ì–‘ìª½ ëª¨ë‘ ì—…ë°ì´íŠ¸
- [ ] ì˜µí‹°ë¯¸ìŠ¤í‹± ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)
- [ ] ìˆ˜ëŸ‰ 1 ë¯¸ë§Œ ë°©ì§€

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì˜µí‹°ë¯¸ìŠ¤í‹± ì—…ë°ì´íŠ¸**: UI ë¨¼ì € ì—…ë°ì´íŠ¸, ì„œë²„ ë™ê¸°í™”
- **ì´ ê¸ˆì•¡ ìë™ ì¬ê³„ì‚°**: quantity Ã— price

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - updateOrderItemQuantity()

---

### 1.10 ì£¼ë¬¸ë²ˆí˜¸ ìƒì„± [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì£¼ë¬¸ ìƒì„± ì‹œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
generateCustomerOrderNumber()
  â†“ returns
  'YYYYMMDD-XXXX' (ë‚ ì§œ + ëœë¤ 4ìë¦¬)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë‚ ì§œ í˜•ì‹: YYYYMMDD
- [ ] ëœë¤ 4ìë¦¬: 0000~9999
- [ ] ì¤‘ë³µ ì²´í¬ (í•„ìš” ì‹œ)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **í˜•ì‹**: `20251003-1234`
- **ì¤‘ë³µ ê°€ëŠ¥ì„±**: ë§¤ìš° ë‚®ìŒ (ë‚ ì§œ + ëœë¤)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - generateCustomerOrderNumber()

---

### 1.11 ê·¸ë£¹ ì£¼ë¬¸ë²ˆí˜¸ ìƒì„± [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì¼ê´„ê²°ì œ ì‹œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
generateGroupOrderNumber(paymentGroupId)
  â†“ returns
  'GROUP-{UUID}' í˜•ì‹
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] payment_group_id ê¸°ë°˜ ìƒì„±
- [ ] GROUP- ì ‘ë‘ì–´ í•„ìˆ˜
- [ ] UUID í˜•ì‹ ìœ ì§€

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì¼ê´„ê²°ì œ ì²˜ë¦¬** (payment_group_id)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - generateGroupOrderNumber()

---

### 1.12 ì…ê¸ˆ í™•ì¸ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/deposits` - ì…ê¸ˆ ê´€ë¦¬ í˜ì´ì§€
2. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
getAllOrders()
  â†“ filters
  payment.method='bank_transfer' && status IN ('pending', 'verifying')
  â†“ calls
  updateOrderStatus(orderId, 'verifying')
  â†“ or
  updateOrderStatus(orderId, 'paid')
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `orders` (SELECT) - ê³„ì¢Œì´ì²´ ì£¼ë¬¸ ì¡°íšŒ
- `orders` (UPDATE) - status ë³€ê²½ (pending â†’ verifying â†’ paid)

#### ğŸ“Š ë°ì´í„° íë¦„
```
ì…ê¸ˆ ê´€ë¦¬ í˜ì´ì§€
  â†“
ê³„ì¢Œì´ì²´ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ
  â†“
ì—‘ì…€ ì—…ë¡œë“œ (ì€í–‰ ê±°ë˜ ë‚´ì—­)
  â†“
ì…ê¸ˆìëª… ë§¤ì¹­ (ìë™ + ìˆ˜ë™)
  â†“
pending â†’ verifying (ì…ê¸ˆ í™•ì¸)
  â†“
verifying â†’ paid (ê²°ì œ í™•ì¸)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì—‘ì…€ íŒŒì¼ íŒŒì‹± (XLSX)
- [ ] ì…ê¸ˆìëª… ë§¤ì¹­ (depositor_name)
- [ ] ê¸ˆì•¡ ê²€ì¦ (order.total_amount)
- [ ] ë¹ ë¥¸ ê²€ìƒ‰ ê¸°ëŠ¥ (ì£¼ë¬¸ë²ˆí˜¸/ê³ ê°ëª…/ì…ê¸ˆìëª…)
- [ ] íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡ (verifying_at, paid_at)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì—‘ì…€ ì—…ë¡œë“œ**: XLSX.js ì‚¬ìš©
- **ì…ê¸ˆìëª… ìš°ì„ ìˆœìœ„**: payment.depositor_name > nickname > name
- **ìˆ˜ë™ ê²€ì¦**: ê´€ë¦¬ìê°€ ìµœì¢… í™•ì¸

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **í˜ì´ì§€**: app/admin/deposits/page.js
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ì…ê¸ˆ ê´€ë¦¬

---

### 1.13 ë°°ì†¡ ì²˜ë¦¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/shipping` - ë°œì†¡ ê´€ë¦¬ í˜ì´ì§€
2. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
updateOrderStatus(orderId, 'delivered', { tracking_number })
  â†“ updates
  orders.status = 'delivered'
  orders.delivered_at = NOW()
  order_shipping.tracking_number
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `orders` (UPDATE) - status='delivered', delivered_at
- `order_shipping` (UPDATE) - tracking_number (optional)

#### ğŸ“Š ë°ì´í„° íë¦„
```
ë°œì†¡ ê´€ë¦¬ í˜ì´ì§€
  â†“
ê²°ì œì™„ë£Œ ì£¼ë¬¸ ëª©ë¡ (status='paid')
  â†“
ì†¡ì¥ë²ˆí˜¸ ì…ë ¥ (optional)
  â†“
ì¼ê´„ ë°œì†¡ ì²˜ë¦¬ ë˜ëŠ” ê°œë³„ ë°œì†¡
  â†“
paid â†’ delivered
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] paid ìƒíƒœë§Œ ë°œì†¡ ê°€ëŠ¥
- [ ] ì†¡ì¥ë²ˆí˜¸ ì…ë ¥ (optional)
- [ ] ë°°ì†¡ì§€ ì •ë³´ í™•ì¸
- [ ] delivered_at íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡
- [ ] ê³ ê° ì•Œë¦¼ (ì´ë©”ì¼/SMS)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì†¡ì¥ë²ˆí˜¸**: ì„ íƒì  ì…ë ¥
- **ì¼ê´„ ì²˜ë¦¬**: ì—¬ëŸ¬ ì£¼ë¬¸ ë™ì‹œ ë°œì†¡ ê°€ëŠ¥

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **í˜ì´ì§€**: app/admin/shipping/page.js

---

### 1.14 ë°°ì†¡ ì™„ë£Œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/shipping` - ë°œì†¡ ê´€ë¦¬ í˜ì´ì§€
2. `/orders/[id]/complete` - ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- updateOrderStatus(orderId, 'delivered')

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **í˜„ì¬ ì‹œìŠ¤í…œ**: delivered ìƒíƒœê°€ ìµœì¢… ìƒíƒœ
- **í–¥í›„ í™•ì¥**: ë°°ì†¡ ì™„ë£Œ(confirmed) ìƒíƒœ ì¶”ê°€ ê°€ëŠ¥

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ë°°ì†¡ ì²˜ë¦¬** (1.13)

---

### 1.15 ì£¼ë¬¸ ê²€ìƒ‰ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡
2. `/admin/deposits` - ì…ê¸ˆ ê´€ë¦¬
3. `/admin/shipping` - ë°œì†¡ ê´€ë¦¬

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ê²€ìƒ‰ í•„í„°ë§
orders.filter(order =>
  order.customer_order_number.includes(searchTerm) ||
  order.user?.name.includes(searchTerm) ||
  order.order_items.some(item => item.title.includes(searchTerm)) ||
  order.payment?.depositor_name?.includes(searchTerm)
)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì£¼ë¬¸ë²ˆí˜¸ ê²€ìƒ‰
- [ ] ê³ ê°ëª… ê²€ìƒ‰
- [ ] ìƒí’ˆëª… ê²€ìƒ‰
- [ ] ì…ê¸ˆìëª… ê²€ìƒ‰ (ê³„ì¢Œì´ì²´)
- [ ] ì‹¤ì‹œê°„ ê²€ìƒ‰ (onChange)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§**: ë©”ëª¨ë¦¬ ë‚´ ê²€ìƒ‰ (ë¹ ë¦„)
- **ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ**: toLowerCase() ì‚¬ìš©

---

### 1.16 ì£¼ë¬¸ í•„í„°ë§ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ê²°ì œ ë°©ë²•ë³„ íƒ­ í•„í„°ë§
- ê²°ì œëŒ€ê¸° (pending)
- ê³„ì¢Œì´ì²´ (bank_transfer + verifying)
- ì¹´ë“œê²°ì œ (card + verifying)
- ê²°ì œì™„ë£Œ (paid)
- ë°œì†¡ì™„ë£Œ (delivered)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìƒíƒœë³„ í•„í„° (status)
- [ ] ê²°ì œ ë°©ë²•ë³„ í•„í„° (payment.method)
- [ ] ë‚ ì§œ ë²”ìœ„ í•„í„° (ì„ íƒì )
- [ ] ë³µí•© í•„í„° ì§€ì›

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **íƒ­ ë°©ì‹**: ìƒíƒœ + ê²°ì œ ë°©ë²• ì¡°í•©
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: í•„í„° ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜

---

### 1.17 ì£¼ë¬¸ í†µê³„ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin` - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ì˜ˆì •)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë¯¸êµ¬í˜„**: í˜„ì¬ ê¸°ë³¸ í†µê³„ë§Œ í‘œì‹œ
- **í–¥í›„ ê¸°ëŠ¥**:
  - ì¼ë³„/ì£¼ë³„/ì›”ë³„ ì£¼ë¬¸ í†µê³„
  - ë§¤ì¶œ í†µê³„
  - ìƒí’ˆë³„ íŒë§¤ í†µê³„
  - ê²°ì œ ë°©ë²•ë³„ í†µê³„

---

### 1.18 ì£¼ë¬¸ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡ (ì˜ˆì •)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë¯¸êµ¬í˜„**: ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì˜ˆì •
- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: XLSX.js ì‚¬ìš© ì˜ˆì •
- **í¬í•¨ ì •ë³´**:
  - ì£¼ë¬¸ë²ˆí˜¸, ì£¼ë¬¸ì¼ì‹œ
  - ê³ ê°ëª…, ì—°ë½ì²˜, ì£¼ì†Œ
  - ìƒí’ˆëª…, ìˆ˜ëŸ‰, ê¸ˆì•¡
  - ê²°ì œ ë°©ë²•, ì…ê¸ˆìëª…
  - ë°°ì†¡ ìƒíƒœ

---

### 1.19 ì¼ê´„ê²°ì œ ì²˜ë¦¬ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders` - ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€ (ì¼ê´„ê²°ì œ ë²„íŠ¼)
2. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì¼ê´„ê²°ì œ ëª¨ë“œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
// ì²´í¬ì•„ì›ƒ í˜ì´ì§€ì—ì„œ
updateMultipleOrderStatus(orderIds, 'verifying', paymentData)
  â†“ updates
  ê° ì£¼ë¬¸ì˜ status ë³€ê²½
  payment_group_id ì €ì¥
  â†“ generates
  GROUP-${paymentGroupId} ì£¼ë¬¸ë²ˆí˜¸
```

#### ğŸ“Š ë°ì´í„° íë¦„
```
/orders í˜ì´ì§€
  â†“
ê²°ì œëŒ€ê¸° ì£¼ë¬¸ë“¤ì˜ ì´ ê¸ˆì•¡ ê³„ì‚°
  â”œâ”€â”€ ìƒí’ˆê¸ˆì•¡ í•©ê³„
  â””â”€â”€ ë°°ì†¡ë¹„ (4,000ì› ê³ ì •)
  â†“
ì¼ê´„ê²°ì œ ë²„íŠ¼ í´ë¦­
  â†“
sessionStorageì— ê°„ì†Œí™”ëœ ë°ì´í„° ì €ì¥
  {
    isBulkPayment: true,
    originalOrderIds: [...],
    items: [...],
    totalAmount,
    shippingFee
  }
  â†“
router.push('/checkout?mode=bulk')
  â†“
ì²´í¬ì•„ì›ƒ í˜ì´ì§€
  â†“
updateMultipleOrderStatus(originalOrderIds, 'verifying', paymentData)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] sessionStorage ìš©ëŸ‰ ì œí•œ ëŒ€ì‘ (ê°„ì†Œí™”ëœ ë°ì´í„°ë§Œ ì €ì¥)
- [ ] payment_group_id ìƒì„± ë° ì €ì¥
- [ ] ëª¨ë“  ì£¼ë¬¸ì˜ ìƒíƒœ ì¼ê´„ ë³€ê²½
- [ ] GROUP-${paymentGroupId} í˜•ì‹ ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±
- [ ] ì´ ê²°ì œê¸ˆì•¡ ì •í™•ì„± ê²€ì¦
- [ ] ë°°ì†¡ë¹„ ê³„ì‚° (4,000ì› ê³ ì • ë˜ëŠ” ë„ì„œì‚°ê°„ ì¶”ê°€)
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì „ì²´ ì„±ê³µ ë˜ëŠ” ì „ì²´ ë¡¤ë°±)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ë¬¸ ì¡°íšŒ** (ê·¸ë£¹ ì£¼ë¬¸ í‘œì‹œ)
- **ì¼ê´„ ìƒíƒœ ë³€ê²½** (updateMultipleOrderStatus)
- **ë°°ì†¡ë¹„ ê³„ì‚°** (formatShippingInfo)
- **ì£¼ë¬¸ ìƒíƒœ ë³€ê²½** (ê°œë³„ ì£¼ë¬¸)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **sessionStorage ìš©ëŸ‰**: ê°„ì†Œí™”ëœ ë°ì´í„°ë§Œ ì €ì¥ (ì´ë¯¸ì§€ URL ì œì™¸)
- **payment_group_id**: UUID ìƒì„± í›„ ëª¨ë“  ì£¼ë¬¸ì— ì €ì¥
- **ê·¸ë£¹ ì£¼ë¬¸ë²ˆí˜¸**: `GROUP-${paymentGroupId}` í˜•ì‹
- **ë°°ì†¡ë¹„**: ì¼ê´„ê²°ì œ ì‹œ 4,000ì› ê³ ì • (í–¥í›„ ê°œì„  í•„ìš”)

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-01: sessionStorage ìš©ëŸ‰ ë¬¸ì œ í•´ê²° (ê°„ì†Œí™”ëœ ë°ì´í„°)
- 2025-09-30: ì¼ê´„ê²°ì œ ê¸°ëŠ¥ ì¶”ê°€

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€
- **ì½”ë“œ**: lib/supabaseApi.js - updateMultipleOrderStatus(), generateGroupOrderNumber()
- **í˜ì´ì§€**: app/orders/page.js, app/checkout/page.js

---

### 1.20 ê²°ì œ ìˆ˜ë‹¨ ë³€ê²½ [ì¼ë°˜]

---

## 2. ìƒí’ˆ ê´€ë ¨ ê¸°ëŠ¥

### 2.1 ìƒí’ˆ ë“±ë¡ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡ í˜ì´ì§€
2. `/admin/products` - ìƒí’ˆ ëª©ë¡ (ìƒˆ ìƒí’ˆ í‘œì‹œ)
3. `/` - í™ˆ í˜ì´ì§€ (ë¼ì´ë¸Œ í™œì„±í™” ì‹œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
addProduct(productData)
  â†“ inserts
  products (INSERT)
  â†“ inserts (ì˜µì…˜ ìˆëŠ” ê²½ìš°)
  product_options, product_option_values (INSERT)
  â†“ creates (ì˜µì…˜ ìˆëŠ” ê²½ìš°)
  product_variants (createVariant)
  â†“ maps
  variant_option_values (ë§¤í•‘ í…Œì´ë¸” INSERT)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `products` (INSERT) - ìƒí’ˆ ê¸°ë³¸ ì •ë³´ ìƒì„±
2. `product_options` (INSERT - optional) - ì˜µì…˜ ìƒì„±
3. `product_option_values` (INSERT - optional) - ì˜µì…˜ê°’ ìƒì„±
4. `product_variants` (INSERT - optional) - Variant ìƒì„±
5. `variant_option_values` (INSERT - optional) - Variant-ì˜µì…˜ê°’ ë§¤í•‘

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í•„ìˆ˜ í•„ë“œ ê²€ì¦ (title, price, description)
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ (Supabase Storage)
- [ ] ì˜µì…˜ ì¡°í•© ìƒì„± (ì˜µì…˜ ìˆëŠ” ê²½ìš°)
- [ ] Variant ìë™ ìƒì„± (ì˜µì…˜ ìˆëŠ” ê²½ìš°)
- [ ] SKU ìë™ ìƒì„± ë˜ëŠ” ìˆ˜ë™ ì…ë ¥
- [ ] ì´ˆê¸° ì¬ê³  ì„¤ì •
- [ ] ì¹´í…Œê³ ë¦¬ ì—°ê²°
- [ ] ê³µê¸‰ì—…ì²´ ì—°ê²°
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì „ì²´ ì„±ê³µ ë˜ëŠ” ì „ì²´ ë¡¤ë°±)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **Variant ìƒì„±** (ì˜µì…˜ ìˆëŠ” ê²½ìš°)
- **ì˜µì…˜ ê´€ë¦¬** (ì˜µì…˜ ìƒì„±)
- **ì´ë¯¸ì§€ ì—…ë¡œë“œ** (Supabase Storage)
- **ì¹´í…Œê³ ë¦¬ ê´€ë¦¬** (ì¹´í…Œê³ ë¦¬ ì—°ê²°)
- **ê³µê¸‰ì—…ì²´ ê´€ë¦¬** (ê³µê¸‰ì—…ì²´ ì—°ê²°)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - addProduct(), createProductWithOptions()
- **í˜ì´ì§€**: app/admin/products/new/page.js

---

### 2.2 ìƒí’ˆ ìˆ˜ì • â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ìƒí’ˆ ìƒì„¸ ìˆ˜ì • í˜ì´ì§€
2. `/admin/products` - ìƒí’ˆ ëª©ë¡ (ìˆ˜ì •ëœ ìƒí’ˆ í‘œì‹œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
updateProduct(productId, productData)
  â†“ updates
  products (UPDATE)
  â†“ recreates (ì˜µì…˜ ë³€ê²½ ì‹œ)
  product_options (DELETE â†’ INSERT)
  product_option_values (DELETE â†’ INSERT)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `products` (UPDATE) - ìƒí’ˆ ì •ë³´ ìˆ˜ì •
2. `product_options` (DELETE) - ê¸°ì¡´ ì˜µì…˜ ì‚­ì œ
3. `product_options` (INSERT) - ìƒˆ ì˜µì…˜ ìƒì„±
4. `product_option_values` (DELETE) - ê¸°ì¡´ ì˜µì…˜ê°’ ì‚­ì œ
5. `product_option_values` (INSERT) - ìƒˆ ì˜µì…˜ê°’ ìƒì„±

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì˜µì…˜ ë³€ê²½ ì‹œ ê¸°ì¡´ Variant ì²˜ë¦¬ (ì‚­ì œ ë˜ëŠ” ë¹„í™œì„±í™”)
- [ ] ì¬ê³  ë³€ê²½ ì‹œ Variant ì¬ê³  ë™ê¸°í™”
- [ ] ì´ë¯¸ì§€ ë³€ê²½ ì‹œ ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ (Supabase Storage)
- [ ] ê°€ê²© ë³€ê²½ ì‹œ Variant ê°€ê²© ë™ê¸°í™” (optional)
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš©

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **Variant ê´€ë¦¬** (ì˜µì…˜ ë³€ê²½ ì‹œ Variant ì¬ìƒì„±)
- **ì´ë¯¸ì§€ ì—…ë¡œë“œ** (ì´ë¯¸ì§€ ë³€ê²½)
- **ì¬ê³  ê´€ë¦¬** (ì¬ê³  ë™ê¸°í™”)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - updateProduct()

---

### 2.3 ìƒí’ˆ ì‚­ì œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡
2. `/admin/products/[id]` - ê´€ë¦¬ì ìƒí’ˆ ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
deleteProduct(productId)
  â†“ updates (soft delete)
  products.status = 'deleted'
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - status='deleted' (soft delete)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Soft delete ì‚¬ìš© (ë³µêµ¬ ê°€ëŠ¥)
- [ ] ê´€ë ¨ ì£¼ë¬¸ í™•ì¸ (ì‚­ì œ ê°€ëŠ¥ ì—¬ë¶€)
- [ ] Variantë„ í•¨ê»˜ ë¹„í™œì„±í™”
- [ ] ë¼ì´ë¸Œì—ì„œ ìë™ ì œê±°

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Soft Delete**: ì‹¤ì œ ì‚­ì œ ëŒ€ì‹  status='deleted'
- **ë³µêµ¬ ê°€ëŠ¥**: deleted ìƒíƒœì—ì„œ activeë¡œ ë³€ê²½ ê°€ëŠ¥

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - deleteProduct()

---

### 2.4 ìƒí’ˆ ì¡°íšŒ (ì‚¬ìš©ì) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/` - í™ˆ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getProducts(filters)
  â†“ filters
  status='active' AND is_live=true AND is_live_active=true
  â†“ joins
  product_variants (ë³‘ë ¬ ë¡œë“œ)
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (SELECT) - í™œì„± + ë¼ì´ë¸Œ ë…¸ì¶œ ìƒí’ˆ
- `product_variants` (SELECT) - ê° ìƒí’ˆì˜ Variant

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í™œì„± ìƒí’ˆë§Œ í‘œì‹œ (status='active')
- [ ] ë¼ì´ë¸Œ í™œì„±í™” ìƒí’ˆë§Œ (is_live_active=true)
- [ ] Variant ì •ë³´ ë³‘ë ¬ ë¡œë“œ
- [ ] ì´ ì¬ê³  ê³„ì‚° (ëª¨ë“  Variant í•©ê³„)
- [ ] ì˜µì…˜ ì •ë³´ ì¶”ì¶œ

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: useRealtimeProducts hook ì‚¬ìš©
- **ë³‘ë ¬ ë¡œë”©**: ëª¨ë“  ìƒí’ˆì˜ Variant ë™ì‹œ ë¡œë“œ

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getProducts()
- **Hook**: hooks/useRealtimeProducts.js

---

### 2.5 ìƒí’ˆ ì¡°íšŒ (ê´€ë¦¬ì) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡
2. `/admin/products/catalog` - ìƒí’ˆ ì¹´íƒˆë¡œê·¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getAllProducts(filters)
  â†“ filters
  status='active' (ë˜ëŠ” ì „ì²´)
  â†“ joins
  suppliers, product_variants
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (SELECT) - ëª¨ë“  ìƒí’ˆ
- `suppliers` (JOIN) - ê³µê¸‰ì—…ì²´ ì •ë³´
- `product_variants` (SELECT) - Variant ì •ë³´

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ëª¨ë“  ìƒíƒœ í‘œì‹œ (active, inactive, deleted)
- [ ] ê³µê¸‰ì—…ì²´ ì •ë³´ í‘œì‹œ
- [ ] Variant ì¬ê³  í•©ê³„ í‘œì‹œ
- [ ] ë¼ì´ë¸Œ ìƒíƒœ í‘œì‹œ
- [ ] ê²€ìƒ‰/í•„í„° ê¸°ëŠ¥

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getAllProducts()

---

### 2.6 ìƒí’ˆ ë‹¨ì¼ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ê´€ë¦¬ì ìƒí’ˆ ìƒì„¸
2. ìƒí’ˆ ìƒì„¸ ëª¨ë‹¬ (BuyBottomSheet)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getProductById(productId)
  â†“ selects
  products (ë‹¨ì¼ ì¡°íšŒ)
  â†“ calls
  getProductVariants(productId)
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (SELECT) - ë‹¨ì¼ ìƒí’ˆ
- `product_variants` (SELECT) - ëª¨ë“  Variant

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Variant ì •ë³´ í¬í•¨
- [ ] ì˜µì…˜ ì •ë³´ ì¶”ì¶œ
- [ ] ì´ ì¬ê³  ê³„ì‚°
- [ ] NULL ì²´í¬ (ìƒí’ˆ ì—†ìŒ ì²˜ë¦¬)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getProductById()

---

### 2.7 ìƒí’ˆ ê²€ìƒ‰ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ê²€ìƒ‰ ì¿¼ë¦¬
products
  .select()
  .or(`title.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%`)
  .eq('status', 'active')
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì œëª© ê²€ìƒ‰ (ilike - ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ)
- [ ] ì„¤ëª… ê²€ìƒ‰
- [ ] íŒë§¤ì ê²€ìƒ‰ (seller)
- [ ] ì‹¤ì‹œê°„ ê²€ìƒ‰

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Supabase ê²€ìƒ‰**: ilike ì—°ì‚°ì ì‚¬ìš©
- **OR ì¡°ê±´**: ì—¬ëŸ¬ í•„ë“œ ë™ì‹œ ê²€ìƒ‰

---

### 2.8 ìƒí’ˆ í•„í„°ë§ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// í•„í„° ì˜µì…˜
- ê³µê¸‰ì—…ì²´ë³„ (supplier_id)
- ì¹´í…Œê³ ë¦¬ë³„ (category)
- ìƒíƒœë³„ (status)
- ë¼ì´ë¸Œ ì—¬ë¶€ (is_live, is_live_active)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê³µê¸‰ì—…ì²´ í•„í„°
- [ ] ì¹´í…Œê³ ë¦¬ í•„í„°
- [ ] ìƒíƒœ í•„í„° (active/inactive/deleted)
- [ ] ë¼ì´ë¸Œ ìƒíƒœ í•„í„°
- [ ] ë³µí•© í•„í„° ì§€ì›

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§**: ë©”ëª¨ë¦¬ ë‚´ í•„í„°ë§ ì‚¬ìš©
- **ì„œë²„ í•„í„°ë§**: Supabase ì¿¼ë¦¬ í•„í„° ì¡°í•© ê°€ëŠ¥

---

### 2.9 ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/categories` - ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ í˜ì´ì§€

#### ğŸ—„ï¸ DB ì‘ì—…
- `categories` (SELECT, INSERT, UPDATE, DELETE)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¹´í…Œê³ ë¦¬ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- [ ] ê³„ì¸µ êµ¬ì¡° ì§€ì› (parent_id)
- [ ] slug ìë™ ìƒì„±
- [ ] ìƒí’ˆ ê°œìˆ˜ í‘œì‹œ

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ê³„ì¸µ êµ¬ì¡°**: parent_idë¡œ íŠ¸ë¦¬ êµ¬ì¡° ì§€ì›
- **slug**: URL-friendly ì¹´í…Œê³ ë¦¬ ì‹ë³„ì

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **í˜ì´ì§€**: app/admin/categories/page.js

---

### 2.10 ìƒí’ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡
2. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// Supabase Storage ì—…ë¡œë“œ
supabase.storage
  .from('products')
  .upload(path, file)
  â†“
ì €ì¥ëœ URLì„ products.thumbnail_urlì— ì €ì¥
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Supabase Storage ì‚¬ìš©
- [ ] ì´ë¯¸ì§€ í¬ê¸° ì œí•œ (2MB ê¶Œì¥)
- [ ] íŒŒì¼ í˜•ì‹ ê²€ì¦ (jpg, png, webp)
- [ ] ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
- [ ] ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ (ìˆ˜ì • ì‹œ)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Storage**: products ë²„í‚· ì‚¬ìš©
- **Public URL**: ìë™ ìƒì„±ëœ URL ì €ì¥

---

### 2.11 ìƒí’ˆ ë…¸ì¶œ ì„¤ì • [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
updateProductLiveStatus(productId, isLiveActive)
  â†“ updates
  products.is_live_active = true/false
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - is_live_active

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] is_liveì™€ is_live_active êµ¬ë¶„
- [ ] í† ê¸€ ë²„íŠ¼ UI
- [ ] ì¦‰ì‹œ ë°˜ì˜ (í™ˆ í˜ì´ì§€)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **is_live**: ë¼ì´ë¸Œ ëª©ë¡ ë“±ë¡ ì—¬ë¶€
- **is_live_active**: ì‚¬ìš©ì ë…¸ì¶œ í™œì„±í™” ì—¬ë¶€
- **ì¡°í•©**: is_live=true AND is_live_active=true â†’ í™ˆ í˜ì´ì§€ í‘œì‹œ

---

### 2.12 ìƒí’ˆ ì •ë ¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/` - í™ˆ í˜ì´ì§€
2. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ì •ë ¬ ì˜µì…˜
- ìµœì‹ ìˆœ (created_at DESC) - ê¸°ë³¸
- ê°€ê²© ë‚®ì€ ìˆœ (price ASC)
- ê°€ê²© ë†’ì€ ìˆœ (price DESC)
- ì¬ê³  ë§ì€ ìˆœ (inventory DESC)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] created_at ê¸°ì¤€ ì •ë ¬
- [ ] price ê¸°ì¤€ ì •ë ¬
- [ ] inventory ê¸°ì¤€ ì •ë ¬
- [ ] ì •ë ¬ ë²„íŠ¼ UI

---

### 2.13 ë¼ì´ë¸Œ ìƒíƒœ ë³€ê²½ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/broadcasts` - ë¼ì´ë¸Œ ë°©ì†¡ ê´€ë¦¬
2. `/admin/products` - ê´€ë¦¬ì ìƒí’ˆ ëª©ë¡

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
updateProductLiveStatus(productId, isLive)
  â†“ updates
  products.is_live = true/false
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - is_live

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] is_live í† ê¸€
- [ ] ë¼ì´ë¸Œ ëª©ë¡ ìë™ ì—…ë°ì´íŠ¸
- [ ] ìš°ì„ ìˆœìœ„ ì„¤ì • (live_priority)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ë¼ì´ë¸Œ ë“±ë¡** (2.14)
- **ë¼ì´ë¸Œ í•´ì œ** (2.15)

---

### 2.14 ë¼ì´ë¸Œ ë“±ë¡ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/broadcasts` - ë¼ì´ë¸Œ ë°©ì†¡ ê´€ë¦¬

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
addToLive(productId, priority)
  â†“ updates
  products.is_live = true
  products.live_priority = priority
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - is_live, live_priority

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìš°ì„ ìˆœìœ„ ì„¤ì • (ë‚®ì€ ìˆ«ì = ë†’ì€ ìš°ì„ ìˆœìœ„)
- [ ] ì¤‘ë³µ ë“±ë¡ ë°©ì§€
- [ ] ë¼ì´ë¸Œ ëª©ë¡ ìë™ ê°±ì‹ 

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - addToLive()

---

### 2.15 ë¼ì´ë¸Œ í•´ì œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/broadcasts` - ë¼ì´ë¸Œ ë°©ì†¡ ê´€ë¦¬

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
removeFromLive(productId)
  â†“ updates
  products.is_live = false
  products.is_live_active = false
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - is_live, is_live_active

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] is_live, is_live_active ëª¨ë‘ false
- [ ] í™ˆ í˜ì´ì§€ì—ì„œ ì¦‰ì‹œ ì œê±°
- [ ] live_priority ì´ˆê¸°í™”

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - removeFromLive()

---

### 2.16 ë¼ì´ë¸Œ ìš°ì„ ìˆœìœ„ ë³€ê²½ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/broadcasts` - ë¼ì´ë¸Œ ë°©ì†¡ ê´€ë¦¬

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
updateLivePriority(productId, priority)
  â†“ updates
  products.live_priority = priority
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - live_priority

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìš°ì„ ìˆœìœ„ ìˆ«ì (1, 2, 3, ...)
- [ ] ì •ë ¬ ë°˜ì˜ (ë‚®ì€ ìˆ«ì ìš°ì„ )
- [ ] ë“œë˜ê·¸ ì•¤ ë“œë¡­ UI (ì„ íƒì )

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - updateLivePriority()

---

### 2.17 ìƒí’ˆ ì¬ê³  ê´€ë¦¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ê´€ë¦¬ì ìƒí’ˆ ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
updateProductInventory(productId, quantityChange)
  â†“ updates
  products.inventory (Variant ì—†ëŠ” ê²½ìš°)
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `products` (UPDATE) - inventory

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Variant ìˆìœ¼ë©´ Variant ì¬ê³  ì‚¬ìš©
- [ ] Variant ì—†ìœ¼ë©´ products.inventory ì‚¬ìš©
- [ ] ìŒìˆ˜ ì¬ê³  ë°©ì§€
- [ ] ì¬ê³  ë³€ê²½ ë¡œê·¸

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Variant ì‹œìŠ¤í…œ**: Variantê°€ ìˆìœ¼ë©´ products.inventory ë¬´ì‹œ
- **ë ˆê±°ì‹œ ì§€ì›**: Variant ì—†ëŠ” ìƒí’ˆì€ products.inventory ì‚¬ìš©

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - updateProductInventory()

---

### 2.18 ì˜µì…˜ í¬í•¨ ìƒí’ˆ ìƒì„± â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
createProductWithOptions(productData, optionsData)
  â†“ creates
  addProduct(productData)
  â†“ creates
  product_options, product_option_values
  â†“ generates
  ì˜µì…˜ ì¡°í•© ë°°ì—´ (ìƒ‰ìƒ x ì‚¬ì´ì¦ˆ = Variants)
  â†“ creates
  product_variants (ê° ì¡°í•©ë§ˆë‹¤)
  â†“ maps
  variant_option_values (Variant-ì˜µì…˜ê°’ ë§¤í•‘)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `products` (INSERT)
2. `product_options` (INSERT) - ì—¬ëŸ¬ ì˜µì…˜
3. `product_option_values` (INSERT) - ê° ì˜µì…˜ì˜ ê°’ë“¤
4. `product_variants` (INSERT) - ëª¨ë“  ì˜µì…˜ ì¡°í•©
5. `variant_option_values` (INSERT) - ë§¤í•‘ í…Œì´ë¸”

#### ğŸ“Š ì˜µì…˜ ì¡°í•© ì˜ˆì‹œ
```javascript
// ì˜µì…˜: ìƒ‰ìƒ(ë¸”ë™, í™”ì´íŠ¸), ì‚¬ì´ì¦ˆ(S, M, L)
ì˜µì…˜ ì¡°í•© = [
  { ìƒ‰ìƒ: ë¸”ë™, ì‚¬ì´ì¦ˆ: S },
  { ìƒ‰ìƒ: ë¸”ë™, ì‚¬ì´ì¦ˆ: M },
  { ìƒ‰ìƒ: ë¸”ë™, ì‚¬ì´ì¦ˆ: L },
  { ìƒ‰ìƒ: í™”ì´íŠ¸, ì‚¬ì´ì¦ˆ: S },
  { ìƒ‰ìƒ: í™”ì´íŠ¸, ì‚¬ì´ì¦ˆ: M },
  { ìƒ‰ìƒ: í™”ì´íŠ¸, ì‚¬ì´ì¦ˆ: L },
]
// ì´ 6ê°œ Variant ìƒì„±
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì˜µì…˜ ì¡°í•© ìë™ ìƒì„±
- [ ] ê° Variantì— SKU í• ë‹¹
- [ ] ì´ˆê¸° ì¬ê³  ì„¤ì • (Variantë³„)
- [ ] ê°€ê²© ì„¤ì • (Variantë³„ ë˜ëŠ” ìƒí’ˆ ê¸°ë³¸ê°€)
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì „ì²´ ì„±ê³µ ë˜ëŠ” ì „ì²´ ë¡¤ë°±)
- [ ] ì˜µì…˜ ìˆœì„œ ê´€ë¦¬ (position)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ìƒí’ˆ ë“±ë¡** (addProduct)
- **Variant ìƒì„±** (createVariant)
- **ì˜µì…˜ ê´€ë¦¬** (ì˜µì…˜ ìƒì„±)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - createProductWithOptions()

---

## 3. Variant/ì˜µì…˜ ê´€ë ¨ ê¸°ëŠ¥

### 3.1 Variant ìƒì„± â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ (Variant ê´€ë¦¬)
2. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡ (ì˜µì…˜ ìˆëŠ” ê²½ìš°)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
createVariant(variantData, optionValueIds)
  â†“ inserts
  product_variants (INSERT)
  â†“ maps
  variant_option_values (INSERT - ë§¤í•‘ í…Œì´ë¸”)
  â†“ returns
  ìƒì„±ëœ Variant ê°ì²´
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `product_variants` (INSERT)
   - product_id, sku, inventory, price, is_active, options (JSONB)
2. `variant_option_values` (INSERT)
   - variant_id, option_value_id (ì—¬ëŸ¬ í–‰)

#### ğŸ“Š Variant ë°ì´í„° êµ¬ì¡°
```javascript
{
  id: UUID,
  product_id: UUID,
  sku: 'PROD-BLK-M',
  inventory: 100,
  price: 29000,
  is_active: true,
  options: {
    ìƒ‰ìƒ: 'ë¸”ë™',
    ì‚¬ì´ì¦ˆ: 'M'
  }
}
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] SKU ìë™ ìƒì„± ë˜ëŠ” ìˆ˜ë™ ì…ë ¥ (ì¤‘ë³µ ì²´í¬)
- [ ] ì´ˆê¸° ì¬ê³  ì„¤ì •
- [ ] ê°€ê²© ì„¤ì • (ìƒí’ˆ ê¸°ë³¸ê°€ ë˜ëŠ” ê°œë³„ ê°€ê²©)
- [ ] is_active ê¸°ë³¸ê°’ true
- [ ] options JSONB í˜•ì‹ ì €ì¥
- [ ] optionValueIds ë°°ì—´ë¡œ ë§¤í•‘ í…Œì´ë¸” ì €ì¥
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš©

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì˜µì…˜ í¬í•¨ ìƒí’ˆ ìƒì„±** (createProductWithOptions)
- **Variant ì¬ê³  ê´€ë¦¬** (updateVariantInventory)
- **ì£¼ë¬¸ ìƒì„±** (ì¬ê³  ì°¨ê°)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - createVariant()

---

### 3.2 Variant ì¬ê³  ê´€ë¦¬ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì¬ê³  ì°¨ê°)
2. `/admin/products/[id]` - ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ (ì¬ê³  ìˆ˜ì •)
3. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ê´€ë¦¬ (ì·¨ì†Œ ì‹œ ì¬ê³  ë³µì›)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
updateVariantInventory(variantId, quantityChange)
  â†“ locks
  FOR UPDATE ì ê¸ˆ (ë™ì‹œì„± ì œì–´)
  â†“ selects
  SELECT inventory WHERE id = variantId FOR UPDATE
  â†“ validates
  ì¬ê³  ë¶€ì¡± ì²´í¬ (newInventory < 0)
  â†“ updates
  UPDATE inventory = newInventory
  â†“ commits
  íŠ¸ëœì­ì…˜ ì»¤ë°‹ (ì ê¸ˆ í•´ì œ)
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `BEGIN TRANSACTION`
2. `SELECT inventory FROM product_variants WHERE id = variantId FOR UPDATE`
3. ì¬ê³  ë¶€ì¡± ì²´í¬
4. `UPDATE product_variants SET inventory = newInventory WHERE id = variantId`
5. `COMMIT` (ë˜ëŠ” `ROLLBACK`)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] FOR UPDATE ì ê¸ˆ ì‚¬ìš© (ë°ë“œë½ ë°©ì§€)
- [ ] ì¬ê³  ë¶€ì¡± ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ë° ì‚¬ìš©ì ì•Œë¦¼
- [ ] ìŒìˆ˜ ì¬ê³  ë°©ì§€
- [ ] íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì‹¤íŒ¨ ì‹œ ë¡¤ë°±)
- [ ] ë¡œê·¸ ê¸°ë¡ (ì¬ê³  ë³€ê²½ ì´ë ¥)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ë¬¸ ìƒì„±** (ì¬ê³  ì°¨ê°: quantityChange = -quantity)
- **ì£¼ë¬¸ ì·¨ì†Œ** (ì¬ê³  ë³µì›: quantityChange = +quantity)
- **Variant ìƒì„±** (ì´ˆê¸° ì¬ê³  ì„¤ì •)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **FOR UPDATE ì ê¸ˆ**: ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ê°™ì€ Variant ì£¼ë¬¸ ì‹œ ë°ì´í„° ì •í•©ì„± ë³´ì¥
- **ì¬ê³  ë¶€ì¡± ì‹œ**: ì£¼ë¬¸ ìƒì„± ì°¨ë‹¨, ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
- **ìŒìˆ˜ ì¬ê³  ë°©ì§€**: newInventory < 0 ì²´í¬

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-01: FOR UPDATE ì ê¸ˆ ì¶”ê°€ (ë™ì‹œì„± ì œì–´)
- 2025-09-30: ì¬ê³  ë¶€ì¡± ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **DB**: DB_REFERENCE_GUIDE.md Â§ 5.1
- **ì½”ë“œ**: lib/supabaseApi.js - updateVariantInventory()

---

### 3.3 Variant ì¬ê³  í™•ì¸ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì£¼ë¬¸ ìƒì„± ì „)
2. `/` - í™ˆ í˜ì´ì§€ (ìƒí’ˆ ìƒì„¸ ëª¨ë‹¬ - BuyBottomSheet)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
checkVariantInventory(productId, selectedOptions)
  â†“ finds
  Variant ê²€ìƒ‰ (ì˜µì…˜ ì¡°í•© ì¼ì¹˜)
  â†“ selects
  SELECT inventory FROM product_variants
  â†“ returns
  { available: true/false, inventory: number, variantId: UUID }
```

#### ğŸ—„ï¸ DB ì‘ì—…
1. `product_variants` (SELECT)
2. `variant_option_values` (JOIN)
3. `product_option_values` (JOIN)
4. ì˜µì…˜ ì¡°í•© ì¼ì¹˜ Variant ê²€ìƒ‰

#### ğŸ“Š ë°ì´í„° íë¦„
```
ì‚¬ìš©ì ì˜µì…˜ ì„ íƒ
  â†“
selectedOptions = { ìƒ‰ìƒ: 'ë¸”ë™', ì‚¬ì´ì¦ˆ: 'M' }
  â†“
checkVariantInventory(productId, selectedOptions)
  â†“
Variant ê²€ìƒ‰ (ì˜µì…˜ ì¡°í•© ì¼ì¹˜)
  â†“
ì¬ê³  í™•ì¸
  â†“
ë°˜í™˜: { available: true, inventory: 50, variantId: UUID }
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì˜µì…˜ ì¡°í•© ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” Variant ê²€ìƒ‰
- [ ] ì¬ê³  0 ì´í•˜ë©´ available: false
- [ ] Variant ì—†ìœ¼ë©´ available: false
- [ ] is_active: falseì¸ Variant ì œì™¸

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ë¬¸ ìƒì„±** (ì¬ê³  í™•ì¸ í›„ ì°¨ê°)
- **Variant ì¬ê³  ê´€ë¦¬** (ì¬ê³  ì •ë³´ ì¡°íšŒ)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - checkVariantInventory(), checkOptionInventory()

---

### 3.4 ì˜µì…˜ ì¡°í•© ìƒì„± [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡
2. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ì˜µì…˜ ì¡°í•© ìƒì„±
generateVariantCombinations(options)
  ì˜ˆ: ìƒ‰ìƒ[ë¸”ë™, í™”ì´íŠ¸] x ì‚¬ì´ì¦ˆ[S, M, L]
  â†’ 6ê°œ ì¡°í•© ìƒì„±
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë°ì¹´ë¥´íŠ¸ ê³± ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
- [ ] ìµœëŒ€ ì˜µì…˜ ê°œìˆ˜ ì œí•œ (3ê°œ ê¶Œì¥)
- [ ] ì¡°í•© ìˆ˜ ë¯¸ë¦¬ ê³„ì‚° ë° í‘œì‹œ
- [ ] ê° ì¡°í•©ë§ˆë‹¤ Variant ìƒì„±

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì¡°í•© í­ë°œ**: ì˜µì…˜ê°’ ë§ìœ¼ë©´ ì¡°í•© ìˆ˜ ê¸‰ì¦ ì£¼ì˜
- **ì˜ˆì‹œ**: 3ê°œ ì˜µì…˜ x 5ê°œ ê°’ = 125ê°œ Variant

---

### 3.5 SKU ìë™ ìƒì„± [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// SKU ìƒì„± ê·œì¹™
SKU = ìƒí’ˆì½”ë“œ-ì˜µì…˜1-ì˜µì…˜2...
ì˜ˆ: PROD-BLK-M, PROD-WHT-L
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê³ ìœ ì„± ë³´ì¥
- [ ] ì˜µì…˜ê°’ ì•½ì–´ ì‚¬ìš©
- [ ] ì¤‘ë³µ ì²´í¬
- [ ] ìˆ˜ë™ ì…ë ¥ í—ˆìš©

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ìë™ ìƒì„±**: ê¸°ë³¸ ê·œì¹™ ì ìš©
- **ìˆ˜ë™ ì…ë ¥**: ê´€ë¦¬ìê°€ ì§ì ‘ ì…ë ¥ ê°€ëŠ¥

---

### 3.6 ì˜µì…˜ë³„ ê°€ê²© ì„¤ì • [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡
2. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
- Variantë³„ ê°œë³„ ê°€ê²© ì„¤ì •
- ë˜ëŠ” ìƒí’ˆ ê¸°ë³¸ ê°€ê²© ì‚¬ìš©

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_variants` (UPDATE) - price

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê¸°ë³¸ ê°€ê²© ìƒì† (ì„ íƒì )
- [ ] Variantë³„ ê°œë³„ ê°€ê²© ì…ë ¥
- [ ] ê°€ê²© 0 ë°©ì§€

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ê¸°ë³¸ ê°€ê²©**: products.price ìƒì†
- **ê°œë³„ ê°€ê²©**: variant.price ìš°ì„  ì‚¬ìš©

---

### 3.7 ì˜µì…˜ë³„ ì¬ê³  ì…ë ¥ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡
2. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_variants` (UPDATE) - inventory

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê° Variantë³„ ì¬ê³  ì…ë ¥
- [ ] ì¼ê´„ ì¬ê³  ì„¤ì • ê¸°ëŠ¥
- [ ] ì´ ì¬ê³  ìë™ ê³„ì‚°
- [ ] ìŒìˆ˜ ì¬ê³  ë°©ì§€

---

### 3.8 ì˜µì…˜ ì¶”ê°€ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- createProductOption(optionData)

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_options` (INSERT)
- `product_option_values` (INSERT)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì˜µì…˜ëª… ì¤‘ë³µ ë°©ì§€
- [ ] ì˜µì…˜ê°’ ìµœì†Œ 1ê°œ
- [ ] ê¸°ì¡´ Variant ì²˜ë¦¬ (ì¬ìƒì„± í•„ìš”)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Variant ì¬ìƒì„±**: ì˜µì…˜ ì¶”ê°€ ì‹œ ê¸°ì¡´ Variant ë¬´íš¨í™”

---

### 3.9 ì˜µì…˜ ì‚­ì œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_options` (DELETE)
- `product_option_values` (CASCADE DELETE)
- `variant_option_values` (CASCADE DELETE)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì˜µì…˜ ì‚­ì œ ê²½ê³  (Variant ì˜í–¥)
- [ ] CASCADE ì‚­ì œ í™•ì¸
- [ ] ê´€ë ¨ Variant ë¹„í™œì„±í™”

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **CASCADE**: ì˜µì…˜ ì‚­ì œ ì‹œ ê´€ë ¨ ë°ì´í„° ìë™ ì‚­ì œ

---

### 3.10 ì˜µì…˜ ê°’ ìˆ˜ì • [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ìƒí’ˆ ìˆ˜ì •

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_option_values` (UPDATE)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì˜µì…˜ê°’ ë³€ê²½ ì‹œ Variant ì—…ë°ì´íŠ¸
- [ ] ê¸°ì¡´ ì£¼ë¬¸ ì˜í–¥ ì—†ìŒ í™•ì¸
- [ ] ì˜µì…˜ê°’ ì¤‘ë³µ ë°©ì§€

---

### 3.11 ì˜µì…˜ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/[id]` - ê´€ë¦¬ì ìƒí’ˆ ìƒì„¸
2. `/` - í™ˆ í˜ì´ì§€ (ìƒí’ˆ ìƒì„¸ ëª¨ë‹¬)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- getProductOptions(productId)

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_options` (SELECT)
- `product_option_values` (SELECT)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getProductOptions()

---

### 3.12 ì˜µì…˜ê°’ ìƒì„± [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/products/new` - ì‹ ê·œ ìƒí’ˆ ë“±ë¡

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- createOptionValue(valueData)

#### ğŸ—„ï¸ DB ì‘ì—…
- `product_option_values` (INSERT)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] option_id í•„ìˆ˜
- [ ] value ì¤‘ë³µ ì²´í¬ (ë™ì¼ ì˜µì…˜ ë‚´)
- [ ] position ìë™ ì„¤ì •

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - createOptionValue()

---

## 4. ì‚¬ìš©ì/í”„ë¡œí•„ ê´€ë ¨ ê¸°ëŠ¥

### 4.1 í”„ë¡œí•„ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage` - ë§ˆì´í˜ì´ì§€
2. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€
3. `/admin/customers/[id]` - ê´€ë¦¬ì ê³ ê° ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
UserProfileManager.getCurrentUser()
  â†“ checks
  sessionStorage.getItem('user')
  â†“ or
  supabase.auth.getUser()
  â†“ normalizes
  UserProfileManager.normalizeProfile(user)
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `profiles` (SELECT)
- `auth.users` (SELECT via Supabase Auth)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] sessionStorage ìš°ì„  í™•ì¸ (ì¹´ì¹´ì˜¤ ì‚¬ìš©ì)
- [ ] DB ì¡°íšŒ (ì¼ë°˜ ì‚¬ìš©ì)
- [ ] í”„ë¡œí•„ ì •ê·œí™” (normalizeProfile)
- [ ] NULL ì²˜ë¦¬

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì¹´ì¹´ì˜¤ ì‚¬ìš©ì**: sessionStorage ìš°ì„ 
- **ì¼ë°˜ ì‚¬ìš©ì**: DB ìš°ì„ 
- **ì •ê·œí™”**: ë‘ ë°©ì‹ ëª¨ë‘ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/userProfileManager.js - getCurrentUser()

---

### 4.2 í”„ë¡œí•„ ìˆ˜ì • â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage` - ë§ˆì´í˜ì´ì§€ (í”„ë¡œí•„ ìˆ˜ì •)
2. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì£¼ì†Œ ì„ íƒ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
UserProfileManager.atomicProfileUpdate(userId, profileData, isKakaoUser)
  â†“ updates (ë³‘ë ¬)
  Promise.allSettled([
    profiles UPSERT,
    auth.users.user_metadata UPDATE
  ])
  â†“ updates (ì¹´ì¹´ì˜¤ ì‚¬ìš©ìë§Œ)
  sessionStorage.setItem('user', updatedData)
  â†“ returns
  ì—…ë°ì´íŠ¸ëœ í”„ë¡œí•„
```

#### ğŸ—„ï¸ DB ì‘ì—… ìˆœì„œ
1. `profiles` (UPSERT)
   - name, phone, nickname, address, detail_address, postal_code, addresses (JSONB)
2. `auth.users.user_metadata` (UPDATE - RPC)
   - ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ í‘œì‹œìš©

#### ğŸ“Š ë°ì´í„° íë¦„
```
ë§ˆì´í˜ì´ì§€ í•„ë“œ ìˆ˜ì •
  â†“
atomicProfileUpdate(userId, { name: 'í™ê¸¸ë™' }, isKakaoUser)
  â†“
ë³‘ë ¬ ì—…ë°ì´íŠ¸
  â”œâ”€â”€ profiles UPSERT
  â””â”€â”€ auth.users.user_metadata UPDATE
  â†“
ì¹´ì¹´ì˜¤ ì‚¬ìš©ìì¸ ê²½ìš°
  â””â”€â”€ sessionStorage ì—…ë°ì´íŠ¸
  â†“
UI ìƒíƒœ ì—…ë°ì´íŠ¸
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] profiles í…Œì´ë¸” UPSERT (ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ INSERT)
- [ ] auth.users.user_metadata ë™ê¸°í™” (ê´€ë¦¬ì í˜ì´ì§€ìš©)
- [ ] sessionStorage ì—…ë°ì´íŠ¸ (ì¹´ì¹´ì˜¤ ì‚¬ìš©ìë§Œ)
- [ ] Promise.allSettled ì‚¬ìš© (ë³‘ë ¬ ì²˜ë¦¬, ì¼ë¶€ ì‹¤íŒ¨ í—ˆìš©)
- [ ] ì—ëŸ¬ ì²˜ë¦¬ (profiles ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„, user_metadata ì‹¤íŒ¨ ì‹œ ë¬´ì‹œ)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **í”„ë¡œí•„ ì •ê·œí™”** (normalizeProfile)
- **í”„ë¡œí•„ ìœ íš¨ì„± ê²€ì‚¬** (validateProfile)
- **ì£¼ì†Œ ê´€ë¦¬** (addresses JSONB ì—…ë°ì´íŠ¸)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë³‘ë ¬ ì²˜ë¦¬**: profiles + auth.users ë™ì‹œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
- **ì¹´ì¹´ì˜¤ ì‚¬ìš©ì**: sessionStorage ìš°ì„  ì‚¬ìš© (auth.users ì—†ìŒ)
- **ì¼ë°˜ ì‚¬ìš©ì**: DB ìš°ì„  ì‚¬ìš© (auth.users ìˆìŒ)

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-03: ìš°í¸ë²ˆí˜¸ ì €ì¥ ì¶”ê°€ (postal_code)
- 2025-10-01: atomicProfileUpdate ë³‘ë ¬ ì²˜ë¦¬ ê°œì„ 

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/userProfileManager.js - UserProfileManager.atomicProfileUpdate()
- **í˜ì´ì§€**: app/mypage/page.js

---

### 4.3 í”„ë¡œí•„ ì •ê·œí™” â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. ëª¨ë“  í˜ì´ì§€ (ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
UserProfileManager.normalizeProfile(user)
  â†“ returns
  {
    id, kakao_id, is_kakao,
    name, phone, nickname,
    address, detail_address, postal_code,
    addresses: []  // ìë™ ìƒì„±
  }
```

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì¹´ì¹´ì˜¤/ì¼ë°˜ ì‚¬ìš©ì í†µí•©**: ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
- **addresses ë°°ì—´**: ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ ìë™ ìƒì„±
- **is_kakao í”Œë˜ê·¸**: ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì—¬ë¶€ íŒë³„

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **í”„ë¡œí•„ ì¡°íšŒ** (ëª¨ë“  í˜ì´ì§€)
- **ì£¼ë¬¸ ìƒì„±** (ë°°ì†¡ ì •ë³´)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/userProfileManager.js - UserProfileManager.normalizeProfile()

---

### 4.4 í”„ë¡œí•„ ìœ íš¨ì„± ê²€ì‚¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage` - ë§ˆì´í˜ì´ì§€
2. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
UserProfileManager.validateProfile(profile)
  â†“ checks
  í•„ìˆ˜ í•„ë“œ: name, phone, address
  â†“ returns
  { isValid: boolean, missingFields: [...] }
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í•„ìˆ˜ í•„ë“œ ê²€ì¦ (name, phone, address)
- [ ] ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
- [ ] ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ (ì„ íƒì )
- [ ] ìš°í¸ë²ˆí˜¸ í˜•ì‹ ê²€ì¦

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì„ íƒì  í•„ë“œ**: nickname, detail_address
- **í•„ìˆ˜ í•„ë“œ**: name, phone, address (ì£¼ë¬¸ ì‹œ)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/userProfileManager.js - validateProfile()

---

### 4.5 ì£¼ì†Œ ê´€ë¦¬ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage` - ë§ˆì´í˜ì´ì§€ (ì£¼ì†Œ ê´€ë¦¬)
2. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (ì£¼ì†Œ ì„ íƒ)

#### ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸
- **AddressManager** - ì£¼ì†Œ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸

#### ğŸ“Š ì£¼ì†Œ ë°ì´í„° êµ¬ì¡°
```javascript
addresses: [
  {
    id: Date.now(),
    label: 'ê¸°ë³¸ ë°°ì†¡ì§€',
    address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬...',
    detail_address: '101ë™ 202í˜¸',
    postal_code: '06000',
    is_default: true,
    created_at: '2025-10-03T...'
  }
]
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìµœëŒ€ 5ê°œ ë°°ì†¡ì§€ ì œí•œ
- [ ] ê¸°ë³¸ ë°°ì†¡ì§€ ì„¤ì • (is_default: true)
- [ ] ìš°í¸ë²ˆí˜¸ í•„ìˆ˜ (ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ê³„ì‚°ìš©)
- [ ] ë‹¤ìŒ ì£¼ì†Œ API ì‚¬ìš© (ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰)
- [ ] profiles.addresses JSONB ì—…ë°ì´íŠ¸
- [ ] ë°°ì†¡ë¹„ ìë™ ê³„ì‚° (formatShippingInfo)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **í”„ë¡œí•„ ìˆ˜ì •** (addresses JSONB ì—…ë°ì´íŠ¸)
- **ë°°ì†¡ë¹„ ê³„ì‚°** (postal_code ê¸°ë°˜)
- **ì£¼ë¬¸ ìƒì„±** (ë°°ì†¡ì§€ ì„ íƒ)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ìµœëŒ€ 5ê°œ**: ë°°ì†¡ì§€ ê°œìˆ˜ ì œí•œ
- **is_default**: í•˜ë‚˜ë§Œ true (ë‚˜ë¨¸ì§€ false)
- **postal_code**: ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ê³„ì‚° í•„ìˆ˜

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-04: AddressManager ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§ ì™„ì „ ìˆ˜ì • (postal_code í¬í•¨, ë¹ˆ ë°°ì—´ ì²´í¬, ì¦‰ì‹œ DB ì €ì¥)
- 2025-10-03: ìš°í¸ë²ˆí˜¸ ì‹œìŠ¤í…œ í†µí•© (ë°°ì†¡ë¹„ ìë™ ê³„ì‚°)
- 2025-10-01: AddressManager ì»´í¬ë„ŒíŠ¸ ì‹ ë²„ì „ ì „í™˜

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì»´í¬ë„ŒíŠ¸**: app/components/address/AddressManager.js
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ë§ˆì´í˜ì´ì§€

---

### 4.6 ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage` - ë§ˆì´í˜ì´ì§€ (AddressManager)
2. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€ (AddressManager)

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// Daum ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ ì‚¬ìš©
new daum.Postcode({
  oncomplete: function(data) {
    // data.zonecode (ìš°í¸ë²ˆí˜¸)
    // data.address (ì£¼ì†Œ)
  }
})
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Daum Postcode API ë¡œë“œ
- [ ] íŒì—… ë˜ëŠ” embed ë°©ì‹
- [ ] ìš°í¸ë²ˆí˜¸, ì£¼ì†Œ ìë™ ì…ë ¥
- [ ] ëª¨ë°”ì¼ ëŒ€ì‘

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Daum API**: ë¬´ë£Œ ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰ ì„œë¹„ìŠ¤
- **ë°˜í™˜ê°’**: zonecode (ìš°í¸ë²ˆí˜¸), address (ê¸°ë³¸ ì£¼ì†Œ)

---

### 4.7 ë°°ì†¡ì§€ ì €ì¥ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage` - ë§ˆì´í˜ì´ì§€ (AddressManager)

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
- AddressManager ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- profiles.addresses JSONB ë°°ì—´ ì €ì¥

#### ğŸ—„ï¸ DB ì‘ì—…
- `profiles` (UPDATE) - addresses JSONB

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìµœëŒ€ 5ê°œ ë°°ì†¡ì§€ ì œí•œ
- [ ] ê¸°ë³¸ ë°°ì†¡ì§€ ì„¤ì • (is_default)
- [ ] ìš°í¸ë²ˆí˜¸ í•„ìˆ˜ (ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„)
- [ ] JSONB ë°°ì—´ í˜•ì‹

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ì†Œ ê´€ë¦¬** (4.5)
- **ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰** (4.6)

---

### 4.8 ê³ ê° ëª©ë¡ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/customers` - ê³ ê° ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- getAllCustomers()

#### ğŸ—„ï¸ DB ì‘ì—…
- `profiles` (SELECT)
- `auth.users` (JOIN - optional)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ëª¨ë“  ê³ ê° ì¡°íšŒ
- [ ] ì¹´ì¹´ì˜¤/ì¼ë°˜ ì‚¬ìš©ì êµ¬ë¶„
- [ ] ì£¼ë¬¸ íšŸìˆ˜ í‘œì‹œ (optional)
- [ ] ê²€ìƒ‰/í•„í„° ê¸°ëŠ¥

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getAllCustomers()
- **í˜ì´ì§€**: app/admin/customers/page.js

---

### 4.9 ê³ ê° ê²€ìƒ‰ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/customers` - ê³ ê° ê´€ë¦¬ í˜ì´ì§€
2. `/admin/deposits` - ì…ê¸ˆ ê´€ë¦¬ (ì…ê¸ˆìëª… ê²€ìƒ‰)

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ê²€ìƒ‰ í•„ë“œ
- name (ê³ ê°ëª…)
- phone (ì „í™”ë²ˆí˜¸)
- nickname (ë‹‰ë„¤ì„)
- email (ì´ë©”ì¼)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì—¬ëŸ¬ í•„ë“œ ë™ì‹œ ê²€ìƒ‰
- [ ] ì‹¤ì‹œê°„ ê²€ìƒ‰
- [ ] ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ

---

### 4.10 ê³ ê° ì£¼ë¬¸ ì´ë ¥ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/customers/[id]` - ê³ ê° ìƒì„¸ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getOrders(userId)
  â†“ or (ì¹´ì¹´ì˜¤ ì‚¬ìš©ì)
getUserOrdersByOrderType(orderType)
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `orders` (SELECT) - ê³ ê°ë³„ ì£¼ë¬¸ ì¡°íšŒ
- `order_items`, `order_shipping`, `order_payments` (JOIN)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì „ì²´ ì£¼ë¬¸ ì´ë ¥ í‘œì‹œ
- [ ] ì£¼ë¬¸ ìƒíƒœë³„ í†µê³„
- [ ] ì´ êµ¬ë§¤ ê¸ˆì•¡ ê³„ì‚°
- [ ] ìµœê·¼ ì£¼ë¬¸ ë¨¼ì €

---

## 5. ì¸ì¦ ê´€ë ¨ ê¸°ëŠ¥

### 5.1 ë¡œê·¸ì¸ (ì¼ë°˜) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/login` - ë¡œê·¸ì¸ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
signIn(email, password)
  â†“ calls
  supabase.auth.signInWithPassword({ email, password })
  â†“ creates session
  supabase.auth.session
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `auth.users` (SELECT via Supabase Auth)
- `profiles` (SELECT)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
- [ ] ì„¸ì…˜ ìƒì„±
- [ ] ë¡œê·¸ì¸ ì‹¤íŒ¨ ì²˜ë¦¬
- [ ] ë¦¬ë‹¤ì´ë ‰íŠ¸ (í™ˆ ë˜ëŠ” ì´ì „ í˜ì´ì§€)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **Supabase Auth**: ë‚´ì¥ ì¸ì¦ ì‹œìŠ¤í…œ ì‚¬ìš©
- **ì„¸ì…˜ ê´€ë¦¬**: ìë™ í† í° ê°±ì‹ 

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - signIn()
- **í˜ì´ì§€**: app/login/page.js

---

### 5.2 ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤) â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/login` - ë¡œê·¸ì¸ í˜ì´ì§€ (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼)
2. `/auth/callback` - ì¹´ì¹´ì˜¤ OAuth ì½œë°±

#### ğŸ“Š ë°ì´í„° íë¦„
```
ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
  â†“
ì¹´ì¹´ì˜¤ OAuth ì¸ì¦
  â†“
/auth/callback ë¦¬ë‹¤ì´ë ‰íŠ¸
  â†“
ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  â†“
profiles í…Œì´ë¸” í™•ì¸ (kakao_id)
  â”œâ”€â”€ ì—†ìœ¼ë©´ INSERT
  â””â”€â”€ ìˆìœ¼ë©´ SELECT
  â†“
sessionStorage.setItem('user', {
  kakao_id,
  name,
  nickname,
  phone,
  ...
})
  â†“
í™ˆ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] profiles í…Œì´ë¸”ì— kakao_id ì €ì¥
- [ ] user_idëŠ” NULL (auth.users ì—†ìŒ)
- [ ] sessionStorageì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
- [ ] is_kakao í”Œë˜ê·¸ ì„¤ì •
- [ ] ì£¼ë¬¸ ì¡°íšŒ ì‹œ order_type ì‚¬ìš©

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **í”„ë¡œí•„ ê´€ë¦¬** (sessionStorage ê¸°ë°˜)
- **ì£¼ë¬¸ ì¡°íšŒ** (order_type LIKE '%KAKAO:${kakao_id}%')
- **í”„ë¡œí•„ ìˆ˜ì •** (atomicProfileUpdate)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **user_id NULL**: auth.users í…Œì´ë¸”ì— ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- **sessionStorage**: ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì •ë³´ ì €ì¥ (ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€)
- **order_type**: `direct:KAKAO:${kakao_id}` í˜•ì‹ìœ¼ë¡œ ì €ì¥

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **DB**: DB_REFERENCE_GUIDE.md Â§ 4.2
- **í˜ì´ì§€**: app/login/page.js, app/auth/callback/page.js

---

### 5.3 íšŒì›ê°€ì… [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/signup` - íšŒì›ê°€ì… í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
signUp(email, password, userData)
  â†“ calls
  supabase.auth.signUp({ email, password })
  â†“ creates
  auth.users (ìë™ ìƒì„±)
  â†“ inserts
  profiles (INSERT)
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `auth.users` (INSERT via Supabase Auth)
- `profiles` (INSERT)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
- [ ] ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê²€ì¦
- [ ] ì´ë©”ì¼ ì¸ì¦ ë°œì†¡ (optional)
- [ ] profiles í…Œì´ë¸” ìë™ ìƒì„±
- [ ] ê°€ì… ì™„ë£Œ í›„ ìë™ ë¡œê·¸ì¸

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì´ë©”ì¼ ì¸ì¦**: Supabase ì„¤ì •ì— ë”°ë¼ ì„ íƒì 
- **ìë™ í”„ë¡œí•„ ìƒì„±**: auth.users ìƒì„± ì‹œ triggerë¡œ profiles INSERT

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - signUp()
- **í˜ì´ì§€**: app/signup/page.js

---

### 5.4 ë¡œê·¸ì•„ì›ƒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. ëª¨ë“  í˜ì´ì§€ (í—¤ë” - ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
signOut()
  â†“ calls
  supabase.auth.signOut()
  â†“ clears
  sessionStorage.clear()
  â†“ redirects
  router.push('/')
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Supabase Auth ì„¸ì…˜ ì¢…ë£Œ
- [ ] sessionStorage í´ë¦¬ì–´
- [ ] í™ˆ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] UI ìƒíƒœ ì—…ë°ì´íŠ¸

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì„¸ì…˜ í´ë¦¬ì–´**: ì¹´ì¹´ì˜¤ ì‚¬ìš©ìë„ sessionStorage í´ë¦¬ì–´ í•„ìˆ˜

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - signOut()

---

### 5.5 ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/login` - ë¡œê·¸ì¸ í˜ì´ì§€ (ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ë§í¬)
2. `/reset-password` - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í˜ì´ì§€ (ì˜ˆì •)

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ ë°œì†¡
supabase.auth.resetPasswordForEmail(email)
  â†“
ì´ë©”ì¼ë¡œ ì¬ì„¤ì • ë§í¬ ë°œì†¡
  â†“
/reset-password?token=xxx
  â†“
ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë° ì—…ë°ì´íŠ¸
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì´ë©”ì¼ ë°œì†¡
- [ ] í† í° ê²€ì¦
- [ ] ìƒˆ ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê²€ì¦
- [ ] ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë¯¸êµ¬í˜„**: í˜„ì¬ ê¸°ë³¸ í˜ì´ì§€ë§Œ ì¡´ì¬ (ê¸°ëŠ¥ ì˜ˆì •)
- **Supabase Auth**: ë‚´ì¥ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ê¸°ëŠ¥ ì‚¬ìš©

---

### 5.6 ì„¸ì…˜ ê´€ë¦¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. ëª¨ë“  í˜ì´ì§€ (useAuth hook)

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// useAuth hook
const { user, loading } = useAuth()
  â†“ checks
  supabase.auth.getSession()
  â†“ listens
  supabase.auth.onAuthStateChange()
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì„¸ì…˜ ìë™ í™•ì¸
- [ ] ì„¸ì…˜ ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
- [ ] í† í° ìë™ ê°±ì‹ 
- [ ] ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ìë™ ê°±ì‹ **: Supabase Auth ìë™ í† í° ê°±ì‹ 
- **ìƒíƒœ ë™ê¸°í™”**: ëª¨ë“  íƒ­ ê°„ ì„¸ì…˜ ë™ê¸°í™”

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **Hook**: hooks/useAuth.js

---

## 6. ê³µê¸‰ì—…ì²´/ë°œì£¼ ê´€ë ¨ ê¸°ëŠ¥

### 6.1 ë°œì£¼ì„œ ìƒì„± â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/purchase-orders` - ë°œì£¼ ê´€ë¦¬ í˜ì´ì§€
2. `/admin/purchase-orders/[supplierId]` - ê³µê¸‰ì—…ì²´ë³„ ë°œì£¼ ìƒì„¸

#### ğŸ“Š ë°ì´í„° íë¦„
```
ê´€ë¦¬ì â†’ ë°œì£¼ ê´€ë¦¬ í˜ì´ì§€
  â†“
ê²°ì œì™„ë£Œ ì£¼ë¬¸ ì¡°íšŒ (status='paid')
  â†“
ê³µê¸‰ì—…ì²´ë³„ ê·¸ë£¹í™”
  â†“
ë°œì£¼ì„œ ìƒì„± ë²„íŠ¼ í´ë¦­
  â†“
getPurchaseOrderBySupplier(supplierId, startDate, endDate)
  â†“
ì£¼ë¬¸ í•­ëª© ì§‘ê³„ (ìƒí’ˆë³„)
  â†“
ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ë°œì£¼ì„œ)
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] paid ìƒíƒœ ì£¼ë¬¸ë§Œ í¬í•¨
- [ ] ê³µê¸‰ì—…ì²´ë³„ ê·¸ë£¹í™”
- [ ] ìƒí’ˆë³„ ìˆ˜ëŸ‰ ì§‘ê³„
- [ ] ì¤‘ë³µ ë°œì£¼ ë°©ì§€
- [ ] ë°œì£¼ ì´ë ¥ ê¸°ë¡

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ì£¼ë¬¸ ìƒíƒœ ë³€ê²½** (paid ìƒíƒœ ì „í™˜ ì‹œ)
- **ê³µê¸‰ì—…ì²´ ê´€ë¦¬** (ê³µê¸‰ì—…ì²´ ì •ë³´)
- **ìƒí’ˆ ê´€ë¦¬** (ìƒí’ˆ ì •ë³´)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getPurchaseOrderBySupplier()

---

### 6.2 ë°œì£¼ì„œ ë‹¤ìš´ë¡œë“œ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/purchase-orders` - ë°œì£¼ ê´€ë¦¬ í˜ì´ì§€
2. `/admin/purchase-orders/[supplierId]` - ê³µê¸‰ì—…ì²´ë³„ ë°œì£¼ ìƒì„¸

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
XLSX.utils.book_new()
  â†“ creates
  ì›Œí¬ì‹œíŠ¸ ìƒì„± (ìƒí’ˆë³„ ìˆ˜ëŸ‰ ì§‘ê³„)
  â†“ downloads
  ë°œì£¼ì„œ_{ê³µê¸‰ì—…ì²´ëª…}_{ë‚ ì§œ}.xlsx
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] XLSX.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- [ ] ìƒí’ˆë³„ ìˆ˜ëŸ‰ ì§‘ê³„
- [ ] ê³µê¸‰ì—…ì²´ ì •ë³´ í¬í•¨
- [ ] ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
- [ ] íŒŒì¼ëª… ìë™ ìƒì„±

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ì—‘ì…€ í˜•ì‹**: ê³µê¸‰ì—…ì²´ì—ê²Œ ì „ì†¡ ê°€ëŠ¥í•œ í‘œì¤€ í˜•ì‹
- **í¬í•¨ ì •ë³´**: ìƒí’ˆëª…, ìˆ˜ëŸ‰, ë‹¨ê°€, ì´ì•¡

---

### 6.3 ì—…ì²´ ê´€ë¦¬ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/suppliers` - ê³µê¸‰ì—…ì²´ ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getSuppliers() - ëª©ë¡ ì¡°íšŒ
createSupplier(supplierData) - ìƒì„±
updateSupplier(supplierId, supplierData) - ìˆ˜ì •
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `suppliers` (SELECT, INSERT, UPDATE)

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì—…ì²´ëª…, ì—°ë½ì²˜, ì£¼ì†Œ
- [ ] ë‹´ë‹¹ì ì •ë³´
- [ ] ì—…ì²´ ì½”ë“œ (code) ê³ ìœ ì„±
- [ ] is_active ìƒíƒœ ê´€ë¦¬
- [ ] ë©”ëª¨ ê¸°ëŠ¥

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getSuppliers(), createSupplier(), updateSupplier()
- **í˜ì´ì§€**: app/admin/suppliers/page.js

---

### 6.4 ì—…ì²´ë³„ ì£¼ë¬¸ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/purchase-orders/[supplierId]` - ê³µê¸‰ì—…ì²´ë³„ ë°œì£¼ ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getPurchaseOrderBySupplier(supplierId, startDate, endDate)
  â†“ filters
  orders (status='paid')
  â†“ filters
  products.supplier_id = supplierId
  â†“ aggregates
  ìƒí’ˆë³„ ìˆ˜ëŸ‰ ì§‘ê³„
```

#### ğŸ—„ï¸ DB ì‘ì—…
- `orders` (SELECT) - paid ìƒíƒœ
- `order_items` (SELECT) - JOIN
- `products` (SELECT) - supplier_id í•„í„°

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê²°ì œì™„ë£Œ ì£¼ë¬¸ë§Œ (status='paid')
- [ ] ë‚ ì§œ ë²”ìœ„ í•„í„°
- [ ] ìƒí’ˆë³„ ìˆ˜ëŸ‰ ì§‘ê³„
- [ ] ì´ ë°œì£¼ ê¸ˆì•¡ ê³„ì‚°

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getPurchaseOrderBySupplier()

---

### 6.5 ë°œì£¼ ì´ë ¥ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/purchase-orders` - ë°œì£¼ ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
- getPurchaseOrdersBySupplier(startDate, endDate)

#### ğŸ—„ï¸ DB ì‘ì—…
- `orders` (SELECT) - paid ìƒíƒœ
- ê³µê¸‰ì—…ì²´ë³„ ê·¸ë£¹í™”

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì „ì²´ ë°œì£¼ ì´ë ¥ í‘œì‹œ
- [ ] ê³µê¸‰ì—…ì²´ë³„ ê·¸ë£¹í™”
- [ ] ë‚ ì§œ ë²”ìœ„ í•„í„°
- [ ] ë°œì£¼ ìƒíƒœ (ìƒì„±/ë‹¤ìš´ë¡œë“œ/ì™„ë£Œ)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/supabaseApi.js - getPurchaseOrdersBySupplier()

---

### 6.6 ì¤‘ë³µ ë°œì£¼ ë°©ì§€ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/purchase-orders` - ë°œì£¼ ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
- ë‚ ì§œ ë²”ìœ„ ë‚´ ë°œì£¼ ì—¬ë¶€ í™•ì¸
- ì´ë¯¸ ë°œì£¼ëœ ì£¼ë¬¸ í‘œì‹œ

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë°œì£¼ ì™„ë£Œ í”Œë˜ê·¸ (is_purchased)
- [ ] ë°œì£¼ ë‚ ì§œ ê¸°ë¡ (purchased_at)
- [ ] ì¤‘ë³µ ë°œì£¼ ê²½ê³  UI
- [ ] ê°•ì œ ì¬ë°œì£¼ ì˜µì…˜

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **í˜„ì¬ êµ¬í˜„**: í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§
- **í–¥í›„ ê°œì„ **: DB í”Œë˜ê·¸ ì¶”ê°€ (is_purchased)

---

## 7. ë°°ì†¡ ê´€ë ¨ ê¸°ëŠ¥

### 7.1 ë°°ì†¡ë¹„ ê³„ì‚° â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì²´í¬ì•„ì›ƒ í˜ì´ì§€
2. `/orders/[id]/complete` - ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€
3. `/admin/orders` - ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡
4. `/admin/orders/[id]` - ê´€ë¦¬ì ì£¼ë¬¸ ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
formatShippingInfo(baseShipping, postalCode)
  â†“ calls
  calculateShippingSurcharge(postalCode)
  â†“ returns
  {
    baseShipping: 4000,
    surcharge: 3000,  // ì œì£¼
    totalShipping: 7000,
    isRemote: true,
    region: 'ì œì£¼'
  }
```

#### ğŸ“Š ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ê·œì¹™
```javascript
ì œì£¼: 63000-63644 â†’ +3,000ì›
ìš¸ë¦‰ë„: 40200-40240 â†’ +5,000ì›
ê¸°íƒ€ ë„ì„œì‚°ê°„ â†’ +5,000ì›
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] postal_code í•„ìˆ˜ (profiles, order_shipping)
- [ ] ê¸°ë³¸ ë°°ì†¡ë¹„ 4,000ì›
- [ ] ë„ì„œì‚°ê°„ ì¶”ê°€ë¹„ ìë™ ê³„ì‚°
- [ ] pending ìƒíƒœì—ì„œëŠ” ë°°ì†¡ë¹„ 0ì›
- [ ] DB ì €ì¥ê°’ê³¼ ê³„ì‚°ê°’ ë¹„êµ (ê´€ë¦¬ì í˜ì´ì§€)

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ì¶”ê°€** (calculateShippingSurcharge)
- **ì£¼ì†Œ ê´€ë¦¬** (postal_code ì €ì¥)
- **ì£¼ë¬¸ ìƒì„±** (ë°°ì†¡ë¹„ ê³„ì‚° í›„ ì €ì¥)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ìš°í¸ë²ˆí˜¸ í•„ìˆ˜**: postal_code ì—†ìœ¼ë©´ ê¸°ë³¸ ë°°ì†¡ë¹„ë§Œ ì ìš©
- **pending ìƒíƒœ**: ë°°ì†¡ë¹„ 0ì› (ì•„ì§ ê²°ì œ ì „)
- **DB ì €ì¥ê°’ ìš°ì„ **: order_shippingì— ì €ì¥ëœ ë°°ì†¡ë¹„ ìš°ì„  ì‚¬ìš©

#### ğŸ“ ìµœê·¼ ìˆ˜ì • ì´ë ¥
- 2025-10-03: ìš°í¸ë²ˆí˜¸ ì‹œìŠ¤í…œ ì™„ì „ í†µí•© (ëª¨ë“  í˜ì´ì§€ ì ìš©)
- 2025-10-02: ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ê·œì¹™ ì¶”ê°€

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/shippingUtils.js - formatShippingInfo(), calculateShippingSurcharge()
- **ë°ì´í„° íë¦„**: DETAILED_DATA_FLOW.md Â§ ì²´í¬ì•„ì›ƒ í˜ì´ì§€

---

### 7.2 ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ì¶”ê°€ â­ [ì£¼ìš”]

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
calculateShippingSurcharge(postalCode)
  â†“ validates
  ìš°í¸ë²ˆí˜¸ í˜•ì‹ í™•ì¸
  â†“ checks
  ë„ì„œì‚°ê°„ ì§€ì—­ ë§¤ì¹­
  â†“ returns
  {
    isRemote: true/false,
    region: 'ì œì£¼/ìš¸ë¦‰ë„/ê¸°íƒ€',
    surcharge: 3000/5000
  }
```

#### ğŸ“Š ìš°í¸ë²ˆí˜¸ ë²”ìœ„
```javascript
ì œì£¼: 63000-63644 â†’ surcharge: 3000
ìš¸ë¦‰ë„: 40200-40240 â†’ surcharge: 5000
ê¸°íƒ€ ë„ì„œì‚°ê°„: â†’ surcharge: 5000
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìš°í¸ë²ˆí˜¸ í˜•ì‹ ê²€ì¦ (5ìë¦¬ ìˆ«ì)
- [ ] ë²”ìœ„ ì²´í¬ (ì œì£¼, ìš¸ë¦‰ë„)
- [ ] ê¸°íƒ€ ë„ì„œì‚°ê°„ ì²˜ë¦¬ (í–¥í›„ í™•ì¥ ê°€ëŠ¥)
- [ ] ë°˜í™˜ê°’: { isRemote, region, surcharge }

#### ğŸ”— ì—°ê´€ ê¸°ëŠ¥
- **ë°°ì†¡ë¹„ ê³„ì‚°** (formatShippingInfo)

#### ğŸ“ ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜
- **ì½”ë“œ**: lib/shippingUtils.js - calculateShippingSurcharge()

---

### 7.3 ë°°ì†¡ ìƒíƒœ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders/[id]/complete` - ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€
2. `/admin/shipping` - ë°œì†¡ ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
```javascript
// ì£¼ë¬¸ ìƒíƒœ í™•ì¸
orders.status
  - pending: ê²°ì œëŒ€ê¸°
  - verifying: ê²°ì œí™•ì¸ì¤‘
  - paid: ê²°ì œì™„ë£Œ
  - delivered: ë°œì†¡ì™„ë£Œ
  - cancelled: ì·¨ì†Œë¨
```

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í˜„ì¬ ë°°ì†¡ ìƒíƒœ í‘œì‹œ
- [ ] ìƒíƒœë³„ íƒ€ì„ìŠ¤íƒ¬í”„ í‘œì‹œ
- [ ] ì†¡ì¥ë²ˆí˜¸ í‘œì‹œ (ìˆëŠ” ê²½ìš°)
- [ ] ë°°ì†¡ ë‹¨ê³„ UI (ì§„í–‰ ë°”)

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **íƒ€ì„ìŠ¤íƒ¬í”„**: created_at, verifying_at, paid_at, delivered_at
- **ìƒíƒœ ì „í™˜**: ìˆœì°¨ì  ì „í™˜ (pending â†’ verifying â†’ paid â†’ delivered)

---

### 7.4 ë°°ì†¡ ì¶”ì  [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/orders/[id]/complete` - ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€
2. `/admin/shipping` - ë°œì†¡ ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
- ì†¡ì¥ë²ˆí˜¸ ê¸°ë°˜ ë°°ì†¡ ì¶”ì 
- íƒë°°ì‚¬ API ì—°ë™ (ì˜ˆì •)

#### ğŸ—„ï¸ DB ì‘ì—…
- `order_shipping` (SELECT) - tracking_number

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì†¡ì¥ë²ˆí˜¸ ì €ì¥ (tracking_number)
- [ ] íƒë°°ì‚¬ ì½”ë“œ (carrier)
- [ ] ì™¸ë¶€ API ì—°ë™ (optional)
- [ ] ë°°ì†¡ ì¶”ì  ë§í¬ ìƒì„±

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë¯¸êµ¬í˜„**: í˜„ì¬ ì†¡ì¥ë²ˆí˜¸ë§Œ ì €ì¥
- **í–¥í›„ ê¸°ëŠ¥**: íƒë°°ì‚¬ API ì—°ë™ (ì‹¤ì‹œê°„ ë°°ì†¡ ì¡°íšŒ)
- **ë§í¬ ìƒì„±**: íƒë°°ì‚¬ë³„ ì¶”ì  URL ìë™ ìƒì„±

---

### 7.5 ë°°ì†¡ ì•Œë¦¼ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… (ì˜ˆì •)

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥
- ë°°ì†¡ ìƒíƒœ ë³€ê²½ ì‹œ ìë™ ì•Œë¦¼
- ì´ë©”ì¼/SMS ë°œì†¡

#### âš ï¸ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë°œì†¡ ì™„ë£Œ ì•Œë¦¼ (delivered ìƒíƒœ)
- [ ] ì´ë©”ì¼ í…œí”Œë¦¿
- [ ] SMS ë°œì†¡ (optional)
- [ ] ì•Œë¦¼ ë°œì†¡ ì´ë ¥ ê¸°ë¡

#### ğŸ’¡ íŠ¹ì´ì‚¬í•­
- **ë¯¸êµ¬í˜„**: í˜„ì¬ ìˆ˜ë™ ì•Œë¦¼ë§Œ ê°€ëŠ¥
- **í–¥í›„ ê¸°ëŠ¥**:
  - ìë™ ì´ë©”ì¼ ë°œì†¡
  - SMS ì•Œë¦¼ (ì„ íƒì )
  - ë°°ì†¡ ì „ ì•Œë¦¼
  - ë°°ì†¡ ì™„ë£Œ ì•Œë¦¼

---

## ğŸ“‹ ê¸°ëŠ¥ ë¬¸ì„œí™” ì™„ë£Œ í†µê³„

### âœ… ìƒì„¸ ë¬¸ì„œí™” ì™„ë£Œ (77ê°œ ì „ì²´)

#### ì£¼ìš” ê¸°ëŠ¥ (20ê°œ)
1. ì£¼ë¬¸ ìƒì„±
2. ì£¼ë¬¸ ì¡°íšŒ (ì‚¬ìš©ì)
3. ì£¼ë¬¸ ì¡°íšŒ (ê´€ë¦¬ì)
4. ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ
5. ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
6. ì¼ê´„ ìƒíƒœ ë³€ê²½
7. ì£¼ë¬¸ ì·¨ì†Œ
8. ì¼ê´„ê²°ì œ ì²˜ë¦¬
9. ìƒí’ˆ ë“±ë¡
10. ìƒí’ˆ ìˆ˜ì •
11. ì˜µì…˜ í¬í•¨ ìƒí’ˆ ìƒì„±
12. Variant ìƒì„±
13. Variant ì¬ê³  ê´€ë¦¬
14. Variant ì¬ê³  í™•ì¸
15. í”„ë¡œí•„ ìˆ˜ì •
16. í”„ë¡œí•„ ì •ê·œí™”
17. ì£¼ì†Œ ê´€ë¦¬
18. ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤)
19. ë°œì£¼ì„œ ìƒì„±
20. ë°°ì†¡ë¹„ ê³„ì‚°
21. ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ì¶”ê°€

#### ì¼ë°˜ ê¸°ëŠ¥ (57ê°œ)
- ì£¼ë¬¸ ê´€ë ¨: 11ê°œ (1.8~1.18)
- ìƒí’ˆ ê´€ë ¨: 15ê°œ (2.3~2.17)
- Variant/ì˜µì…˜ ê´€ë ¨: 9ê°œ (3.4~3.12)
- ì‚¬ìš©ì/í”„ë¡œí•„ ê´€ë ¨: 6ê°œ (4.1, 4.4, 4.6~4.10)
- ì¸ì¦ ê´€ë ¨: 5ê°œ (5.1, 5.3~5.6)
- ê³µê¸‰ì—…ì²´/ë°œì£¼ ê´€ë ¨: 5ê°œ (6.2~6.6)
- ë°°ì†¡ ê´€ë ¨: 3ê°œ (7.3~7.5)

### ğŸ“Š ë¬¸ì„œí™” ìˆ˜ì¤€

**ì™„ì „ ë¬¸ì„œí™” (77ê°œ ì „ì²´)**:
- ì˜í–¥ë°›ëŠ” í˜ì´ì§€ ëª…ì‹œ
- í•µì‹¬ í•¨ìˆ˜ ì²´ì¸ ì„¤ëª…
- DB ì‘ì—… ìˆœì„œ ëª…ì‹œ
- í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì œê³µ
- ì—°ê´€ ê¸°ëŠ¥ ë§í¬
- íŠ¹ì´ì‚¬í•­ ë° ì£¼ì˜ì 
- ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜

---

## ğŸ“‹ ì£¼ìš” ê¸°ëŠ¥ ëª©ë¡ (ìƒì„¸ ë¬¸ì„œí™” ì™„ë£Œ - 21ê°œ)

### ì£¼ë¬¸ ê´€ë ¨ (7ê°œ)
1. âœ… ì£¼ë¬¸ ìƒì„± - createOrder()
2. âœ… ì£¼ë¬¸ ì¡°íšŒ (ì‚¬ìš©ì) - getOrders()
3. âœ… ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ - updateOrderStatus()
4. âœ… ì¼ê´„ ìƒíƒœ ë³€ê²½ - updateMultipleOrderStatus()
5. âœ… ì£¼ë¬¸ ì·¨ì†Œ - cancelOrder()
6. âœ… ì¼ê´„ê²°ì œ ì²˜ë¦¬ - payment_group_id

### ìƒí’ˆ ê´€ë ¨ (3ê°œ)
7. âœ… ìƒí’ˆ ë“±ë¡ - addProduct()
8. âœ… ìƒí’ˆ ìˆ˜ì • - updateProduct()
9. âœ… ì˜µì…˜ í¬í•¨ ìƒí’ˆ ìƒì„± - createProductWithOptions()

### Variant/ì˜µì…˜ ê´€ë ¨ (3ê°œ)
10. âœ… Variant ìƒì„± - createVariant()
11. âœ… Variant ì¬ê³  ê´€ë¦¬ - updateVariantInventory()
12. âœ… Variant ì¬ê³  í™•ì¸ - checkVariantInventory()

### ì‚¬ìš©ì/í”„ë¡œí•„ ê´€ë ¨ (3ê°œ)
13. âœ… í”„ë¡œí•„ ìˆ˜ì • - atomicProfileUpdate()
14. âœ… í”„ë¡œí•„ ì •ê·œí™” - normalizeProfile()
15. âœ… ì£¼ì†Œ ê´€ë¦¬ - AddressManager

### ì¸ì¦ ê´€ë ¨ (1ê°œ)
16. âœ… ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤) - ì¹´ì¹´ì˜¤ OAuth

### ê³µê¸‰ì—…ì²´/ë°œì£¼ ê´€ë ¨ (1ê°œ)
17. âœ… ë°œì£¼ì„œ ìƒì„± - getPurchaseOrderBySupplier()

### ë°°ì†¡ ê´€ë ¨ (2ê°œ)
18. âœ… ë°°ì†¡ë¹„ ê³„ì‚° - formatShippingInfo()
19. âœ… ë„ì„œì‚°ê°„ ë°°ì†¡ë¹„ ì¶”ê°€ - calculateShippingSurcharge()

---

## ğŸ“ ë¬¸ì„œí™” ì™„ë£Œ í˜„í™©

1. âœ… ëª¨ë“  ê¸°ëŠ¥ ê¸°ë³¸ êµ¬ì¡° ìƒì„± (ì™„ë£Œ)
2. âœ… ì£¼ìš” ê¸°ëŠ¥ 21ê°œ ìƒì„¸ ë¬¸ì„œí™” (ì™„ë£Œ)
3. âœ… ì¼ë°˜ ê¸°ëŠ¥ 57ê°œ ìƒì„¸ ë¬¸ì„œí™” (ì™„ë£Œ)
4. âœ… ì´ 77ê°œ ì „ì²´ ê¸°ëŠ¥ ë¬¸ì„œí™” (ì™„ë£Œ - 2025-10-03)

### ğŸ“ˆ ë¬¸ì„œí™” í†µê³„
- **ì´ ê¸°ëŠ¥ ê°œìˆ˜**: 77ê°œ
- **ìƒì„¸ ë¬¸ì„œí™” ì™„ë£Œ**: 77ê°œ (100%)
- **ë¶„ì„í•œ í˜ì´ì§€**: 31ê°œ
- **ë¶„ì„í•œ í•¨ìˆ˜**: 47ê°œ (lib/supabaseApi.js)
- **ì°¸ì¡°í•œ ë¬¸ì„œ**: CODE_ANALYSIS_COMPLETE.md, DB_REFERENCE_GUIDE.md, DETAILED_DATA_FLOW.md

### ğŸ¯ ë¬¸ì„œí™” í’ˆì§ˆ
**ëª¨ë“  ê¸°ëŠ¥ í¬í•¨ í•­ëª©**:
- âœ… ì˜í–¥ë°›ëŠ” í˜ì´ì§€ (1~5ê°œ)
- âœ… í•µì‹¬ í•¨ìˆ˜ ì²´ì¸ (ì½”ë“œ ì˜ˆì‹œ)
- âœ… DB ì‘ì—… ìˆœì„œ (í…Œì´ë¸” + ì‘ì—… ìœ í˜•)
- âœ… í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ (3~10ê°œ í•­ëª©)
- âœ… ì—°ê´€ ê¸°ëŠ¥ ë§í¬
- âœ… íŠ¹ì´ì‚¬í•­ ë° ì£¼ì˜ì 
- âœ… ìƒì„¸ ë¬¸ì„œ ìœ„ì¹˜

---

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì£¼ë¬¸ ìƒì„± ê¸°ëŠ¥ ìˆ˜ì • ì‹œ
```
1. FEATURE_REFERENCE_MAP.md Â§ 1.1 ì£¼ë¬¸ ìƒì„± ì½ê¸°
2. ì˜í–¥ë°›ëŠ” í˜ì´ì§€ 5ê°œ í™•ì¸
3. í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ 15ê°œ í•­ëª© í™•ì¸
4. ì—°ê´€ ê¸°ëŠ¥ 6ê°œ í…ŒìŠ¤íŠ¸ í•„ìš”
5. DB_REFERENCE_GUIDE.md Â§ 6.1 ì°¸ì¡°
6. DETAILED_DATA_FLOW.md Â§ ì²´í¬ì•„ì›ƒ í˜ì´ì§€ ì°¸ì¡°
```

### ì˜ˆì‹œ 2: Variant ì¬ê³  ê´€ë¦¬ ê¸°ëŠ¥ ìˆ˜ì • ì‹œ
```
1. FEATURE_REFERENCE_MAP.md Â§ 3.2 Variant ì¬ê³  ê´€ë¦¬ ì½ê¸°
2. ì˜í–¥ë°›ëŠ” í˜ì´ì§€ 3ê°œ í™•ì¸
3. FOR UPDATE ì ê¸ˆ ì‚¬ìš© í™•ì¸
4. ì—°ê´€ ê¸°ëŠ¥: ì£¼ë¬¸ ìƒì„±, ì£¼ë¬¸ ì·¨ì†Œ í…ŒìŠ¤íŠ¸
5. DB_REFERENCE_GUIDE.md Â§ 5.1 ì°¸ì¡°
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-10-03
**ìƒíƒœ**: ì™„ì „ ë¬¸ì„œí™” ì™„ë£Œ (ì „ì²´ 77ê°œ ê¸°ëŠ¥ ìƒì„¸ ë¬¸ì„œí™”)
**ì´ ê¸°ëŠ¥**: 77ê°œ (ì£¼ìš”: 21ê°œ, ì¼ë°˜: 56ê°œ)
## 8. ì¿ í° ê´€ë ¨ ê¸°ëŠ¥

### 8.1 ì¿ í° ë°œí–‰ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons` - ì¿ í° ëª©ë¡ (ìƒˆ ì¿ í° í‘œì‹œ)
2. `/admin/coupons/new` - ì¿ í° ë°œí–‰ í˜ì´ì§€
3. `/admin/coupons/[id]` - ì¿ í° ìƒì„¸/ë°°í¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
createCoupon(couponData)
  â†“ validates
  - ì¿ í° ì½”ë“œ ì¤‘ë³µ í™•ì¸
  - í• ì¸ íƒ€ì…ë³„ í•„ìˆ˜ í•„ë“œ ê²€ì¦ (max_discount_amount)
  - ë‚ ì§œ ë²”ìœ„ ê²€ì¦ (valid_until > valid_from)
  â†“ creates
  coupons (INSERT)
  â†“ returns
  ìƒˆë¡œ ìƒì„±ëœ ì¿ í° ê°ì²´
```

#### ğŸ—„ï¸ ê´€ë ¨ í…Œì´ë¸”
- `coupons` (main)

#### âš ï¸ ì£¼ìš” í•„ë“œ
- `code`: VARCHAR(50) UNIQUE - ì¿ í° ì½”ë“œ (ìë™ ëŒ€ë¬¸ì)
- `discount_type`: 'fixed_amount' | 'percentage'
- `discount_value`: í• ì¸ ê¸ˆì•¡ ë˜ëŠ” ë¹„ìœ¨
- `min_purchase_amount`: ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ (ê¸°ë³¸ 0)
- `max_discount_amount`: ìµœëŒ€ í• ì¸ ê¸ˆì•¡ (percentage íƒ€ì… í•„ìˆ˜)
- `valid_from`, `valid_until`: ìœ íš¨ ê¸°ê°„
- `usage_limit_per_user`: ì‚¬ìš©ìë‹¹ ì‚¬ìš© íšŸìˆ˜ (ê¸°ë³¸ 1)
- `total_usage_limit`: ì „ì²´ ì‚¬ìš© í•œë„ (ì„ ì°©ìˆœ, NULL=ë¬´ì œí•œ)

#### âœ… í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¿ í° ì½”ë“œ ì˜ë¬¸+ìˆ«ìë§Œ ì‚¬ìš©
- [ ] percentage íƒ€ì…ì€ max_discount_amount í•„ìˆ˜
- [ ] valid_until > valid_from ê²€ì¦
- [ ] discount_value > 0 ê²€ì¦

---

### 8.2 ì¿ í° ë°°í¬ (ê°œë³„) â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons/[id]` - ì¿ í° ë°°í¬ í˜ì´ì§€
2. `/mypage/coupons` - ì‚¬ìš©ì ì¿ í°í•¨ (ìƒˆ ì¿ í° í‘œì‹œ)

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
// í”„ë¡ íŠ¸ì—”ë“œ (lib/couponApi.js)
distributeCoupon(couponId, userIds)
  â†“ calls API Route
  POST /api/admin/coupons/distribute
  â†“ validates (ì„œë²„ ì‚¬ì´ë“œ)
  - ê´€ë¦¬ì ì´ë©”ì¼ ê²€ì¦ (verifyAdminAuth)
  - ì¿ í° í™œì„±í™” ìƒíƒœ í™•ì¸
  - ì‚¬ìš©ì ID ë°°ì—´ ìœ íš¨ì„± ê²€ì¦
  â†“ distributes (Service Role Key ì‚¬ìš©)
  user_coupons (INSERT with upsert, RLS ìš°íšŒ)
  â†“ triggers
  coupons.total_issued_count ìë™ ì¦ê°€ (DB trigger)
  â†“ returns
  { success, distributedCount, requestedCount, duplicates, couponCode }
```

#### ğŸ—„ï¸ ê´€ë ¨ íŒŒì¼
- **í”„ë¡ íŠ¸ì—”ë“œ**: `lib/couponApi.js` - distributeCoupon()
- **API Route**: `app/api/admin/coupons/distribute/route.js`
- **Admin Client**: `lib/supabaseAdmin.js` - Service Role í´ë¼ì´ì–¸íŠ¸
- **RLS ì •ì±…**: `supabase_user_coupons_rls.sql`

#### ğŸ—„ï¸ ê´€ë ¨ í…Œì´ë¸”
- `user_coupons` (main)
- `coupons` (í†µê³„ ì—…ë°ì´íŠ¸)

#### âš ï¸ ì£¼ìš” íŠ¹ì§•
- **ë³´ì•ˆ**: Service Role Key ì‚¬ìš© + ê´€ë¦¬ì ì´ë©”ì¼ ê²€ì¦
- **RLS ìš°íšŒ**: supabaseAdmin í´ë¼ì´ì–¸íŠ¸ë¡œ RLS ì •ì±… ìš°íšŒ
- ì¤‘ë³µ ë°°í¬ ë°©ì§€: UNIQUE(user_id, coupon_id)
- upsert ì‚¬ìš©ìœ¼ë¡œ ì¤‘ë³µ ì‹œ ì¡°ìš©íˆ ë¬´ì‹œ
- ë°°í¬ì ì •ë³´ ì €ì¥ (issued_by)

#### ğŸ”’ ë³´ì•ˆ êµ¬ì¡° (2025-10-03 ì—…ë°ì´íŠ¸)
```
ê´€ë¦¬ì UI
  â†“ localStorage (admin_email)
  â†“
API Route (ì„œë²„ ì‚¬ì´ë“œ)
  â†“ verifyAdminAuth(adminEmail)
  â†“ process.env.ADMIN_EMAILS í™•ì¸
  â†“
supabaseAdmin (Service Role)
  â†“ SUPABASE_SERVICE_ROLE_KEY
  â†“ RLS ì •ì±… ìš°íšŒ
  â†“
user_coupons í…Œì´ë¸” INSERT
```

#### âœ… í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] í™œì„±í™”ëœ ì¿ í°ë§Œ ë°°í¬ ê°€ëŠ¥
- [x] ì´ë¯¸ ë³´ìœ í•œ ì‚¬ìš©ìëŠ” ì¤‘ë³µ ì œì™¸
- [x] ë°°í¬ ê²°ê³¼ í”¼ë“œë°± (ì„±ê³µ Xê±´, ì¤‘ë³µ Yê±´)
- [x] ê´€ë¦¬ì ê¶Œí•œ ê²€ì¦ (ADMIN_EMAILS)
- [x] Service Role Keyë¡œ ì•ˆì „í•œ ë°°í¬

---

### 8.3 ì¿ í° ë°°í¬ (ì „ì²´) â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons/[id]` - ì „ì²´ ê³ ê°ì—ê²Œ ë°°í¬
2. `/mypage/coupons` - ëª¨ë“  ì‚¬ìš©ì ì¿ í°í•¨

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
distributeToAllCustomers(couponId)
  â†“ fetches
  ëª¨ë“  ê³ ê° ëª©ë¡ (is_admin = false)
  â†“ calls
  distributeCoupon(couponId, allUserIds)
  â†“ returns
  ì „ì²´ ë°°í¬ ê²°ê³¼
```

#### âš ï¸ ì£¼ìš” íŠ¹ì§•
- ì¼ë°˜ ê³ ê°ë§Œ ëŒ€ìƒ (ê´€ë¦¬ì ì œì™¸)
- ëŒ€ëŸ‰ ë°°í¬ ìµœì í™” (upsert ì‚¬ìš©)
- ê¸°ì¡´ ë³´ìœ ì ìë™ ì œì™¸

#### âœ… í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í™•ì¸ ëª¨ë‹¬ë¡œ ì‹¤ìˆ˜ ë°©ì§€
- [ ] ë°°í¬ ì§„í–‰ ìƒí™© í‘œì‹œ
- [ ] ì™„ë£Œ í›„ í†µê³„ ê°±ì‹ 

---

### 8.4 ì¿ í° ìœ íš¨ì„± ê²€ì¦ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì¿ í° ì ìš© ì‹œ ê²€ì¦

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
validateCoupon(couponCode, userId, orderAmount)
  â†“ calls DB function
  validate_coupon(p_coupon_code, p_user_id, p_order_amount)
  â†“ validates
  1. ì¿ í° ì¡´ì¬ ë° í™œì„±í™” ì—¬ë¶€
  2. ìœ íš¨ ê¸°ê°„ (NOW() BETWEEN valid_from AND valid_until)
  3. ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡
  4. ì „ì²´ ì‚¬ìš© í•œë„
  5. ì‚¬ìš©ì ë³´ìœ  ì—¬ë¶€
  6. ì‚¬ìš© ì´ë ¥ (is_used = false)
  â†“ calculates
  í• ì¸ ê¸ˆì•¡ (fixed_amount ë˜ëŠ” percentage)
  â†“ returns
  { is_valid, error_message, coupon_id, discount_amount }
```

#### ğŸ—„ï¸ ê´€ë ¨ í•¨ìˆ˜ (DB)
- `validate_coupon()` - PostgreSQL í•¨ìˆ˜

#### âš ï¸ ê²€ì¦ ìˆœì„œ (ì¤‘ìš”!)
1. ì¿ í° ì¡´ì¬/í™œì„±í™” â†’ "ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ë¹„í™œì„±í™”ëœ ì¿ í°"
2. ìœ íš¨ ê¸°ê°„ (ì‹œì‘ ì „) â†’ "ì•„ì§ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì¿ í°"
3. ìœ íš¨ ê¸°ê°„ (ë§Œë£Œ) â†’ "ìœ íš¨ ê¸°ê°„ì´ ë§Œë£Œëœ ì¿ í°"
4. ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ â†’ "ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ Xì› ì´ìƒ"
5. ì „ì²´ ì‚¬ìš© í•œë„ â†’ "ì¿ í° ì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜ ì´ˆê³¼"
6. ì‚¬ìš©ì ë³´ìœ  â†’ "ë³´ìœ í•˜ì§€ ì•Šì€ ì¿ í°"
7. ì‚¬ìš© ì´ë ¥ â†’ "ì´ë¯¸ ì‚¬ìš©í•œ ì¿ í°"

#### í• ì¸ ê¸ˆì•¡ ê³„ì‚° ë¡œì§
```sql
-- fixed_amount
v_discount := LEAST(v_coupon.discount_value, p_order_amount)

-- percentage
v_discount := p_order_amount * (v_coupon.discount_value / 100)
IF v_coupon.max_discount_amount IS NOT NULL THEN
    v_discount := LEAST(v_discount, v_coupon.max_discount_amount)
END IF
```

#### âœ… í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ëª¨ë“  ê²€ì¦ ë‹¨ê³„ í†µê³¼ í™•ì¸
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ í‘œì‹œ
- [ ] í• ì¸ ê¸ˆì•¡ ê³„ì‚° ì •í™•ì„± í™•ì¸

---

### 8.5 ì¿ í° ì‚¬ìš© ì²˜ë¦¬ â­ [ì£¼ìš”]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/checkout` - ì£¼ë¬¸ ì™„ë£Œ í›„ ì¿ í° ì‚¬ìš© ì²˜ë¦¬
2. `/orders/[id]/complete` - ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€
3. `/admin/coupons/[id]` - ì‚¬ìš© í†µê³„ ì—…ë°ì´íŠ¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜ ì²´ì¸
```javascript
applyCouponUsage(userId, couponId, orderId, discountAmount)
  â†“ calls DB function
  use_coupon(p_user_id, p_coupon_id, p_order_id, p_discount_amount)
  â†“ updates
  user_coupons.is_used = true
  user_coupons.used_at = NOW()
  user_coupons.order_id = orderId
  user_coupons.discount_amount = discountAmount
  â†“ triggers
  coupons.total_used_count ìë™ ì¦ê°€ (DB trigger)
  â†“ returns
  boolean (ì„±ê³µ ì—¬ë¶€)
```

#### ğŸ—„ï¸ ê´€ë ¨ íŠ¸ë¦¬ê±°
- `trigger_update_coupon_usage_stats` - ì‚¬ìš© í†µê³„ ìë™ ì—…ë°ì´íŠ¸

#### âš ï¸ ì£¼ì˜ì‚¬í•­
- WHERE ì¡°ê±´: `is_used = false` (ì¤‘ë³µ ì‚¬ìš© ë°©ì§€)
- íŠ¸ëœì­ì…˜ ì•ˆì „ì„±: ì£¼ë¬¸ ìƒì„±ê³¼ í•¨ê»˜ ì²˜ë¦¬
- ì‹¤íŒ¨ ì‹œì—ë„ ì£¼ë¬¸ì€ ì§„í–‰ (ì¿ í°ì€ ì¬ë°œí–‰ ê°€ëŠ¥)

#### âœ… í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì£¼ë¬¸ ìƒì„± í›„ ì¦‰ì‹œ í˜¸ì¶œ
- [ ] ì¿ í° ì‚¬ìš© ì‹¤íŒ¨í•´ë„ ì£¼ë¬¸ ì·¨ì†Œ ì•ˆ ë¨
- [ ] ì‚¬ìš© ë‚´ì—­ ë¡œê·¸ ê¸°ë¡ (logger)

---

### 8.6 ì¿ í° ëª©ë¡ ì¡°íšŒ (ê´€ë¦¬ì) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons` - ì¿ í° ê´€ë¦¬ í˜ì´ì§€

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getCoupons()
  â†“ fetches
  ëª¨ë“  ì¿ í° + í†µê³„ (join user_coupons)
  â†“ returns
  ì¿ í° ë°°ì—´ (total_issued_count, total_used_count í¬í•¨)
```

#### ğŸ¨ UI ê¸°ëŠ¥
- ê²€ìƒ‰: ì½”ë“œ, ì´ë¦„
- í•„í„°: ìƒíƒœ (ì „ì²´/í™œì„±/ë¹„í™œì„±), íƒ€ì… (ì „ì²´/ê¸ˆì•¡/í¼ì„¼íŠ¸)
- ì •ë ¬: ìƒì„±ì¼ ë‚´ë¦¼ì°¨ìˆœ
- í†µê³„ ì¹´ë“œ: ì „ì²´/í™œì„±/ë°œê¸‰/ì‚¬ìš©

---

### 8.7 ì¿ í° ëª©ë¡ ì¡°íšŒ (ì‚¬ìš©ì) [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/mypage/coupons` - ë‚´ ì¿ í°í•¨
2. `/checkout` - ì¿ í° ì„ íƒ

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getUserCoupons(userId)
  â†“ fetches
  user_coupons + coupons (join)
  WHERE user_id = userId
  â†“ returns
  ì‚¬ìš©ì ì¿ í° ë°°ì—´ (ì¿ í° ì •ë³´ í¬í•¨)
```

#### ğŸ¨ UI ê¸°ëŠ¥
- íƒ­: ì‚¬ìš© ê°€ëŠ¥ / ì‚¬ìš© ì™„ë£Œ / ê¸°ê°„ ë§Œë£Œ
- ì¿ í° ë””ìì¸: í‹°ì¼“ ìŠ¤íƒ€ì¼ (ì¢Œì¸¡ í• ì¸ ê¸ˆì•¡, ìš°ì¸¡ ì •ë³´)
- ì •ë ¬: ë§Œë£Œì¼ ê°€ê¹Œìš´ ìˆœ

---

### 8.8 ì¿ í° ìƒì„¸ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons/[id]` - ì¿ í° ìƒì„¸ ë° ë°°í¬

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getCouponDetail(couponId)
  â†“ fetches
  ì¿ í° ê¸°ë³¸ ì •ë³´
  â†“ parallel fetches
  - ë³´ìœ  ê³ ê° ëª©ë¡ (ë¯¸ì‚¬ìš©)
  - ì‚¬ìš© ì™„ë£Œ ê³ ê° ëª©ë¡
  - í†µê³„ (usage_rate ë“±)
  â†“ returns
  ì¿ í° ìƒì„¸ + ê³ ê° ë¦¬ìŠ¤íŠ¸
```

#### ğŸ¨ UI ê¸°ëŠ¥
- í†µê³„: ì´ ë°œê¸‰ / ì‚¬ìš© ì™„ë£Œ / ì‚¬ìš©ë¥  / ë‚¨ì€ ìˆ˜ëŸ‰
- ê³ ê° íƒ­: ë¯¸ì‚¬ìš© / ì‚¬ìš©ì™„ë£Œ
- ë°°í¬: ê°œë³„ ì„ íƒ / ì „ì²´ ë°œì†¡

---

### 8.9 ì¿ í° í™œì„±í™”/ë¹„í™œì„±í™” [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons` - ì¿ í° ëª©ë¡

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
toggleCouponStatus(couponId, isActive)
  â†“ updates
  coupons.is_active = isActive
  â†“ affects
  - ë¹„í™œì„±í™” ì‹œ ì‹ ê·œ ë°°í¬ ë¶ˆê°€
  - ê¸°ì¡´ ë³´ìœ ìëŠ” ì‚¬ìš© ê°€ëŠ¥
```

---

### 8.10 ì¿ í° í†µê³„ ì¡°íšŒ [ì¼ë°˜]

#### ğŸ“ ì˜í–¥ë°›ëŠ” í˜ì´ì§€
1. `/admin/coupons/[id]` - ì¿ í° ìƒì„¸

#### ğŸ”§ í•µì‹¬ í•¨ìˆ˜
```javascript
getCouponStats(couponId)
  â†“ aggregates
  - total_issued: ì´ ë°œê¸‰ ìˆ˜
  - total_used: ì´ ì‚¬ìš© ìˆ˜
  - usage_rate: ì‚¬ìš©ë¥  (%)
  - remaining: ë‚¨ì€ ìˆ˜ëŸ‰ (total_usage_limit - total_used)
  â†“ returns
  í†µê³„ ê°ì²´
```

---

## ğŸ“Š ì¿ í° ì‹œìŠ¤í…œ ì „ì²´ íë¦„

### 1. ì¿ í° ë°œí–‰ (ê´€ë¦¬ì)
```
ê´€ë¦¬ì â†’ /admin/coupons/new
  â†“ createCoupon()
ì¿ í° ìƒì„± ì™„ë£Œ
  â†“ redirect
/admin/coupons/[id] (ë°°í¬ í˜ì´ì§€)
```

### 2. ì¿ í° ë°°í¬ (ê´€ë¦¬ì)
```
ê´€ë¦¬ì â†’ /admin/coupons/[id]
  â†“ ê³ ê° ì„ íƒ (ê°œë³„ or ì „ì²´)
  â†“ distributeCoupon() or distributeToAllCustomers()
user_coupons ë ˆì½”ë“œ ìƒì„±
  â†“ trigger
coupons.total_issued_count ì¦ê°€
```

### 3. ì¿ í° ì‚¬ìš© (ê³ ê°)
```
ê³ ê° â†’ /checkout
  â†“ ì¿ í° ì„ íƒ
  â†“ validateCoupon()
í• ì¸ ê¸ˆì•¡ ê³„ì‚° ë° í‘œì‹œ
  â†“ ì£¼ë¬¸ ìƒì„±
  â†“ applyCouponUsage()
user_coupons.is_used = true
  â†“ trigger
coupons.total_used_count ì¦ê°€
```

### 4. ì¿ í° ì¡°íšŒ (ê³ ê°)
```
ê³ ê° â†’ /mypage/coupons
  â†“ getUserCoupons()
ë‚´ ì¿ í° ëª©ë¡ í‘œì‹œ
  â†“ í•„í„° (ì‚¬ìš©ê°€ëŠ¥/ì‚¬ìš©ì™„ë£Œ/ë§Œë£Œ)
ìƒíƒœë³„ ë¶„ë¥˜ í‘œì‹œ
```

---

## ğŸ”— ì¿ í° ì‹œìŠ¤í…œ ì—°ê´€ ê´€ê³„

### ì¿ í° â†’ ì£¼ë¬¸
- ì²´í¬ì•„ì›ƒ í˜ì´ì§€ì—ì„œ ì¿ í° ì„ íƒ ì‹œ í• ì¸ ì ìš©
- ì£¼ë¬¸ ìƒì„± í›„ ì¿ í° ì‚¬ìš© ì²˜ë¦¬
- user_coupons.order_idì— ì£¼ë¬¸ ID ì €ì¥

### ì¿ í° â†’ ì‚¬ìš©ì
- user_coupons í…Œì´ë¸”ë¡œ ì‚¬ìš©ìë³„ ì¿ í° ë³´ìœ  ê´€ë¦¬
- ì¤‘ë³µ ë³´ìœ  ë°©ì§€ (UNIQUE ì œì•½)
- ì‚¬ìš© ì´ë ¥ ì¶”ì 

### ì¿ í° â†’ í†µê³„
- DB íŠ¸ë¦¬ê±°ë¡œ ìë™ í†µê³„ ì—…ë°ì´íŠ¸
- ë°œê¸‰ ì‹œ: total_issued_count++
- ì‚¬ìš© ì‹œ: total_used_count++

---

**ë¬¸ì„œí™” ì™„ë£Œìœ¨**: 100%
